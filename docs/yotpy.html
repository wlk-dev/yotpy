<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.0"/>
    <title>yotpy API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SessionNotCreatedError">SessionNotCreatedError</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SessionNotCreatedError.__init__">SessionNotCreatedError</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PreflightException">PreflightException</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#UploadException">UploadException</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#SendException">SendException</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#CustomException">CustomException</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#UserIdNotFound">UserIdNotFound</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#AppDataNotFound">AppDataNotFound</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#JSONTransformer">JSONTransformer</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#JSONTransformer.merge_on_key">merge_on_key</a>
                        </li>
                        <li>
                                <a class="function" href="#JSONTransformer.flatten">flatten</a>
                        </li>
                        <li>
                                <a class="function" href="#JSONTransformer.flatten_list">flatten_list</a>
                        </li>
                        <li>
                                <a class="function" href="#JSONTransformer.get_headers">get_headers</a>
                        </li>
                        <li>
                                <a class="function" href="#JSONTransformer.from_bigquery_iterator">from_bigquery_iterator</a>
                        </li>
                        <li>
                                <a class="function" href="#JSONTransformer.to_rows">to_rows</a>
                        </li>
                        <li>
                                <a class="function" href="#JSONTransformer.to_csv_stringio">to_csv_stringio</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#YotpoAPIWrapper">YotpoAPIWrapper</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#YotpoAPIWrapper.__init__">YotpoAPIWrapper</a>
                        </li>
                        <li>
                                <a class="function" href="#YotpoAPIWrapper.get_user">get_user</a>
                        </li>
                        <li>
                                <a class="function" href="#YotpoAPIWrapper.get_app">get_app</a>
                        </li>
                        <li>
                                <a class="function" href="#YotpoAPIWrapper.get_total_reviews">get_total_reviews</a>
                        </li>
                        <li>
                                <a class="function" href="#YotpoAPIWrapper.get_templates">get_templates</a>
                        </li>
                        <li>
                                <a class="function" href="#YotpoAPIWrapper.fetch_review_page">fetch_review_page</a>
                        </li>
                        <li>
                                <a class="function" href="#YotpoAPIWrapper.fetch_all_reviews">fetch_all_reviews</a>
                        </li>
                        <li>
                                <a class="function" href="#YotpoAPIWrapper.send_review_request">send_review_request</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
yotpy    </h1>

                        <div class="docstring"><p>Yotpy: An easy-to-use Python wrapper for the Yotpo web API.</p>
</div>

                        <input id="mod-yotpy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-yotpy-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">Yotpy: An easy-to-use Python wrapper for the Yotpo web API.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.0.5&quot;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">asyncio</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">aiohttp</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">loads</span> <span class="k">as</span> <span class="n">json_loads</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="n">DictWriter</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncGenerator</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">html</span> <span class="kn">import</span> <span class="n">unescape</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">SessionNotCreatedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the aiohttp.ClientSession has not been created before making a request.&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Session not created. Please use `async with` context manager to make requests.&quot;</span><span class="p">):</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">PreflightException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    <span class="k">pass</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="k">class</span> <span class="nc">UploadException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="k">pass</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="k">class</span> <span class="nc">SendException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="k">pass</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="k">class</span> <span class="nc">CustomException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="k">pass</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="c1"># TODO: Refactor naming for the below two classes</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="k">class</span> <span class="nc">UserIdNotFound</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the user ID cannot be retrieved.&quot;&quot;&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>    <span class="k">pass</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="k">class</span> <span class="nc">AppDataNotFound</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the app data cannot be retrieved.&quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="k">pass</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="c1"># TODO: More insightful sentiment analysis</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="c1"># TODO: Give better error messages for bad requests</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="k">class</span> <span class="nc">JSONTransformer</span><span class="p">:</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    A utility class for transforming JSON data into various formats.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="nf">_stream_json_data</span><span class="p">(</span><span class="n">json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        Stream the full key directory and its final value of a JSON object of arbitrary depth, including lists.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        </span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        This method recursively traverses a nested JSON object and yields dictionaries containing the full key</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        directory (as tuples) and their associated values. It handles dictionaries and lists within the JSON object.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">        Example:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">            Input JSON:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">            ```json</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">            { &quot;a&quot;: </span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">                { &quot;b&quot;:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">                    [ { &quot;c&quot;: &quot;d&quot; }, { &quot;e&quot;: [1,2,3] } ]</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">                },</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">            &quot;x&quot;: { &quot;y&quot;: &quot;z&quot; }</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">            }</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">            ```</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">            Streaming key directories and values:</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">            ```python</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            &gt;&gt;&gt; print(list(JSONTransformer._stream_json_data(json, tuple())))</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">            &gt;&gt;&gt; [{&quot;keys&quot;: (&quot;a&quot;, &quot;b&quot;, &quot;0&quot;, &quot;c&quot;), &quot;value&quot;: &quot;d&quot;},</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">            &gt;&gt;&gt;  {&quot;keys&quot;: (&quot;a&quot;, &quot;b&quot;, &quot;1&quot;, &quot;e&quot;, &quot;0&quot;), &quot;value&quot;: 1},</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">            &gt;&gt;&gt;  {&quot;keys&quot;: (&quot;a&quot;, &quot;b&quot;, &quot;1&quot;, &quot;e&quot;, &quot;1&quot;), &quot;value&quot;: 2},</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">            &gt;&gt;&gt;  {&quot;keys&quot;: (&quot;a&quot;, &quot;b&quot;, &quot;1&quot;, &quot;e&quot;, &quot;2&quot;), &quot;value&quot;: 3},</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            &gt;&gt;&gt;  {&quot;keys&quot;: (&quot;x&quot;, &quot;y&quot;), &quot;value&quot;: &quot;z&quot;}]</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">            ```</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        Args:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">            json (dict): The JSON object to stream.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">            keys (tuple): The current list of keys being traversed.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        Yields:</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">            dict[str, Union[tuple | str]]: A dictionary containing the current key &quot;directory&quot; (as a tuple) and its associated value.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        Returns:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">            Iterator[dict[str, Union[tuple | str]]]: An iterator that yields dictionaries with the current key &quot;directory&quot; and its associated value.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        Note:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">            Tuples have been used instead of lists for the keys argument, for performance at the cost of readability of this function.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                <span class="c1"># If the value is another dictionary, recursively call this method</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                <span class="c1"># with the updated keys &quot;list&quot;.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">_stream_json_data</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span> <span class="o">+</span> <span class="p">(</span><span class="n">key</span><span class="p">,)):</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                    <span class="k">yield</span> <span class="n">result</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="c1"># If the value is a list, iterate through the list and recursively</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>                <span class="c1"># call this method with the updated keys &quot;list&quot; and index as an additional key.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                        <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;keys&#39;</span><span class="p">:</span> <span class="n">keys</span> <span class="o">+</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">}</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>                        <span class="k">continue</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>                        
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>                    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">_stream_json_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">keys</span> <span class="o">+</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))):</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>                        <span class="k">yield</span> <span class="n">result</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="c1"># If the value is not a dictionary or list, yield a dictionary containing</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                <span class="c1"># the current key &quot;list&quot; (as a tuple) and value.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>                <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;keys&#39;</span><span class="p">:</span> <span class="n">keys</span> <span class="o">+</span> <span class="p">(</span><span class="n">key</span><span class="p">,),</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="nf">merge_on_key</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">list_2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        Merges two lists of dictionaries into a single list, based on matching dictionary keys.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        Args:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">            key (str): The key to match the dictionaries on.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">            list_1 (list[dict]): The first list of dictionaries.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">            list_2 (list[dict]): The second list of dictionaries.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">        Returns:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">            list[dict]: A merged list of dictionaries containing merged disctionaries based on matching keys from both input lists.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">list_2</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>                <span class="sa">f</span><span class="s2">&quot;Cannot merge empty list(s).</span><span class="se">\n</span><span class="s2">list_1: length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_1</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">list_2: length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="c1"># Use list comprehension to merge dictionaries that have matching keys</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>            <span class="nb">dict</span><span class="p">(</span><span class="n">item_1</span><span class="p">,</span> <span class="o">**</span><span class="n">item_2</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>            <span class="k">for</span> <span class="n">item_1</span> <span class="ow">in</span> <span class="n">list_1</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>            <span class="k">for</span> <span class="n">item_2</span> <span class="ow">in</span> <span class="n">list_2</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="k">if</span> <span class="n">item_1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="p">]</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        Flatten a nested JSON object into a dictionary with flattened keys.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        </span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        This method takes a nested JSON object and converts it into a dictionary with</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        keys that represent the nested structure using a specified separator. Optionally,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        you can provide a list of keys to exclude or include in the resulting dictionary.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        Example:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">            Input JSON:</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">            ```json</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">            { &quot;a&quot;: </span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">                { &quot;b&quot;:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">                    [ { &quot;c&quot;: &quot;d&quot; }, { &quot;e&quot;: [1,2,3] } ]</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">                },</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">                &quot;x&quot;: { &quot;y&quot;: &quot;z&quot; }</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">            }</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">            ```</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">            Flattening with a &quot;.&quot; separator:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">            ```python</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">            &gt;&gt;&gt; print(JSONTransformer.flatten(json, &quot;.&quot;))</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            &gt;&gt;&gt; {&quot;a.b.0.c&quot;: &quot;d&quot;,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.0&quot;: 1,</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.1&quot;: 2,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.2&quot;: 3,</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">            &gt;&gt;&gt;  &quot;x.y&quot;: &quot;z&quot;}</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">            ```</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">            Include and Exclude should be formatted with the complete nested key output in mind.</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">            </span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">            e.g  `include=[&quot;a.b.0.c&quot;]`, returns `{&quot;a.b.0.c&quot;: &quot;d&quot;}` only.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        Args:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">            json (dict): The JSON object to flatten.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        Returns:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">            dict[str, str]: A flattened dictionary with keys representing the nested structure.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="c1"># Stream the key-value pairs of the JSON object using the _stream_json_data method.</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">_stream_json_data</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">()):</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="n">keys</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">]</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="n">key_str</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">exclude</span> <span class="ow">and</span> <span class="n">key_str</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">include</span> <span class="ow">and</span> <span class="n">key_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include</span><span class="p">):</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>                <span class="k">continue</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="c1"># Check if the key string matches the specified key strings for content and title.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="c1"># If so, html.unescape the value, this is from Yotpo&#39;s side of things.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="c1"># This is done so NLTK is able to properly process the reviews.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">key_str</span><span class="p">):</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">key_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">unescape</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">key_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>    <span class="k">def</span> <span class="nf">flatten_list</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]]:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        Flattens a list of JSON objects into a list of dictionaries with flattened keys.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">        </span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        This method takes a list of nested JSON objects and converts each JSON object into a</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        dictionary with keys representing the nested structure using a specified separator. </span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        Optionally, you can provide a list of keys to exclude or include in the resulting dictionaries.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        Example:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">            Input JSON list:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">            ```json</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">            [</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">                {</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">                    &quot;a&quot;: {&quot;b&quot;: {&quot;c&quot;: &quot;d&quot;}},</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">                    &quot;x&quot;: {&quot;y&quot;: &quot;z&quot;}</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">                },</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">                {</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">                    &quot;p&quot;: {&quot;q&quot;: {&quot;r&quot;: &quot;s&quot;}},</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">                    &quot;u&quot;: {&quot;v&quot;: &quot;w&quot;}</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">                }</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">            ]</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">            ```</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">            Flattening with a &quot;.&quot; separator:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">            ```python</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">            &gt;&gt;&gt; print(JSONTransformer.flatten_list(json_list, &quot;.&quot;))</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">            &gt;&gt;&gt; [</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">            &gt;&gt;&gt;     {&quot;a.b.c&quot;: &quot;d&quot;, &quot;x.y&quot;: &quot;z&quot;},</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">            &gt;&gt;&gt;     {&quot;p.q.r&quot;: &quot;s&quot;, &quot;u.v&quot;: &quot;w&quot;}</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">            &gt;&gt;&gt; ]</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">            ```</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        Args:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">            json_list (list[dict]): A list of JSON objects to flatten.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        Returns:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">            list[dict[str, any]]: A list of flattened dictionaries with keys representing the nested structure.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">JSONTransformer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">exclude</span><span class="p">,</span> <span class="n">include</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">json_list</span><span class="p">]</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">        Get a complete headers list from a list of JSON objects.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        Args:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">            json_list (list[dict]): A list of JSON objects to iterate over.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        Returns:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">            set[str]: A set of headers.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">key</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">json_list</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>    <span class="k">def</span> <span class="nf">from_bigquery_iterator</span><span class="p">(</span><span class="n">iterator</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">include</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">        Convert a BigQuery RowIterator into a set of headers and a list of rows.</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">        Args:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">            iterator (Iterator): A BigQuery RowIterator object.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">            exclude (set[str], optional): A set of field names to exclude from the output. Defaults to an empty set.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">            include (set[str], optional): A set of field names to include in the output. If provided, only these fields</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">                                          will be included. Defaults to an empty set.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        Returns:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">            tuple[set, list]: A tuple containing a set of headers and a list of rows as dictionaries.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">                              Headers are the field names included in the output, and rows are dictionaries</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">                              containing field values for each row in the RowIterator.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        Note:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">            If both `exclude` and `include` are provided, the `include` set takes precedence.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterator</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">schema</span> <span class="k">if</span> <span class="p">(</span><span class="n">include</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">include</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">exclude</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)}</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">schema</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">to_rows</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">]:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">        Flatten a list of JSON objects into a list of rows and a set of headers.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        </span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">        This method takes a list of nested JSON objects and converts each JSON object into a</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        dictionary with keys representing the nested structure using a specified separator. </span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        It then creates a list of rows, where each row contains the values from the flattened</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        dictionaries, and a set of headers representing the unique keys of the flattened dictionaries.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        Args:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">            json_list (list[dict]): The list of JSON objects to flatten.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        Note:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">            If both exclude and include are specified, exclude takes precedence.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">            This is done by using the following logic:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">                ```</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">                if key_str in exclude or (include and key_str not in include):</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">                    continue</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">                ```</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        Returns:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">            tuple[list, set]: A tuple containing the list of rows and the set of headers.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="c1"># Flatten the JSON object into a list of dictionaries using the flatten method.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">flatten_list</span><span class="p">(</span><span class="n">json_list</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">exclude</span><span class="p">,</span> <span class="n">include</span><span class="p">):</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">to_csv_stringio</span><span class="p">(</span><span class="n">rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">headers</span><span class="p">:</span> <span class="nb">set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringIO</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        Convert a list of rows into a CSV formatted StringIO object.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        </span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        This method takes a list of rows (dictionaries) and a set of headers, and writes them into</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        a CSV formatted StringIO object. It can be used to create a CSV file-like object without</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        creating an actual file on the filesystem.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        Args:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">            rows (list[dict]): A list of rows to convert into a CSV formatted StringIO object.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            headers (set): A set of headers to use for the CSV data.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        Returns:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            StringIO: A CSV formatted StringIO object.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="c1"># Create a StringIO object to write the CSV data to.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="n">csv_stringio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="c1"># Create a csv writer and write the rows to the StringIO object.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">DictWriter</span><span class="p">(</span><span class="n">csv_stringio</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="c1"># Reset the StringIO object&#39;s position to the beginning</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="n">csv_stringio</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="n">csv_stringio</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="k">class</span> <span class="nc">YotpoAPIWrapper</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="c1">#NOTE: Update docstring if more methods are added to account for any added functionality outside of the defined scope.</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">    A class for interacting with the Yotpo API to fetch app and account information, review data, and send manual review requests.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">    The YotpoAPIWrapper uses the provided app_key and secret for authentication and constructs the necessary API endpoints for making requests.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">    Args:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">        app_key (str): The Yotpo app key for API authentication.</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">        secret (str): The client secret to authenticate requests.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        preferred_uid (Optional[int], optional): The user ID to use for fetching data relating to the Yotpo APP. Defaults to None.</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">    Raises:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        Exception: If either app_key or secret is not provided.</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="c1"># TODO: Update the explanation of the preferred_uid argument to be more accurate/helpful.</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">preferred_uid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">app_key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">secret</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;app_key(exists=</span><span class="si">{</span><span class="nb">bool</span><span class="p">(</span><span class="n">app_key</span><span class="p">)</span><span class="si">}</span><span class="s2">) and secret(exists=</span><span class="si">{</span><span class="nb">bool</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span><span class="si">}</span><span class="s2">) are required.&quot;</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span> <span class="o">=</span> <span class="n">app_key</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_secret</span> <span class="o">=</span> <span class="n">secret</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">preferred_uid</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_token</span><span class="p">()</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.yotpo.com/v1/apps/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/reviews?utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&amp;&quot;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">widget_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.yotpo.com/v1/widget/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/reviews?utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&amp;&quot;</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_user_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api-write.yotpo.com/users/me?utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_app_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api-write.yotpo.com/apps&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">())[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_get_user_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        Get the user access token using the provided secret.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        Args:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">            app_key (str): The target app you want authenticated.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">            secret (str): The client secret to authenticate the request.</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        Returns:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">            str: The user access token.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        Raises:</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">            Exception: If the response status is not OK (200).</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.yotpo.com/oauth/token&quot;</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">,</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="p">,</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secret</span><span class="p">,</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="p">}</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="k">return</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]))</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_options_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">        Asynchronously sends a preflight OPTIONS request to check if the given method is allowed for the given endpoint.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        Args:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">            url (str): The API endpoint URL.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">        Returns:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">            bool: True if the method is allowed, False otherwise.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;aiohttp_session&#39;</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="k">raise</span> <span class="n">SessionNotCreatedError</span><span class="p">()</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="c1"># Cheeky way to make sure `method` is at least syntactically correct.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">:=</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="s1">&#39;CONNECT&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRACE&#39;</span><span class="p">]:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid HTTP method: &quot;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>                <span class="n">allowed_methods</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>                <span class="k">return</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">allowed_methods</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_get_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exception_type</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">=</span> <span class="n">CustomException</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        Asynchronously sends a GET request to the specified URL and parses the response using the provided parser.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        Args:</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">            session (aiohttp.ClientSession): An aiohttp client session for making requests.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">            url (str): The URL to send the request to.</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">            parser (Callable[[dict], dict]): A function to parse the response JSON. Defaults to json.loads.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">            exception_type (Union[CustomException, Exception]): The type of exception to raise when an error occurs. Defaults to CustomException.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">            **kwargs: Additional keyword arguments to be passed to the request object.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">        Returns:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">            dict: The parsed JSON response.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">        Raises:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">            exception_type: If the response status is not 200, an instance of the specified exception_type is raised with an error message.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;aiohttp_session&#39;</span><span class="p">):</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            <span class="k">raise</span> <span class="n">SessionNotCreatedError</span><span class="p">()</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                <span class="n">raw_data</span> <span class="o">=</span> <span class="n">json_loads</span><span class="p">(</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>                <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                    <span class="k">return</span> <span class="n">raw_data</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>                <span class="k">return</span> <span class="n">parser</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="k">raise</span> <span class="n">exception_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_post_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exception_type</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">=</span> <span class="n">CustomException</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">        Asynchronously sends a POST request to the specified URL and parses the response using the provided parser.</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">        Args:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">            session (aiohttp.ClientSession): An aiohttp client session for making requests.</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">            url (str): The URL to send the request to.</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">            data (dict): The data to send in the request body.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">            parser (Callable[[dict], dict]): A function to parse the response JSON. Defaults to json.loads.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">            exception_type (Union[CustomException, Exception]): The type of exception to raise when an error occurs. Defaults to CustomException.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">            **kwargs: Additional keyword arguments to be passed to the request object.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">        Returns:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">            dict: The parsed JSON response.</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        Raises:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">            exception_type: If the response status is not 200, an instance of the specified exception_type is raised with an error message.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;aiohttp_session&#39;</span><span class="p">):</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>            <span class="k">raise</span> <span class="n">SessionNotCreatedError</span><span class="p">()</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>                <span class="n">raw_data</span> <span class="o">=</span> <span class="n">json_loads</span><span class="p">(</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>                <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>                    <span class="k">return</span> <span class="n">raw_data</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>                <span class="k">return</span> <span class="n">parser</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="k">raise</span> <span class="n">exception_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">        Asynchronously generate URLs for each page of results.</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">        Args:</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">            endpoint (str): The API endpoint to query.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">            start_page (int): The first page to generate.</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">        Yields:</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">            tuple[str, int] -&gt;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">                str: The URL for the next page of results.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">                int: The current page number.</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="n">last_page</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_reviews</span><span class="p">())</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>        <span class="n">is_widget</span> <span class="o">=</span> <span class="s2">&quot;widget&quot;</span> <span class="ow">in</span> <span class="n">endpoint</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">last_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>            <span class="k">yield</span> <span class="n">endpoint</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(({(</span><span class="s2">&quot;per_page&quot;</span> <span class="k">if</span> <span class="n">is_widget</span> <span class="k">else</span> <span class="s2">&quot;count&quot;</span><span class="p">):</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="n">num</span><span class="p">})),</span> <span class="n">num</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">        Asynchronously fetches user data from the user endpoint.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">        This function returns various user-related data, such as name, email, display_name, company, position, and other</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">        metadata like sign_in_count and package details. This data can be useful for understanding user profiles,</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        managing access, or customizing the user experience based on the retrieved information.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        Returns:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">            dict: A dictionary containing user information, including personal details, activity statistics, and package details.</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">        Example:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">            ```python</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">            &gt;&gt;&gt; yotpo = YotpoAPIWrapper(app_key, secret)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">            &gt;&gt;&gt; async with yotpo as yp:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">            &gt;&gt;&gt;     user = await yp.get_user()</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">            ```</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">        Raises:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">            Exception: If the request to the user endpoint returns a non-OK status.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_user_endpoint</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">])</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_app</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">        Asynchronously fetches app data for the app associated with the preferred user ID.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="sd">        Returns:</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="sd">            dict: A dictionary containing app information derived from the specified user. The app information includes</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">            details such as app_key, domain, name, url, account type, users, reminders, custom design, created</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">            and updated timestamps, tracking code status, account emails, package details, enabled product</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">            categories, features usage summary, data for events, category, installed status, organization,</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">            and associated apps.</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">        </span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a><span class="sd">        Raises:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">            AppDataNotFound: If the request to the app endpoint returns a non-OK status.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="c1"># NOTE: The user_id does not appear to actually matter at all, as it still returns data even if it is not a valid user ID.</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="c1"># I suspect `user_id` is just used to track which user is making the request.</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="c1"># TODO: If the above is true, we can probably abstract away the `user_id` parameter and just use the user ID from the user endpoint.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="c1"># And if need be we can add some configuration to allow the user to specify a user ID if they want to.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api-write.yotpo.com/apps/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">?user_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&amp;utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;app&#39;</span><span class="p">],</span> <span class="n">exception_type</span><span class="o">=</span><span class="n">AppDataNotFound</span><span class="p">)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_total_reviews</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">        Asynchronously fetches the total number of reviews for an app.</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">        This method first retrieves the user and their user ID, then fetches the app data</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">        associated with that user. Finally, it returns the total number of reviews for the app.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">        Returns:</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">            int: The total number of reviews for the app.</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">        Raises:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">            AppDataNotFound: If unable to get the app data.</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        <span class="n">app</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>        <span class="k">return</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;data_for_events&#39;</span><span class="p">][</span><span class="s1">&#39;total_reviews&#39;</span><span class="p">]</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>    
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">        Asynchronously fetch the email templates associated with the Yotpo account.</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">        This method retrieves the app data, extracts the email templates, and returns them as a dictionary.</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">        The primary use case for this function is to obtain the template IDs required for the &#39;send_review_request&#39; method.</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">        The returned dictionary contains template objects with properties such as &#39;id&#39; (template_id),</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">        &#39;email_type&#39;, &#39;data&#39;, and others. For example:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">        ```python</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">            {</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">                &#39;id&#39;: 10291872,</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">                &#39;account_id&#39;: 9092811,</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">                &#39;email_type_id&#39;: 31,</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">                &#39;email_type&#39;: {</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">                    &#39;id&#39;: 31,</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">                    &#39;name&#39;: &#39;mail_post_service&#39;,</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">                    &#39;template&#39;: &#39;testimonials_request&#39;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">                },</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">                &#39;data&#39;: {</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">                    &#39;subject&#39;: &#39;Tell us what you think - {company_name}&#39;,</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">                    &#39;header&#39;: &#39;Hello {user},\\n We love having you as a customer and would really appreciate it if you filled out the form below.&#39;,</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">                    &#39;bottom&#39;: &#39;Thanks so much! &lt;br&gt; - {company_name}&#39;</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">                },</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">                &#39;formless_call_to_action&#39;: &#39;&#39;,</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">                &#39;days_delay&#39;: 3,</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">                &#39;email_submission_type_id&#39;: 9</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">            }</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">        ```</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a><span class="sd">        Returns:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">            dict: A dictionary containing the email templates, keyed by their names.</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        <span class="n">app</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="n">templates</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;account_emails&#39;</span><span class="p">]</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>        <span class="k">return</span> <span class="n">templates</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>        
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_review_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a><span class="sd">        Asynchronously fetch a single review page from the specified URL.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a><span class="sd">        This function fetches review data from the provided URL and parses the response based on whether</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a><span class="sd">        the URL is for the widget endpoint or not.</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a><span class="sd">        Args:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a><span class="sd">            url (str): The URL from which to fetch review data.</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a><span class="sd">        Returns:</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="sd">            list[dict]: A list of review dictionaries.</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="n">is_widget</span> <span class="o">=</span> <span class="s2">&quot;widget&quot;</span> <span class="ow">in</span> <span class="n">url</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_widget</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">])</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_all_reviews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">published</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">        Asynchronously fetch all reviews from the specified endpoints.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">        This function fetches review data from the app and widget endpoints if `published` is set to True, </span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">        and only from the app endpoint if `published` is set to False. The fetched reviews are then merged</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">        based on their &quot;id&quot; attribute.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">        Args:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a><span class="sd">            published (bool, optional): Determines if the function should fetch reviews from both</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a><span class="sd">                                         the app and widget endpoints or just the app endpoint.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a><span class="sd">                                         Defaults to True.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a><span class="sd">        Returns:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a><span class="sd">            list[dict]: A list of merged review dictionaries.</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a><span class="sd">        Raises:</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a><span class="sd">            Exception: If one or more requests fail.</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>        <span class="n">reviews</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">app_endpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_endpoint</span><span class="p">]</span> <span class="k">if</span> <span class="n">published</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app_endpoint</span><span class="p">]):</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>            <span class="n">review_requests</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span><span class="p">(</span><span class="n">endpoint</span><span class="p">):</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>                <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_review_page</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>                <span class="n">review_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>            
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gathering </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">review_requests</span><span class="p">)</span><span class="si">}</span><span class="s2"> review requests from </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">review_requests</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]):</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;One or more requests failed.&quot;</span><span class="p">)</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>                <span class="c1"># Flatten the list of lists into one big list using itertools.chain</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>                <span class="n">reviews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>            
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>        <span class="k">return</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">merge_on_key</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">reviews</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">send_review_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">csv_stringio</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">spam_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a><span class="sd">        Asynchronously send a &quot;manual&quot; review request to Yotpo using a specific email template.</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a><span class="sd">        This method takes a template_id, a CSV formatted StringIO object containing the review</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a><span class="sd">        request data, and an optional spam_check flag. It uploads the review data to Yotpo and</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a><span class="sd">        sends the review request using the specified email template.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a><span class="sd">        Args:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a><span class="sd">            template_id (int | str): The ID of the email template to use for the review request.</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a><span class="sd">            csv_stringio (StringIO): A StringIO object containing the review request data in CSV format.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a><span class="sd">                                     (Use the `JSONTransformer` class to generate this.)</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a><span class="sd">            spam_check (bool, optional): Whether or not to enable the built-in Yotpo spam check. Defaults to False.</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a><span class="sd">        Returns:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a><span class="sd">            dict: A dictionary containing the response data.</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a><span class="sd">        Raises:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a><span class="sd">            Exception: If any response status is not 200.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a><span class="sd">            UploadException: If the uploaded file is not valid.</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>        <span class="n">upload_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">write_app_endpoint</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/account_emails/</span><span class="si">{</span><span class="n">template_id</span><span class="si">}</span><span class="s2">/upload_mailing_list&quot;</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>        <span class="n">send_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">write_app_endpoint</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/account_emails/</span><span class="si">{</span><span class="n">template_id</span><span class="si">}</span><span class="s2">/send_burst_email&quot;</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>        
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>        <span class="n">upload_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request</span><span class="p">(</span><span class="n">upload_url</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">csv_stringio</span><span class="p">,</span> <span class="s2">&quot;utoken&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="p">})</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>        <span class="n">upload_data</span> <span class="o">=</span> <span class="n">upload_response</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;response&#39;</span><span class="p">]</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>        <span class="k">if</span> <span class="n">upload_data</span><span class="p">[</span><span class="s1">&#39;is_valid_file&#39;</span><span class="p">]:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>            <span class="n">send_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request</span><span class="p">(</span><span class="n">send_url</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">upload_data</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">],</span> <span class="s2">&quot;utoken&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="p">,</span> <span class="s2">&quot;activate_spam_limitations&quot;</span><span class="p">:</span> <span class="n">spam_check</span><span class="p">})</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>            <span class="k">raise</span> <span class="n">UploadException</span><span class="p">(</span><span class="s2">&quot;Error: Uploaded file is not valid&quot;</span><span class="p">)</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;upload&quot;</span><span class="p">:</span> <span class="n">upload_response</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">:</span> <span class="n">send_response</span><span class="p">}</span>
</span></pre></div>


            </section>
                <section id="SessionNotCreatedError">
                            <input id="SessionNotCreatedError-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SessionNotCreatedError</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="SessionNotCreatedError-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SessionNotCreatedError"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SessionNotCreatedError-20"><a href="#SessionNotCreatedError-20"><span class="linenos">20</span></a><span class="k">class</span> <span class="nc">SessionNotCreatedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="SessionNotCreatedError-21"><a href="#SessionNotCreatedError-21"><span class="linenos">21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the aiohttp.ClientSession has not been created before making a request.&quot;&quot;&quot;</span>
</span><span id="SessionNotCreatedError-22"><a href="#SessionNotCreatedError-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Session not created. Please use `async with` context manager to make requests.&quot;</span><span class="p">):</span>
</span><span id="SessionNotCreatedError-23"><a href="#SessionNotCreatedError-23"><span class="linenos">23</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Raised when the aiohttp.ClientSession has not been created before making a request.</p>
</div>


                            <div id="SessionNotCreatedError.__init__" class="classattr">
                                        <input id="SessionNotCreatedError.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SessionNotCreatedError</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">message</span><span class="o">=</span><span class="s1">&#39;Session not created. Please use `async with` context manager to make requests.&#39;</span></span>)</span>

                <label class="view-source-button" for="SessionNotCreatedError.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SessionNotCreatedError.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SessionNotCreatedError.__init__-22"><a href="#SessionNotCreatedError.__init__-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Session not created. Please use `async with` context manager to make requests.&quot;</span><span class="p">):</span>
</span><span id="SessionNotCreatedError.__init__-23"><a href="#SessionNotCreatedError.__init__-23"><span class="linenos">23</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.BaseException</dt>
                                <dd id="SessionNotCreatedError.with_traceback" class="function">with_traceback</dd>
                <dd id="SessionNotCreatedError.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PreflightException">
                            <input id="PreflightException-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PreflightException</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="PreflightException-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PreflightException"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PreflightException-26"><a href="#PreflightException-26"><span class="linenos">26</span></a><span class="k">class</span> <span class="nc">PreflightException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="PreflightException-27"><a href="#PreflightException-27"><span class="linenos">27</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Common base class for all non-exit exceptions.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="PreflightException.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="PreflightException.with_traceback" class="function">with_traceback</dd>
                <dd id="PreflightException.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="UploadException">
                            <input id="UploadException-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">UploadException</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="UploadException-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UploadException"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UploadException-29"><a href="#UploadException-29"><span class="linenos">29</span></a><span class="k">class</span> <span class="nc">UploadException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="UploadException-30"><a href="#UploadException-30"><span class="linenos">30</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Common base class for all non-exit exceptions.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="UploadException.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="UploadException.with_traceback" class="function">with_traceback</dd>
                <dd id="UploadException.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SendException">
                            <input id="SendException-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SendException</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="SendException-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SendException"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SendException-32"><a href="#SendException-32"><span class="linenos">32</span></a><span class="k">class</span> <span class="nc">SendException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="SendException-33"><a href="#SendException-33"><span class="linenos">33</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Common base class for all non-exit exceptions.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="SendException.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="SendException.with_traceback" class="function">with_traceback</dd>
                <dd id="SendException.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CustomException">
                            <input id="CustomException-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CustomException</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="CustomException-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CustomException"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CustomException-35"><a href="#CustomException-35"><span class="linenos">35</span></a><span class="k">class</span> <span class="nc">CustomException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="CustomException-36"><a href="#CustomException-36"><span class="linenos">36</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Common base class for all non-exit exceptions.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="CustomException.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="CustomException.with_traceback" class="function">with_traceback</dd>
                <dd id="CustomException.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="UserIdNotFound">
                            <input id="UserIdNotFound-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">UserIdNotFound</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="UserIdNotFound-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UserIdNotFound"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UserIdNotFound-39"><a href="#UserIdNotFound-39"><span class="linenos">39</span></a><span class="k">class</span> <span class="nc">UserIdNotFound</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="UserIdNotFound-40"><a href="#UserIdNotFound-40"><span class="linenos">40</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the user ID cannot be retrieved.&quot;&quot;&quot;</span>
</span><span id="UserIdNotFound-41"><a href="#UserIdNotFound-41"><span class="linenos">41</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Raised when the user ID cannot be retrieved.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="UserIdNotFound.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="UserIdNotFound.with_traceback" class="function">with_traceback</dd>
                <dd id="UserIdNotFound.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="AppDataNotFound">
                            <input id="AppDataNotFound-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AppDataNotFound</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="AppDataNotFound-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AppDataNotFound"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AppDataNotFound-43"><a href="#AppDataNotFound-43"><span class="linenos">43</span></a><span class="k">class</span> <span class="nc">AppDataNotFound</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
</span><span id="AppDataNotFound-44"><a href="#AppDataNotFound-44"><span class="linenos">44</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when the app data cannot be retrieved.&quot;&quot;&quot;</span>
</span><span id="AppDataNotFound-45"><a href="#AppDataNotFound-45"><span class="linenos">45</span></a>    <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Raised when the app data cannot be retrieved.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="AppDataNotFound.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="AppDataNotFound.with_traceback" class="function">with_traceback</dd>
                <dd id="AppDataNotFound.add_note" class="function">add_note</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="JSONTransformer">
                            <input id="JSONTransformer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">JSONTransformer</span>:

                <label class="view-source-button" for="JSONTransformer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONTransformer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONTransformer-50"><a href="#JSONTransformer-50"><span class="linenos"> 50</span></a><span class="k">class</span> <span class="nc">JSONTransformer</span><span class="p">:</span>
</span><span id="JSONTransformer-51"><a href="#JSONTransformer-51"><span class="linenos"> 51</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-52"><a href="#JSONTransformer-52"><span class="linenos"> 52</span></a><span class="sd">    A utility class for transforming JSON data into various formats.</span>
</span><span id="JSONTransformer-53"><a href="#JSONTransformer-53"><span class="linenos"> 53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-54"><a href="#JSONTransformer-54"><span class="linenos"> 54</span></a>
</span><span id="JSONTransformer-55"><a href="#JSONTransformer-55"><span class="linenos"> 55</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer-56"><a href="#JSONTransformer-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="nf">_stream_json_data</span><span class="p">(</span><span class="n">json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
</span><span id="JSONTransformer-57"><a href="#JSONTransformer-57"><span class="linenos"> 57</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-58"><a href="#JSONTransformer-58"><span class="linenos"> 58</span></a><span class="sd">        Stream the full key directory and its final value of a JSON object of arbitrary depth, including lists.</span>
</span><span id="JSONTransformer-59"><a href="#JSONTransformer-59"><span class="linenos"> 59</span></a><span class="sd">        </span>
</span><span id="JSONTransformer-60"><a href="#JSONTransformer-60"><span class="linenos"> 60</span></a><span class="sd">        This method recursively traverses a nested JSON object and yields dictionaries containing the full key</span>
</span><span id="JSONTransformer-61"><a href="#JSONTransformer-61"><span class="linenos"> 61</span></a><span class="sd">        directory (as tuples) and their associated values. It handles dictionaries and lists within the JSON object.</span>
</span><span id="JSONTransformer-62"><a href="#JSONTransformer-62"><span class="linenos"> 62</span></a>
</span><span id="JSONTransformer-63"><a href="#JSONTransformer-63"><span class="linenos"> 63</span></a><span class="sd">        Example:</span>
</span><span id="JSONTransformer-64"><a href="#JSONTransformer-64"><span class="linenos"> 64</span></a><span class="sd">            Input JSON:</span>
</span><span id="JSONTransformer-65"><a href="#JSONTransformer-65"><span class="linenos"> 65</span></a><span class="sd">            ```json</span>
</span><span id="JSONTransformer-66"><a href="#JSONTransformer-66"><span class="linenos"> 66</span></a><span class="sd">            { &quot;a&quot;: </span>
</span><span id="JSONTransformer-67"><a href="#JSONTransformer-67"><span class="linenos"> 67</span></a><span class="sd">                { &quot;b&quot;:</span>
</span><span id="JSONTransformer-68"><a href="#JSONTransformer-68"><span class="linenos"> 68</span></a><span class="sd">                    [ { &quot;c&quot;: &quot;d&quot; }, { &quot;e&quot;: [1,2,3] } ]</span>
</span><span id="JSONTransformer-69"><a href="#JSONTransformer-69"><span class="linenos"> 69</span></a><span class="sd">                },</span>
</span><span id="JSONTransformer-70"><a href="#JSONTransformer-70"><span class="linenos"> 70</span></a><span class="sd">            &quot;x&quot;: { &quot;y&quot;: &quot;z&quot; }</span>
</span><span id="JSONTransformer-71"><a href="#JSONTransformer-71"><span class="linenos"> 71</span></a><span class="sd">            }</span>
</span><span id="JSONTransformer-72"><a href="#JSONTransformer-72"><span class="linenos"> 72</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer-73"><a href="#JSONTransformer-73"><span class="linenos"> 73</span></a><span class="sd">            Streaming key directories and values:</span>
</span><span id="JSONTransformer-74"><a href="#JSONTransformer-74"><span class="linenos"> 74</span></a><span class="sd">            ```python</span>
</span><span id="JSONTransformer-75"><a href="#JSONTransformer-75"><span class="linenos"> 75</span></a><span class="sd">            &gt;&gt;&gt; print(list(JSONTransformer._stream_json_data(json, tuple())))</span>
</span><span id="JSONTransformer-76"><a href="#JSONTransformer-76"><span class="linenos"> 76</span></a><span class="sd">            &gt;&gt;&gt; [{&quot;keys&quot;: (&quot;a&quot;, &quot;b&quot;, &quot;0&quot;, &quot;c&quot;), &quot;value&quot;: &quot;d&quot;},</span>
</span><span id="JSONTransformer-77"><a href="#JSONTransformer-77"><span class="linenos"> 77</span></a><span class="sd">            &gt;&gt;&gt;  {&quot;keys&quot;: (&quot;a&quot;, &quot;b&quot;, &quot;1&quot;, &quot;e&quot;, &quot;0&quot;), &quot;value&quot;: 1},</span>
</span><span id="JSONTransformer-78"><a href="#JSONTransformer-78"><span class="linenos"> 78</span></a><span class="sd">            &gt;&gt;&gt;  {&quot;keys&quot;: (&quot;a&quot;, &quot;b&quot;, &quot;1&quot;, &quot;e&quot;, &quot;1&quot;), &quot;value&quot;: 2},</span>
</span><span id="JSONTransformer-79"><a href="#JSONTransformer-79"><span class="linenos"> 79</span></a><span class="sd">            &gt;&gt;&gt;  {&quot;keys&quot;: (&quot;a&quot;, &quot;b&quot;, &quot;1&quot;, &quot;e&quot;, &quot;2&quot;), &quot;value&quot;: 3},</span>
</span><span id="JSONTransformer-80"><a href="#JSONTransformer-80"><span class="linenos"> 80</span></a><span class="sd">            &gt;&gt;&gt;  {&quot;keys&quot;: (&quot;x&quot;, &quot;y&quot;), &quot;value&quot;: &quot;z&quot;}]</span>
</span><span id="JSONTransformer-81"><a href="#JSONTransformer-81"><span class="linenos"> 81</span></a>
</span><span id="JSONTransformer-82"><a href="#JSONTransformer-82"><span class="linenos"> 82</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer-83"><a href="#JSONTransformer-83"><span class="linenos"> 83</span></a>
</span><span id="JSONTransformer-84"><a href="#JSONTransformer-84"><span class="linenos"> 84</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer-85"><a href="#JSONTransformer-85"><span class="linenos"> 85</span></a><span class="sd">            json (dict): The JSON object to stream.</span>
</span><span id="JSONTransformer-86"><a href="#JSONTransformer-86"><span class="linenos"> 86</span></a><span class="sd">            keys (tuple): The current list of keys being traversed.</span>
</span><span id="JSONTransformer-87"><a href="#JSONTransformer-87"><span class="linenos"> 87</span></a>
</span><span id="JSONTransformer-88"><a href="#JSONTransformer-88"><span class="linenos"> 88</span></a><span class="sd">        Yields:</span>
</span><span id="JSONTransformer-89"><a href="#JSONTransformer-89"><span class="linenos"> 89</span></a><span class="sd">            dict[str, Union[tuple | str]]: A dictionary containing the current key &quot;directory&quot; (as a tuple) and its associated value.</span>
</span><span id="JSONTransformer-90"><a href="#JSONTransformer-90"><span class="linenos"> 90</span></a>
</span><span id="JSONTransformer-91"><a href="#JSONTransformer-91"><span class="linenos"> 91</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer-92"><a href="#JSONTransformer-92"><span class="linenos"> 92</span></a><span class="sd">            Iterator[dict[str, Union[tuple | str]]]: An iterator that yields dictionaries with the current key &quot;directory&quot; and its associated value.</span>
</span><span id="JSONTransformer-93"><a href="#JSONTransformer-93"><span class="linenos"> 93</span></a>
</span><span id="JSONTransformer-94"><a href="#JSONTransformer-94"><span class="linenos"> 94</span></a><span class="sd">        Note:</span>
</span><span id="JSONTransformer-95"><a href="#JSONTransformer-95"><span class="linenos"> 95</span></a><span class="sd">            Tuples have been used instead of lists for the keys argument, for performance at the cost of readability of this function.</span>
</span><span id="JSONTransformer-96"><a href="#JSONTransformer-96"><span class="linenos"> 96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-97"><a href="#JSONTransformer-97"><span class="linenos"> 97</span></a>
</span><span id="JSONTransformer-98"><a href="#JSONTransformer-98"><span class="linenos"> 98</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="JSONTransformer-99"><a href="#JSONTransformer-99"><span class="linenos"> 99</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="JSONTransformer-100"><a href="#JSONTransformer-100"><span class="linenos">100</span></a>                <span class="c1"># If the value is another dictionary, recursively call this method</span>
</span><span id="JSONTransformer-101"><a href="#JSONTransformer-101"><span class="linenos">101</span></a>                <span class="c1"># with the updated keys &quot;list&quot;.</span>
</span><span id="JSONTransformer-102"><a href="#JSONTransformer-102"><span class="linenos">102</span></a>                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">_stream_json_data</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">keys</span> <span class="o">+</span> <span class="p">(</span><span class="n">key</span><span class="p">,)):</span>
</span><span id="JSONTransformer-103"><a href="#JSONTransformer-103"><span class="linenos">103</span></a>                    <span class="k">yield</span> <span class="n">result</span>
</span><span id="JSONTransformer-104"><a href="#JSONTransformer-104"><span class="linenos">104</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="JSONTransformer-105"><a href="#JSONTransformer-105"><span class="linenos">105</span></a>                <span class="c1"># If the value is a list, iterate through the list and recursively</span>
</span><span id="JSONTransformer-106"><a href="#JSONTransformer-106"><span class="linenos">106</span></a>                <span class="c1"># call this method with the updated keys &quot;list&quot; and index as an additional key.</span>
</span><span id="JSONTransformer-107"><a href="#JSONTransformer-107"><span class="linenos">107</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span id="JSONTransformer-108"><a href="#JSONTransformer-108"><span class="linenos">108</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="JSONTransformer-109"><a href="#JSONTransformer-109"><span class="linenos">109</span></a>                        <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;keys&#39;</span><span class="p">:</span> <span class="n">keys</span> <span class="o">+</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)),</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">}</span>
</span><span id="JSONTransformer-110"><a href="#JSONTransformer-110"><span class="linenos">110</span></a>                        <span class="k">continue</span>
</span><span id="JSONTransformer-111"><a href="#JSONTransformer-111"><span class="linenos">111</span></a>                        
</span><span id="JSONTransformer-112"><a href="#JSONTransformer-112"><span class="linenos">112</span></a>                    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">_stream_json_data</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">keys</span> <span class="o">+</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))):</span>
</span><span id="JSONTransformer-113"><a href="#JSONTransformer-113"><span class="linenos">113</span></a>                        <span class="k">yield</span> <span class="n">result</span>
</span><span id="JSONTransformer-114"><a href="#JSONTransformer-114"><span class="linenos">114</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="JSONTransformer-115"><a href="#JSONTransformer-115"><span class="linenos">115</span></a>                <span class="c1"># If the value is not a dictionary or list, yield a dictionary containing</span>
</span><span id="JSONTransformer-116"><a href="#JSONTransformer-116"><span class="linenos">116</span></a>                <span class="c1"># the current key &quot;list&quot; (as a tuple) and value.</span>
</span><span id="JSONTransformer-117"><a href="#JSONTransformer-117"><span class="linenos">117</span></a>                <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;keys&#39;</span><span class="p">:</span> <span class="n">keys</span> <span class="o">+</span> <span class="p">(</span><span class="n">key</span><span class="p">,),</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
</span><span id="JSONTransformer-118"><a href="#JSONTransformer-118"><span class="linenos">118</span></a>
</span><span id="JSONTransformer-119"><a href="#JSONTransformer-119"><span class="linenos">119</span></a>
</span><span id="JSONTransformer-120"><a href="#JSONTransformer-120"><span class="linenos">120</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer-121"><a href="#JSONTransformer-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">merge_on_key</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">list_2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="JSONTransformer-122"><a href="#JSONTransformer-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-123"><a href="#JSONTransformer-123"><span class="linenos">123</span></a><span class="sd">        Merges two lists of dictionaries into a single list, based on matching dictionary keys.</span>
</span><span id="JSONTransformer-124"><a href="#JSONTransformer-124"><span class="linenos">124</span></a>
</span><span id="JSONTransformer-125"><a href="#JSONTransformer-125"><span class="linenos">125</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer-126"><a href="#JSONTransformer-126"><span class="linenos">126</span></a><span class="sd">            key (str): The key to match the dictionaries on.</span>
</span><span id="JSONTransformer-127"><a href="#JSONTransformer-127"><span class="linenos">127</span></a><span class="sd">            list_1 (list[dict]): The first list of dictionaries.</span>
</span><span id="JSONTransformer-128"><a href="#JSONTransformer-128"><span class="linenos">128</span></a><span class="sd">            list_2 (list[dict]): The second list of dictionaries.</span>
</span><span id="JSONTransformer-129"><a href="#JSONTransformer-129"><span class="linenos">129</span></a>
</span><span id="JSONTransformer-130"><a href="#JSONTransformer-130"><span class="linenos">130</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer-131"><a href="#JSONTransformer-131"><span class="linenos">131</span></a><span class="sd">            list[dict]: A merged list of dictionaries containing merged disctionaries based on matching keys from both input lists.</span>
</span><span id="JSONTransformer-132"><a href="#JSONTransformer-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-133"><a href="#JSONTransformer-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">list_2</span><span class="p">:</span>
</span><span id="JSONTransformer-134"><a href="#JSONTransformer-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="JSONTransformer-135"><a href="#JSONTransformer-135"><span class="linenos">135</span></a>                <span class="sa">f</span><span class="s2">&quot;Cannot merge empty list(s).</span><span class="se">\n</span><span class="s2">list_1: length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_1</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">list_2: length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="JSONTransformer-136"><a href="#JSONTransformer-136"><span class="linenos">136</span></a>
</span><span id="JSONTransformer-137"><a href="#JSONTransformer-137"><span class="linenos">137</span></a>        <span class="c1"># Use list comprehension to merge dictionaries that have matching keys</span>
</span><span id="JSONTransformer-138"><a href="#JSONTransformer-138"><span class="linenos">138</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="JSONTransformer-139"><a href="#JSONTransformer-139"><span class="linenos">139</span></a>            <span class="nb">dict</span><span class="p">(</span><span class="n">item_1</span><span class="p">,</span> <span class="o">**</span><span class="n">item_2</span><span class="p">)</span>
</span><span id="JSONTransformer-140"><a href="#JSONTransformer-140"><span class="linenos">140</span></a>            <span class="k">for</span> <span class="n">item_1</span> <span class="ow">in</span> <span class="n">list_1</span>
</span><span id="JSONTransformer-141"><a href="#JSONTransformer-141"><span class="linenos">141</span></a>            <span class="k">for</span> <span class="n">item_2</span> <span class="ow">in</span> <span class="n">list_2</span>
</span><span id="JSONTransformer-142"><a href="#JSONTransformer-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="n">item_1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="JSONTransformer-143"><a href="#JSONTransformer-143"><span class="linenos">143</span></a>        <span class="p">]</span>
</span><span id="JSONTransformer-144"><a href="#JSONTransformer-144"><span class="linenos">144</span></a>
</span><span id="JSONTransformer-145"><a href="#JSONTransformer-145"><span class="linenos">145</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer-146"><a href="#JSONTransformer-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
</span><span id="JSONTransformer-147"><a href="#JSONTransformer-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-148"><a href="#JSONTransformer-148"><span class="linenos">148</span></a><span class="sd">        Flatten a nested JSON object into a dictionary with flattened keys.</span>
</span><span id="JSONTransformer-149"><a href="#JSONTransformer-149"><span class="linenos">149</span></a><span class="sd">        </span>
</span><span id="JSONTransformer-150"><a href="#JSONTransformer-150"><span class="linenos">150</span></a><span class="sd">        This method takes a nested JSON object and converts it into a dictionary with</span>
</span><span id="JSONTransformer-151"><a href="#JSONTransformer-151"><span class="linenos">151</span></a><span class="sd">        keys that represent the nested structure using a specified separator. Optionally,</span>
</span><span id="JSONTransformer-152"><a href="#JSONTransformer-152"><span class="linenos">152</span></a><span class="sd">        you can provide a list of keys to exclude or include in the resulting dictionary.</span>
</span><span id="JSONTransformer-153"><a href="#JSONTransformer-153"><span class="linenos">153</span></a>
</span><span id="JSONTransformer-154"><a href="#JSONTransformer-154"><span class="linenos">154</span></a><span class="sd">        Example:</span>
</span><span id="JSONTransformer-155"><a href="#JSONTransformer-155"><span class="linenos">155</span></a><span class="sd">            Input JSON:</span>
</span><span id="JSONTransformer-156"><a href="#JSONTransformer-156"><span class="linenos">156</span></a><span class="sd">            ```json</span>
</span><span id="JSONTransformer-157"><a href="#JSONTransformer-157"><span class="linenos">157</span></a><span class="sd">            { &quot;a&quot;: </span>
</span><span id="JSONTransformer-158"><a href="#JSONTransformer-158"><span class="linenos">158</span></a><span class="sd">                { &quot;b&quot;:</span>
</span><span id="JSONTransformer-159"><a href="#JSONTransformer-159"><span class="linenos">159</span></a><span class="sd">                    [ { &quot;c&quot;: &quot;d&quot; }, { &quot;e&quot;: [1,2,3] } ]</span>
</span><span id="JSONTransformer-160"><a href="#JSONTransformer-160"><span class="linenos">160</span></a><span class="sd">                },</span>
</span><span id="JSONTransformer-161"><a href="#JSONTransformer-161"><span class="linenos">161</span></a><span class="sd">                &quot;x&quot;: { &quot;y&quot;: &quot;z&quot; }</span>
</span><span id="JSONTransformer-162"><a href="#JSONTransformer-162"><span class="linenos">162</span></a><span class="sd">            }</span>
</span><span id="JSONTransformer-163"><a href="#JSONTransformer-163"><span class="linenos">163</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer-164"><a href="#JSONTransformer-164"><span class="linenos">164</span></a><span class="sd">            Flattening with a &quot;.&quot; separator:</span>
</span><span id="JSONTransformer-165"><a href="#JSONTransformer-165"><span class="linenos">165</span></a><span class="sd">            ```python</span>
</span><span id="JSONTransformer-166"><a href="#JSONTransformer-166"><span class="linenos">166</span></a><span class="sd">            &gt;&gt;&gt; print(JSONTransformer.flatten(json, &quot;.&quot;))</span>
</span><span id="JSONTransformer-167"><a href="#JSONTransformer-167"><span class="linenos">167</span></a><span class="sd">            &gt;&gt;&gt; {&quot;a.b.0.c&quot;: &quot;d&quot;,</span>
</span><span id="JSONTransformer-168"><a href="#JSONTransformer-168"><span class="linenos">168</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.0&quot;: 1,</span>
</span><span id="JSONTransformer-169"><a href="#JSONTransformer-169"><span class="linenos">169</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.1&quot;: 2,</span>
</span><span id="JSONTransformer-170"><a href="#JSONTransformer-170"><span class="linenos">170</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.2&quot;: 3,</span>
</span><span id="JSONTransformer-171"><a href="#JSONTransformer-171"><span class="linenos">171</span></a><span class="sd">            &gt;&gt;&gt;  &quot;x.y&quot;: &quot;z&quot;}</span>
</span><span id="JSONTransformer-172"><a href="#JSONTransformer-172"><span class="linenos">172</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer-173"><a href="#JSONTransformer-173"><span class="linenos">173</span></a><span class="sd">            Include and Exclude should be formatted with the complete nested key output in mind.</span>
</span><span id="JSONTransformer-174"><a href="#JSONTransformer-174"><span class="linenos">174</span></a><span class="sd">            </span>
</span><span id="JSONTransformer-175"><a href="#JSONTransformer-175"><span class="linenos">175</span></a><span class="sd">            e.g  `include=[&quot;a.b.0.c&quot;]`, returns `{&quot;a.b.0.c&quot;: &quot;d&quot;}` only.</span>
</span><span id="JSONTransformer-176"><a href="#JSONTransformer-176"><span class="linenos">176</span></a>
</span><span id="JSONTransformer-177"><a href="#JSONTransformer-177"><span class="linenos">177</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer-178"><a href="#JSONTransformer-178"><span class="linenos">178</span></a><span class="sd">            json (dict): The JSON object to flatten.</span>
</span><span id="JSONTransformer-179"><a href="#JSONTransformer-179"><span class="linenos">179</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="JSONTransformer-180"><a href="#JSONTransformer-180"><span class="linenos">180</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="JSONTransformer-181"><a href="#JSONTransformer-181"><span class="linenos">181</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="JSONTransformer-182"><a href="#JSONTransformer-182"><span class="linenos">182</span></a>
</span><span id="JSONTransformer-183"><a href="#JSONTransformer-183"><span class="linenos">183</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer-184"><a href="#JSONTransformer-184"><span class="linenos">184</span></a><span class="sd">            dict[str, str]: A flattened dictionary with keys representing the nested structure.</span>
</span><span id="JSONTransformer-185"><a href="#JSONTransformer-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-186"><a href="#JSONTransformer-186"><span class="linenos">186</span></a>
</span><span id="JSONTransformer-187"><a href="#JSONTransformer-187"><span class="linenos">187</span></a>        <span class="c1"># Stream the key-value pairs of the JSON object using the _stream_json_data method.</span>
</span><span id="JSONTransformer-188"><a href="#JSONTransformer-188"><span class="linenos">188</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="JSONTransformer-189"><a href="#JSONTransformer-189"><span class="linenos">189</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">_stream_json_data</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">()):</span>
</span><span id="JSONTransformer-190"><a href="#JSONTransformer-190"><span class="linenos">190</span></a>            <span class="n">keys</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">]</span>
</span><span id="JSONTransformer-191"><a href="#JSONTransformer-191"><span class="linenos">191</span></a>            <span class="n">key_str</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</span><span id="JSONTransformer-192"><a href="#JSONTransformer-192"><span class="linenos">192</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">exclude</span> <span class="ow">and</span> <span class="n">key_str</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">include</span> <span class="ow">and</span> <span class="n">key_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include</span><span class="p">):</span>
</span><span id="JSONTransformer-193"><a href="#JSONTransformer-193"><span class="linenos">193</span></a>                <span class="k">continue</span>
</span><span id="JSONTransformer-194"><a href="#JSONTransformer-194"><span class="linenos">194</span></a>            <span class="c1"># Check if the key string matches the specified key strings for content and title.</span>
</span><span id="JSONTransformer-195"><a href="#JSONTransformer-195"><span class="linenos">195</span></a>            <span class="c1"># If so, html.unescape the value, this is from Yotpo&#39;s side of things.</span>
</span><span id="JSONTransformer-196"><a href="#JSONTransformer-196"><span class="linenos">196</span></a>            <span class="c1"># This is done so NLTK is able to properly process the reviews.</span>
</span><span id="JSONTransformer-197"><a href="#JSONTransformer-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">key_str</span><span class="p">):</span>
</span><span id="JSONTransformer-198"><a href="#JSONTransformer-198"><span class="linenos">198</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">key_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">unescape</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
</span><span id="JSONTransformer-199"><a href="#JSONTransformer-199"><span class="linenos">199</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="JSONTransformer-200"><a href="#JSONTransformer-200"><span class="linenos">200</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">key_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="JSONTransformer-201"><a href="#JSONTransformer-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="JSONTransformer-202"><a href="#JSONTransformer-202"><span class="linenos">202</span></a>
</span><span id="JSONTransformer-203"><a href="#JSONTransformer-203"><span class="linenos">203</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer-204"><a href="#JSONTransformer-204"><span class="linenos">204</span></a>    <span class="k">def</span> <span class="nf">flatten_list</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]]:</span>
</span><span id="JSONTransformer-205"><a href="#JSONTransformer-205"><span class="linenos">205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-206"><a href="#JSONTransformer-206"><span class="linenos">206</span></a><span class="sd">        Flattens a list of JSON objects into a list of dictionaries with flattened keys.</span>
</span><span id="JSONTransformer-207"><a href="#JSONTransformer-207"><span class="linenos">207</span></a><span class="sd">        </span>
</span><span id="JSONTransformer-208"><a href="#JSONTransformer-208"><span class="linenos">208</span></a><span class="sd">        This method takes a list of nested JSON objects and converts each JSON object into a</span>
</span><span id="JSONTransformer-209"><a href="#JSONTransformer-209"><span class="linenos">209</span></a><span class="sd">        dictionary with keys representing the nested structure using a specified separator. </span>
</span><span id="JSONTransformer-210"><a href="#JSONTransformer-210"><span class="linenos">210</span></a><span class="sd">        Optionally, you can provide a list of keys to exclude or include in the resulting dictionaries.</span>
</span><span id="JSONTransformer-211"><a href="#JSONTransformer-211"><span class="linenos">211</span></a>
</span><span id="JSONTransformer-212"><a href="#JSONTransformer-212"><span class="linenos">212</span></a><span class="sd">        Example:</span>
</span><span id="JSONTransformer-213"><a href="#JSONTransformer-213"><span class="linenos">213</span></a><span class="sd">            Input JSON list:</span>
</span><span id="JSONTransformer-214"><a href="#JSONTransformer-214"><span class="linenos">214</span></a><span class="sd">            ```json</span>
</span><span id="JSONTransformer-215"><a href="#JSONTransformer-215"><span class="linenos">215</span></a><span class="sd">            [</span>
</span><span id="JSONTransformer-216"><a href="#JSONTransformer-216"><span class="linenos">216</span></a><span class="sd">                {</span>
</span><span id="JSONTransformer-217"><a href="#JSONTransformer-217"><span class="linenos">217</span></a><span class="sd">                    &quot;a&quot;: {&quot;b&quot;: {&quot;c&quot;: &quot;d&quot;}},</span>
</span><span id="JSONTransformer-218"><a href="#JSONTransformer-218"><span class="linenos">218</span></a><span class="sd">                    &quot;x&quot;: {&quot;y&quot;: &quot;z&quot;}</span>
</span><span id="JSONTransformer-219"><a href="#JSONTransformer-219"><span class="linenos">219</span></a><span class="sd">                },</span>
</span><span id="JSONTransformer-220"><a href="#JSONTransformer-220"><span class="linenos">220</span></a><span class="sd">                {</span>
</span><span id="JSONTransformer-221"><a href="#JSONTransformer-221"><span class="linenos">221</span></a><span class="sd">                    &quot;p&quot;: {&quot;q&quot;: {&quot;r&quot;: &quot;s&quot;}},</span>
</span><span id="JSONTransformer-222"><a href="#JSONTransformer-222"><span class="linenos">222</span></a><span class="sd">                    &quot;u&quot;: {&quot;v&quot;: &quot;w&quot;}</span>
</span><span id="JSONTransformer-223"><a href="#JSONTransformer-223"><span class="linenos">223</span></a><span class="sd">                }</span>
</span><span id="JSONTransformer-224"><a href="#JSONTransformer-224"><span class="linenos">224</span></a><span class="sd">            ]</span>
</span><span id="JSONTransformer-225"><a href="#JSONTransformer-225"><span class="linenos">225</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer-226"><a href="#JSONTransformer-226"><span class="linenos">226</span></a><span class="sd">            Flattening with a &quot;.&quot; separator:</span>
</span><span id="JSONTransformer-227"><a href="#JSONTransformer-227"><span class="linenos">227</span></a><span class="sd">            ```python</span>
</span><span id="JSONTransformer-228"><a href="#JSONTransformer-228"><span class="linenos">228</span></a><span class="sd">            &gt;&gt;&gt; print(JSONTransformer.flatten_list(json_list, &quot;.&quot;))</span>
</span><span id="JSONTransformer-229"><a href="#JSONTransformer-229"><span class="linenos">229</span></a><span class="sd">            &gt;&gt;&gt; [</span>
</span><span id="JSONTransformer-230"><a href="#JSONTransformer-230"><span class="linenos">230</span></a><span class="sd">            &gt;&gt;&gt;     {&quot;a.b.c&quot;: &quot;d&quot;, &quot;x.y&quot;: &quot;z&quot;},</span>
</span><span id="JSONTransformer-231"><a href="#JSONTransformer-231"><span class="linenos">231</span></a><span class="sd">            &gt;&gt;&gt;     {&quot;p.q.r&quot;: &quot;s&quot;, &quot;u.v&quot;: &quot;w&quot;}</span>
</span><span id="JSONTransformer-232"><a href="#JSONTransformer-232"><span class="linenos">232</span></a><span class="sd">            &gt;&gt;&gt; ]</span>
</span><span id="JSONTransformer-233"><a href="#JSONTransformer-233"><span class="linenos">233</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer-234"><a href="#JSONTransformer-234"><span class="linenos">234</span></a>
</span><span id="JSONTransformer-235"><a href="#JSONTransformer-235"><span class="linenos">235</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer-236"><a href="#JSONTransformer-236"><span class="linenos">236</span></a><span class="sd">            json_list (list[dict]): A list of JSON objects to flatten.</span>
</span><span id="JSONTransformer-237"><a href="#JSONTransformer-237"><span class="linenos">237</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="JSONTransformer-238"><a href="#JSONTransformer-238"><span class="linenos">238</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="JSONTransformer-239"><a href="#JSONTransformer-239"><span class="linenos">239</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="JSONTransformer-240"><a href="#JSONTransformer-240"><span class="linenos">240</span></a>
</span><span id="JSONTransformer-241"><a href="#JSONTransformer-241"><span class="linenos">241</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer-242"><a href="#JSONTransformer-242"><span class="linenos">242</span></a><span class="sd">            list[dict[str, any]]: A list of flattened dictionaries with keys representing the nested structure.</span>
</span><span id="JSONTransformer-243"><a href="#JSONTransformer-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-244"><a href="#JSONTransformer-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">JSONTransformer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">exclude</span><span class="p">,</span> <span class="n">include</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">json_list</span><span class="p">]</span>
</span><span id="JSONTransformer-245"><a href="#JSONTransformer-245"><span class="linenos">245</span></a>
</span><span id="JSONTransformer-246"><a href="#JSONTransformer-246"><span class="linenos">246</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer-247"><a href="#JSONTransformer-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="JSONTransformer-248"><a href="#JSONTransformer-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-249"><a href="#JSONTransformer-249"><span class="linenos">249</span></a><span class="sd">        Get a complete headers list from a list of JSON objects.</span>
</span><span id="JSONTransformer-250"><a href="#JSONTransformer-250"><span class="linenos">250</span></a>
</span><span id="JSONTransformer-251"><a href="#JSONTransformer-251"><span class="linenos">251</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer-252"><a href="#JSONTransformer-252"><span class="linenos">252</span></a><span class="sd">            json_list (list[dict]): A list of JSON objects to iterate over.</span>
</span><span id="JSONTransformer-253"><a href="#JSONTransformer-253"><span class="linenos">253</span></a>
</span><span id="JSONTransformer-254"><a href="#JSONTransformer-254"><span class="linenos">254</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer-255"><a href="#JSONTransformer-255"><span class="linenos">255</span></a><span class="sd">            set[str]: A set of headers.</span>
</span><span id="JSONTransformer-256"><a href="#JSONTransformer-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-257"><a href="#JSONTransformer-257"><span class="linenos">257</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">key</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">json_list</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span><span id="JSONTransformer-258"><a href="#JSONTransformer-258"><span class="linenos">258</span></a>
</span><span id="JSONTransformer-259"><a href="#JSONTransformer-259"><span class="linenos">259</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer-260"><a href="#JSONTransformer-260"><span class="linenos">260</span></a>    <span class="k">def</span> <span class="nf">from_bigquery_iterator</span><span class="p">(</span><span class="n">iterator</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">include</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
</span><span id="JSONTransformer-261"><a href="#JSONTransformer-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-262"><a href="#JSONTransformer-262"><span class="linenos">262</span></a><span class="sd">        Convert a BigQuery RowIterator into a set of headers and a list of rows.</span>
</span><span id="JSONTransformer-263"><a href="#JSONTransformer-263"><span class="linenos">263</span></a>
</span><span id="JSONTransformer-264"><a href="#JSONTransformer-264"><span class="linenos">264</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer-265"><a href="#JSONTransformer-265"><span class="linenos">265</span></a><span class="sd">            iterator (Iterator): A BigQuery RowIterator object.</span>
</span><span id="JSONTransformer-266"><a href="#JSONTransformer-266"><span class="linenos">266</span></a><span class="sd">            exclude (set[str], optional): A set of field names to exclude from the output. Defaults to an empty set.</span>
</span><span id="JSONTransformer-267"><a href="#JSONTransformer-267"><span class="linenos">267</span></a><span class="sd">            include (set[str], optional): A set of field names to include in the output. If provided, only these fields</span>
</span><span id="JSONTransformer-268"><a href="#JSONTransformer-268"><span class="linenos">268</span></a><span class="sd">                                          will be included. Defaults to an empty set.</span>
</span><span id="JSONTransformer-269"><a href="#JSONTransformer-269"><span class="linenos">269</span></a>
</span><span id="JSONTransformer-270"><a href="#JSONTransformer-270"><span class="linenos">270</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer-271"><a href="#JSONTransformer-271"><span class="linenos">271</span></a><span class="sd">            tuple[set, list]: A tuple containing a set of headers and a list of rows as dictionaries.</span>
</span><span id="JSONTransformer-272"><a href="#JSONTransformer-272"><span class="linenos">272</span></a><span class="sd">                              Headers are the field names included in the output, and rows are dictionaries</span>
</span><span id="JSONTransformer-273"><a href="#JSONTransformer-273"><span class="linenos">273</span></a><span class="sd">                              containing field values for each row in the RowIterator.</span>
</span><span id="JSONTransformer-274"><a href="#JSONTransformer-274"><span class="linenos">274</span></a>
</span><span id="JSONTransformer-275"><a href="#JSONTransformer-275"><span class="linenos">275</span></a><span class="sd">        Note:</span>
</span><span id="JSONTransformer-276"><a href="#JSONTransformer-276"><span class="linenos">276</span></a><span class="sd">            If both `exclude` and `include` are provided, the `include` set takes precedence.</span>
</span><span id="JSONTransformer-277"><a href="#JSONTransformer-277"><span class="linenos">277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-278"><a href="#JSONTransformer-278"><span class="linenos">278</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterator</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span id="JSONTransformer-279"><a href="#JSONTransformer-279"><span class="linenos">279</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">schema</span> <span class="k">if</span> <span class="p">(</span><span class="n">include</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">include</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">exclude</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)}</span>
</span><span id="JSONTransformer-280"><a href="#JSONTransformer-280"><span class="linenos">280</span></a>
</span><span id="JSONTransformer-281"><a href="#JSONTransformer-281"><span class="linenos">281</span></a>        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="JSONTransformer-282"><a href="#JSONTransformer-282"><span class="linenos">282</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
</span><span id="JSONTransformer-283"><a href="#JSONTransformer-283"><span class="linenos">283</span></a>            <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">schema</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span>
</span><span id="JSONTransformer-284"><a href="#JSONTransformer-284"><span class="linenos">284</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="JSONTransformer-285"><a href="#JSONTransformer-285"><span class="linenos">285</span></a>
</span><span id="JSONTransformer-286"><a href="#JSONTransformer-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>
</span><span id="JSONTransformer-287"><a href="#JSONTransformer-287"><span class="linenos">287</span></a>
</span><span id="JSONTransformer-288"><a href="#JSONTransformer-288"><span class="linenos">288</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer-289"><a href="#JSONTransformer-289"><span class="linenos">289</span></a>    <span class="k">def</span> <span class="nf">to_rows</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">]:</span>
</span><span id="JSONTransformer-290"><a href="#JSONTransformer-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-291"><a href="#JSONTransformer-291"><span class="linenos">291</span></a><span class="sd">        Flatten a list of JSON objects into a list of rows and a set of headers.</span>
</span><span id="JSONTransformer-292"><a href="#JSONTransformer-292"><span class="linenos">292</span></a><span class="sd">        </span>
</span><span id="JSONTransformer-293"><a href="#JSONTransformer-293"><span class="linenos">293</span></a><span class="sd">        This method takes a list of nested JSON objects and converts each JSON object into a</span>
</span><span id="JSONTransformer-294"><a href="#JSONTransformer-294"><span class="linenos">294</span></a><span class="sd">        dictionary with keys representing the nested structure using a specified separator. </span>
</span><span id="JSONTransformer-295"><a href="#JSONTransformer-295"><span class="linenos">295</span></a><span class="sd">        It then creates a list of rows, where each row contains the values from the flattened</span>
</span><span id="JSONTransformer-296"><a href="#JSONTransformer-296"><span class="linenos">296</span></a><span class="sd">        dictionaries, and a set of headers representing the unique keys of the flattened dictionaries.</span>
</span><span id="JSONTransformer-297"><a href="#JSONTransformer-297"><span class="linenos">297</span></a>
</span><span id="JSONTransformer-298"><a href="#JSONTransformer-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer-299"><a href="#JSONTransformer-299"><span class="linenos">299</span></a><span class="sd">            json_list (list[dict]): The list of JSON objects to flatten.</span>
</span><span id="JSONTransformer-300"><a href="#JSONTransformer-300"><span class="linenos">300</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="JSONTransformer-301"><a href="#JSONTransformer-301"><span class="linenos">301</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="JSONTransformer-302"><a href="#JSONTransformer-302"><span class="linenos">302</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="JSONTransformer-303"><a href="#JSONTransformer-303"><span class="linenos">303</span></a>
</span><span id="JSONTransformer-304"><a href="#JSONTransformer-304"><span class="linenos">304</span></a><span class="sd">        Note:</span>
</span><span id="JSONTransformer-305"><a href="#JSONTransformer-305"><span class="linenos">305</span></a><span class="sd">            If both exclude and include are specified, exclude takes precedence.</span>
</span><span id="JSONTransformer-306"><a href="#JSONTransformer-306"><span class="linenos">306</span></a><span class="sd">            This is done by using the following logic:</span>
</span><span id="JSONTransformer-307"><a href="#JSONTransformer-307"><span class="linenos">307</span></a><span class="sd">                ```</span>
</span><span id="JSONTransformer-308"><a href="#JSONTransformer-308"><span class="linenos">308</span></a><span class="sd">                if key_str in exclude or (include and key_str not in include):</span>
</span><span id="JSONTransformer-309"><a href="#JSONTransformer-309"><span class="linenos">309</span></a><span class="sd">                    continue</span>
</span><span id="JSONTransformer-310"><a href="#JSONTransformer-310"><span class="linenos">310</span></a><span class="sd">                ```</span>
</span><span id="JSONTransformer-311"><a href="#JSONTransformer-311"><span class="linenos">311</span></a>
</span><span id="JSONTransformer-312"><a href="#JSONTransformer-312"><span class="linenos">312</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer-313"><a href="#JSONTransformer-313"><span class="linenos">313</span></a><span class="sd">            tuple[list, set]: A tuple containing the list of rows and the set of headers.</span>
</span><span id="JSONTransformer-314"><a href="#JSONTransformer-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-315"><a href="#JSONTransformer-315"><span class="linenos">315</span></a>        <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="JSONTransformer-316"><a href="#JSONTransformer-316"><span class="linenos">316</span></a>        <span class="c1"># Flatten the JSON object into a list of dictionaries using the flatten method.</span>
</span><span id="JSONTransformer-317"><a href="#JSONTransformer-317"><span class="linenos">317</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">flatten_list</span><span class="p">(</span><span class="n">json_list</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">exclude</span><span class="p">,</span> <span class="n">include</span><span class="p">):</span>
</span><span id="JSONTransformer-318"><a href="#JSONTransformer-318"><span class="linenos">318</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="JSONTransformer-319"><a href="#JSONTransformer-319"><span class="linenos">319</span></a>            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="JSONTransformer-320"><a href="#JSONTransformer-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span>
</span><span id="JSONTransformer-321"><a href="#JSONTransformer-321"><span class="linenos">321</span></a>
</span><span id="JSONTransformer-322"><a href="#JSONTransformer-322"><span class="linenos">322</span></a>
</span><span id="JSONTransformer-323"><a href="#JSONTransformer-323"><span class="linenos">323</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer-324"><a href="#JSONTransformer-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="nf">to_csv_stringio</span><span class="p">(</span><span class="n">rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">headers</span><span class="p">:</span> <span class="nb">set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringIO</span><span class="p">:</span>
</span><span id="JSONTransformer-325"><a href="#JSONTransformer-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer-326"><a href="#JSONTransformer-326"><span class="linenos">326</span></a><span class="sd">        Convert a list of rows into a CSV formatted StringIO object.</span>
</span><span id="JSONTransformer-327"><a href="#JSONTransformer-327"><span class="linenos">327</span></a><span class="sd">        </span>
</span><span id="JSONTransformer-328"><a href="#JSONTransformer-328"><span class="linenos">328</span></a><span class="sd">        This method takes a list of rows (dictionaries) and a set of headers, and writes them into</span>
</span><span id="JSONTransformer-329"><a href="#JSONTransformer-329"><span class="linenos">329</span></a><span class="sd">        a CSV formatted StringIO object. It can be used to create a CSV file-like object without</span>
</span><span id="JSONTransformer-330"><a href="#JSONTransformer-330"><span class="linenos">330</span></a><span class="sd">        creating an actual file on the filesystem.</span>
</span><span id="JSONTransformer-331"><a href="#JSONTransformer-331"><span class="linenos">331</span></a>
</span><span id="JSONTransformer-332"><a href="#JSONTransformer-332"><span class="linenos">332</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer-333"><a href="#JSONTransformer-333"><span class="linenos">333</span></a><span class="sd">            rows (list[dict]): A list of rows to convert into a CSV formatted StringIO object.</span>
</span><span id="JSONTransformer-334"><a href="#JSONTransformer-334"><span class="linenos">334</span></a><span class="sd">            headers (set): A set of headers to use for the CSV data.</span>
</span><span id="JSONTransformer-335"><a href="#JSONTransformer-335"><span class="linenos">335</span></a>
</span><span id="JSONTransformer-336"><a href="#JSONTransformer-336"><span class="linenos">336</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer-337"><a href="#JSONTransformer-337"><span class="linenos">337</span></a><span class="sd">            StringIO: A CSV formatted StringIO object.</span>
</span><span id="JSONTransformer-338"><a href="#JSONTransformer-338"><span class="linenos">338</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer-339"><a href="#JSONTransformer-339"><span class="linenos">339</span></a>        <span class="c1"># Create a StringIO object to write the CSV data to.</span>
</span><span id="JSONTransformer-340"><a href="#JSONTransformer-340"><span class="linenos">340</span></a>        <span class="n">csv_stringio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="JSONTransformer-341"><a href="#JSONTransformer-341"><span class="linenos">341</span></a>        <span class="c1"># Create a csv writer and write the rows to the StringIO object.</span>
</span><span id="JSONTransformer-342"><a href="#JSONTransformer-342"><span class="linenos">342</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">DictWriter</span><span class="p">(</span><span class="n">csv_stringio</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span><span id="JSONTransformer-343"><a href="#JSONTransformer-343"><span class="linenos">343</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
</span><span id="JSONTransformer-344"><a href="#JSONTransformer-344"><span class="linenos">344</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</span><span id="JSONTransformer-345"><a href="#JSONTransformer-345"><span class="linenos">345</span></a>
</span><span id="JSONTransformer-346"><a href="#JSONTransformer-346"><span class="linenos">346</span></a>        <span class="c1"># Reset the StringIO object&#39;s position to the beginning</span>
</span><span id="JSONTransformer-347"><a href="#JSONTransformer-347"><span class="linenos">347</span></a>        <span class="n">csv_stringio</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="JSONTransformer-348"><a href="#JSONTransformer-348"><span class="linenos">348</span></a>
</span><span id="JSONTransformer-349"><a href="#JSONTransformer-349"><span class="linenos">349</span></a>        <span class="k">return</span> <span class="n">csv_stringio</span>
</span></pre></div>


            <div class="docstring"><p>A utility class for transforming JSON data into various formats.</p>
</div>


                            <div id="JSONTransformer.merge_on_key" class="classattr">
                                        <input id="JSONTransformer.merge_on_key-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">merge_on_key</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">key</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">list_1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>, </span><span class="param"><span class="n">list_2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="JSONTransformer.merge_on_key-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONTransformer.merge_on_key"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONTransformer.merge_on_key-120"><a href="#JSONTransformer.merge_on_key-120"><span class="linenos">120</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer.merge_on_key-121"><a href="#JSONTransformer.merge_on_key-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">merge_on_key</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_1</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">list_2</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="JSONTransformer.merge_on_key-122"><a href="#JSONTransformer.merge_on_key-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer.merge_on_key-123"><a href="#JSONTransformer.merge_on_key-123"><span class="linenos">123</span></a><span class="sd">        Merges two lists of dictionaries into a single list, based on matching dictionary keys.</span>
</span><span id="JSONTransformer.merge_on_key-124"><a href="#JSONTransformer.merge_on_key-124"><span class="linenos">124</span></a>
</span><span id="JSONTransformer.merge_on_key-125"><a href="#JSONTransformer.merge_on_key-125"><span class="linenos">125</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer.merge_on_key-126"><a href="#JSONTransformer.merge_on_key-126"><span class="linenos">126</span></a><span class="sd">            key (str): The key to match the dictionaries on.</span>
</span><span id="JSONTransformer.merge_on_key-127"><a href="#JSONTransformer.merge_on_key-127"><span class="linenos">127</span></a><span class="sd">            list_1 (list[dict]): The first list of dictionaries.</span>
</span><span id="JSONTransformer.merge_on_key-128"><a href="#JSONTransformer.merge_on_key-128"><span class="linenos">128</span></a><span class="sd">            list_2 (list[dict]): The second list of dictionaries.</span>
</span><span id="JSONTransformer.merge_on_key-129"><a href="#JSONTransformer.merge_on_key-129"><span class="linenos">129</span></a>
</span><span id="JSONTransformer.merge_on_key-130"><a href="#JSONTransformer.merge_on_key-130"><span class="linenos">130</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer.merge_on_key-131"><a href="#JSONTransformer.merge_on_key-131"><span class="linenos">131</span></a><span class="sd">            list[dict]: A merged list of dictionaries containing merged disctionaries based on matching keys from both input lists.</span>
</span><span id="JSONTransformer.merge_on_key-132"><a href="#JSONTransformer.merge_on_key-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer.merge_on_key-133"><a href="#JSONTransformer.merge_on_key-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">list_2</span><span class="p">:</span>
</span><span id="JSONTransformer.merge_on_key-134"><a href="#JSONTransformer.merge_on_key-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="JSONTransformer.merge_on_key-135"><a href="#JSONTransformer.merge_on_key-135"><span class="linenos">135</span></a>                <span class="sa">f</span><span class="s2">&quot;Cannot merge empty list(s).</span><span class="se">\n</span><span class="s2">list_1: length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_1</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">list_2: length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">list_2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="JSONTransformer.merge_on_key-136"><a href="#JSONTransformer.merge_on_key-136"><span class="linenos">136</span></a>
</span><span id="JSONTransformer.merge_on_key-137"><a href="#JSONTransformer.merge_on_key-137"><span class="linenos">137</span></a>        <span class="c1"># Use list comprehension to merge dictionaries that have matching keys</span>
</span><span id="JSONTransformer.merge_on_key-138"><a href="#JSONTransformer.merge_on_key-138"><span class="linenos">138</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="JSONTransformer.merge_on_key-139"><a href="#JSONTransformer.merge_on_key-139"><span class="linenos">139</span></a>            <span class="nb">dict</span><span class="p">(</span><span class="n">item_1</span><span class="p">,</span> <span class="o">**</span><span class="n">item_2</span><span class="p">)</span>
</span><span id="JSONTransformer.merge_on_key-140"><a href="#JSONTransformer.merge_on_key-140"><span class="linenos">140</span></a>            <span class="k">for</span> <span class="n">item_1</span> <span class="ow">in</span> <span class="n">list_1</span>
</span><span id="JSONTransformer.merge_on_key-141"><a href="#JSONTransformer.merge_on_key-141"><span class="linenos">141</span></a>            <span class="k">for</span> <span class="n">item_2</span> <span class="ow">in</span> <span class="n">list_2</span>
</span><span id="JSONTransformer.merge_on_key-142"><a href="#JSONTransformer.merge_on_key-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="n">item_1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">item_2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="JSONTransformer.merge_on_key-143"><a href="#JSONTransformer.merge_on_key-143"><span class="linenos">143</span></a>        <span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Merges two lists of dictionaries into a single list, based on matching dictionary keys.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>key (str):</strong>  The key to match the dictionaries on.</li>
<li><strong>list_1 (list[dict]):</strong>  The first list of dictionaries.</li>
<li><strong>list_2 (list[dict]):</strong>  The second list of dictionaries.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[dict]: A merged list of dictionaries containing merged disctionaries based on matching keys from both input lists.</p>
</blockquote>
</div>


                            </div>
                            <div id="JSONTransformer.flatten" class="classattr">
                                        <input id="JSONTransformer.flatten-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">flatten</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span>,</span><span class="param">	<span class="n">sep</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="JSONTransformer.flatten-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONTransformer.flatten"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONTransformer.flatten-145"><a href="#JSONTransformer.flatten-145"><span class="linenos">145</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer.flatten-146"><a href="#JSONTransformer.flatten-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
</span><span id="JSONTransformer.flatten-147"><a href="#JSONTransformer.flatten-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer.flatten-148"><a href="#JSONTransformer.flatten-148"><span class="linenos">148</span></a><span class="sd">        Flatten a nested JSON object into a dictionary with flattened keys.</span>
</span><span id="JSONTransformer.flatten-149"><a href="#JSONTransformer.flatten-149"><span class="linenos">149</span></a><span class="sd">        </span>
</span><span id="JSONTransformer.flatten-150"><a href="#JSONTransformer.flatten-150"><span class="linenos">150</span></a><span class="sd">        This method takes a nested JSON object and converts it into a dictionary with</span>
</span><span id="JSONTransformer.flatten-151"><a href="#JSONTransformer.flatten-151"><span class="linenos">151</span></a><span class="sd">        keys that represent the nested structure using a specified separator. Optionally,</span>
</span><span id="JSONTransformer.flatten-152"><a href="#JSONTransformer.flatten-152"><span class="linenos">152</span></a><span class="sd">        you can provide a list of keys to exclude or include in the resulting dictionary.</span>
</span><span id="JSONTransformer.flatten-153"><a href="#JSONTransformer.flatten-153"><span class="linenos">153</span></a>
</span><span id="JSONTransformer.flatten-154"><a href="#JSONTransformer.flatten-154"><span class="linenos">154</span></a><span class="sd">        Example:</span>
</span><span id="JSONTransformer.flatten-155"><a href="#JSONTransformer.flatten-155"><span class="linenos">155</span></a><span class="sd">            Input JSON:</span>
</span><span id="JSONTransformer.flatten-156"><a href="#JSONTransformer.flatten-156"><span class="linenos">156</span></a><span class="sd">            ```json</span>
</span><span id="JSONTransformer.flatten-157"><a href="#JSONTransformer.flatten-157"><span class="linenos">157</span></a><span class="sd">            { &quot;a&quot;: </span>
</span><span id="JSONTransformer.flatten-158"><a href="#JSONTransformer.flatten-158"><span class="linenos">158</span></a><span class="sd">                { &quot;b&quot;:</span>
</span><span id="JSONTransformer.flatten-159"><a href="#JSONTransformer.flatten-159"><span class="linenos">159</span></a><span class="sd">                    [ { &quot;c&quot;: &quot;d&quot; }, { &quot;e&quot;: [1,2,3] } ]</span>
</span><span id="JSONTransformer.flatten-160"><a href="#JSONTransformer.flatten-160"><span class="linenos">160</span></a><span class="sd">                },</span>
</span><span id="JSONTransformer.flatten-161"><a href="#JSONTransformer.flatten-161"><span class="linenos">161</span></a><span class="sd">                &quot;x&quot;: { &quot;y&quot;: &quot;z&quot; }</span>
</span><span id="JSONTransformer.flatten-162"><a href="#JSONTransformer.flatten-162"><span class="linenos">162</span></a><span class="sd">            }</span>
</span><span id="JSONTransformer.flatten-163"><a href="#JSONTransformer.flatten-163"><span class="linenos">163</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer.flatten-164"><a href="#JSONTransformer.flatten-164"><span class="linenos">164</span></a><span class="sd">            Flattening with a &quot;.&quot; separator:</span>
</span><span id="JSONTransformer.flatten-165"><a href="#JSONTransformer.flatten-165"><span class="linenos">165</span></a><span class="sd">            ```python</span>
</span><span id="JSONTransformer.flatten-166"><a href="#JSONTransformer.flatten-166"><span class="linenos">166</span></a><span class="sd">            &gt;&gt;&gt; print(JSONTransformer.flatten(json, &quot;.&quot;))</span>
</span><span id="JSONTransformer.flatten-167"><a href="#JSONTransformer.flatten-167"><span class="linenos">167</span></a><span class="sd">            &gt;&gt;&gt; {&quot;a.b.0.c&quot;: &quot;d&quot;,</span>
</span><span id="JSONTransformer.flatten-168"><a href="#JSONTransformer.flatten-168"><span class="linenos">168</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.0&quot;: 1,</span>
</span><span id="JSONTransformer.flatten-169"><a href="#JSONTransformer.flatten-169"><span class="linenos">169</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.1&quot;: 2,</span>
</span><span id="JSONTransformer.flatten-170"><a href="#JSONTransformer.flatten-170"><span class="linenos">170</span></a><span class="sd">            &gt;&gt;&gt;  &quot;a.b.1.e.2&quot;: 3,</span>
</span><span id="JSONTransformer.flatten-171"><a href="#JSONTransformer.flatten-171"><span class="linenos">171</span></a><span class="sd">            &gt;&gt;&gt;  &quot;x.y&quot;: &quot;z&quot;}</span>
</span><span id="JSONTransformer.flatten-172"><a href="#JSONTransformer.flatten-172"><span class="linenos">172</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer.flatten-173"><a href="#JSONTransformer.flatten-173"><span class="linenos">173</span></a><span class="sd">            Include and Exclude should be formatted with the complete nested key output in mind.</span>
</span><span id="JSONTransformer.flatten-174"><a href="#JSONTransformer.flatten-174"><span class="linenos">174</span></a><span class="sd">            </span>
</span><span id="JSONTransformer.flatten-175"><a href="#JSONTransformer.flatten-175"><span class="linenos">175</span></a><span class="sd">            e.g  `include=[&quot;a.b.0.c&quot;]`, returns `{&quot;a.b.0.c&quot;: &quot;d&quot;}` only.</span>
</span><span id="JSONTransformer.flatten-176"><a href="#JSONTransformer.flatten-176"><span class="linenos">176</span></a>
</span><span id="JSONTransformer.flatten-177"><a href="#JSONTransformer.flatten-177"><span class="linenos">177</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer.flatten-178"><a href="#JSONTransformer.flatten-178"><span class="linenos">178</span></a><span class="sd">            json (dict): The JSON object to flatten.</span>
</span><span id="JSONTransformer.flatten-179"><a href="#JSONTransformer.flatten-179"><span class="linenos">179</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="JSONTransformer.flatten-180"><a href="#JSONTransformer.flatten-180"><span class="linenos">180</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="JSONTransformer.flatten-181"><a href="#JSONTransformer.flatten-181"><span class="linenos">181</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="JSONTransformer.flatten-182"><a href="#JSONTransformer.flatten-182"><span class="linenos">182</span></a>
</span><span id="JSONTransformer.flatten-183"><a href="#JSONTransformer.flatten-183"><span class="linenos">183</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer.flatten-184"><a href="#JSONTransformer.flatten-184"><span class="linenos">184</span></a><span class="sd">            dict[str, str]: A flattened dictionary with keys representing the nested structure.</span>
</span><span id="JSONTransformer.flatten-185"><a href="#JSONTransformer.flatten-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer.flatten-186"><a href="#JSONTransformer.flatten-186"><span class="linenos">186</span></a>
</span><span id="JSONTransformer.flatten-187"><a href="#JSONTransformer.flatten-187"><span class="linenos">187</span></a>        <span class="c1"># Stream the key-value pairs of the JSON object using the _stream_json_data method.</span>
</span><span id="JSONTransformer.flatten-188"><a href="#JSONTransformer.flatten-188"><span class="linenos">188</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="JSONTransformer.flatten-189"><a href="#JSONTransformer.flatten-189"><span class="linenos">189</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">_stream_json_data</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">()):</span>
</span><span id="JSONTransformer.flatten-190"><a href="#JSONTransformer.flatten-190"><span class="linenos">190</span></a>            <span class="n">keys</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;keys&#39;</span><span class="p">]</span>
</span><span id="JSONTransformer.flatten-191"><a href="#JSONTransformer.flatten-191"><span class="linenos">191</span></a>            <span class="n">key_str</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</span><span id="JSONTransformer.flatten-192"><a href="#JSONTransformer.flatten-192"><span class="linenos">192</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">exclude</span> <span class="ow">and</span> <span class="n">key_str</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">include</span> <span class="ow">and</span> <span class="n">key_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include</span><span class="p">):</span>
</span><span id="JSONTransformer.flatten-193"><a href="#JSONTransformer.flatten-193"><span class="linenos">193</span></a>                <span class="k">continue</span>
</span><span id="JSONTransformer.flatten-194"><a href="#JSONTransformer.flatten-194"><span class="linenos">194</span></a>            <span class="c1"># Check if the key string matches the specified key strings for content and title.</span>
</span><span id="JSONTransformer.flatten-195"><a href="#JSONTransformer.flatten-195"><span class="linenos">195</span></a>            <span class="c1"># If so, html.unescape the value, this is from Yotpo&#39;s side of things.</span>
</span><span id="JSONTransformer.flatten-196"><a href="#JSONTransformer.flatten-196"><span class="linenos">196</span></a>            <span class="c1"># This is done so NLTK is able to properly process the reviews.</span>
</span><span id="JSONTransformer.flatten-197"><a href="#JSONTransformer.flatten-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">key_str</span><span class="p">):</span>
</span><span id="JSONTransformer.flatten-198"><a href="#JSONTransformer.flatten-198"><span class="linenos">198</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">key_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">unescape</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
</span><span id="JSONTransformer.flatten-199"><a href="#JSONTransformer.flatten-199"><span class="linenos">199</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="JSONTransformer.flatten-200"><a href="#JSONTransformer.flatten-200"><span class="linenos">200</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">key_str</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
</span><span id="JSONTransformer.flatten-201"><a href="#JSONTransformer.flatten-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Flatten a nested JSON object into a dictionary with flattened keys.</p>

<p>This method takes a nested JSON object and converts it into a dictionary with
keys that represent the nested structure using a specified separator. Optionally,
you can provide a list of keys to exclude or include in the resulting dictionary.</p>

<h6 id="example">Example:</h6>

<blockquote>
  <p>Input JSON:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">{</span><span class="w"> </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;b&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;c&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;e&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;z&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre>
  </div>
  
  <p>Flattening with a "." separator:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n"><a href="#JSONTransformer.flatten">JSONTransformer.flatten</a></span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">{</span><span class="s2">&quot;a.b.0.c&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s2">&quot;a.b.1.e.0&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s2">&quot;a.b.1.e.1&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s2">&quot;a.b.1.e.2&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>  <span class="s2">&quot;x.y&quot;</span><span class="p">:</span> <span class="s2">&quot;z&quot;</span><span class="p">}</span>
</code></pre>
  </div>
  
  <p>Include and Exclude should be formatted with the complete nested key output in mind.</p>
  
  <p>e.g  <code>include=["a.b.0.c"]</code>, returns <code>{"a.b.0.c": "d"}</code> only.</p>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>json (dict):</strong>  The JSON object to flatten.</li>
<li><strong>sep (str):</strong>  The separator to use for joining nested keys.</li>
<li><strong>exclude (list[str]):</strong>  If specified, exclude keys that match the specified keys and include all others.</li>
<li><strong>include (list[str]):</strong>  If specified, only include keys that match the specified keys.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict[str, str]: A flattened dictionary with keys representing the nested structure.</p>
</blockquote>
</div>


                            </div>
                            <div id="JSONTransformer.flatten_list" class="classattr">
                                        <input id="JSONTransformer.flatten_list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">flatten_list</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">sep</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="JSONTransformer.flatten_list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONTransformer.flatten_list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONTransformer.flatten_list-203"><a href="#JSONTransformer.flatten_list-203"><span class="linenos">203</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer.flatten_list-204"><a href="#JSONTransformer.flatten_list-204"><span class="linenos">204</span></a>    <span class="k">def</span> <span class="nf">flatten_list</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]]:</span>
</span><span id="JSONTransformer.flatten_list-205"><a href="#JSONTransformer.flatten_list-205"><span class="linenos">205</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer.flatten_list-206"><a href="#JSONTransformer.flatten_list-206"><span class="linenos">206</span></a><span class="sd">        Flattens a list of JSON objects into a list of dictionaries with flattened keys.</span>
</span><span id="JSONTransformer.flatten_list-207"><a href="#JSONTransformer.flatten_list-207"><span class="linenos">207</span></a><span class="sd">        </span>
</span><span id="JSONTransformer.flatten_list-208"><a href="#JSONTransformer.flatten_list-208"><span class="linenos">208</span></a><span class="sd">        This method takes a list of nested JSON objects and converts each JSON object into a</span>
</span><span id="JSONTransformer.flatten_list-209"><a href="#JSONTransformer.flatten_list-209"><span class="linenos">209</span></a><span class="sd">        dictionary with keys representing the nested structure using a specified separator. </span>
</span><span id="JSONTransformer.flatten_list-210"><a href="#JSONTransformer.flatten_list-210"><span class="linenos">210</span></a><span class="sd">        Optionally, you can provide a list of keys to exclude or include in the resulting dictionaries.</span>
</span><span id="JSONTransformer.flatten_list-211"><a href="#JSONTransformer.flatten_list-211"><span class="linenos">211</span></a>
</span><span id="JSONTransformer.flatten_list-212"><a href="#JSONTransformer.flatten_list-212"><span class="linenos">212</span></a><span class="sd">        Example:</span>
</span><span id="JSONTransformer.flatten_list-213"><a href="#JSONTransformer.flatten_list-213"><span class="linenos">213</span></a><span class="sd">            Input JSON list:</span>
</span><span id="JSONTransformer.flatten_list-214"><a href="#JSONTransformer.flatten_list-214"><span class="linenos">214</span></a><span class="sd">            ```json</span>
</span><span id="JSONTransformer.flatten_list-215"><a href="#JSONTransformer.flatten_list-215"><span class="linenos">215</span></a><span class="sd">            [</span>
</span><span id="JSONTransformer.flatten_list-216"><a href="#JSONTransformer.flatten_list-216"><span class="linenos">216</span></a><span class="sd">                {</span>
</span><span id="JSONTransformer.flatten_list-217"><a href="#JSONTransformer.flatten_list-217"><span class="linenos">217</span></a><span class="sd">                    &quot;a&quot;: {&quot;b&quot;: {&quot;c&quot;: &quot;d&quot;}},</span>
</span><span id="JSONTransformer.flatten_list-218"><a href="#JSONTransformer.flatten_list-218"><span class="linenos">218</span></a><span class="sd">                    &quot;x&quot;: {&quot;y&quot;: &quot;z&quot;}</span>
</span><span id="JSONTransformer.flatten_list-219"><a href="#JSONTransformer.flatten_list-219"><span class="linenos">219</span></a><span class="sd">                },</span>
</span><span id="JSONTransformer.flatten_list-220"><a href="#JSONTransformer.flatten_list-220"><span class="linenos">220</span></a><span class="sd">                {</span>
</span><span id="JSONTransformer.flatten_list-221"><a href="#JSONTransformer.flatten_list-221"><span class="linenos">221</span></a><span class="sd">                    &quot;p&quot;: {&quot;q&quot;: {&quot;r&quot;: &quot;s&quot;}},</span>
</span><span id="JSONTransformer.flatten_list-222"><a href="#JSONTransformer.flatten_list-222"><span class="linenos">222</span></a><span class="sd">                    &quot;u&quot;: {&quot;v&quot;: &quot;w&quot;}</span>
</span><span id="JSONTransformer.flatten_list-223"><a href="#JSONTransformer.flatten_list-223"><span class="linenos">223</span></a><span class="sd">                }</span>
</span><span id="JSONTransformer.flatten_list-224"><a href="#JSONTransformer.flatten_list-224"><span class="linenos">224</span></a><span class="sd">            ]</span>
</span><span id="JSONTransformer.flatten_list-225"><a href="#JSONTransformer.flatten_list-225"><span class="linenos">225</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer.flatten_list-226"><a href="#JSONTransformer.flatten_list-226"><span class="linenos">226</span></a><span class="sd">            Flattening with a &quot;.&quot; separator:</span>
</span><span id="JSONTransformer.flatten_list-227"><a href="#JSONTransformer.flatten_list-227"><span class="linenos">227</span></a><span class="sd">            ```python</span>
</span><span id="JSONTransformer.flatten_list-228"><a href="#JSONTransformer.flatten_list-228"><span class="linenos">228</span></a><span class="sd">            &gt;&gt;&gt; print(JSONTransformer.flatten_list(json_list, &quot;.&quot;))</span>
</span><span id="JSONTransformer.flatten_list-229"><a href="#JSONTransformer.flatten_list-229"><span class="linenos">229</span></a><span class="sd">            &gt;&gt;&gt; [</span>
</span><span id="JSONTransformer.flatten_list-230"><a href="#JSONTransformer.flatten_list-230"><span class="linenos">230</span></a><span class="sd">            &gt;&gt;&gt;     {&quot;a.b.c&quot;: &quot;d&quot;, &quot;x.y&quot;: &quot;z&quot;},</span>
</span><span id="JSONTransformer.flatten_list-231"><a href="#JSONTransformer.flatten_list-231"><span class="linenos">231</span></a><span class="sd">            &gt;&gt;&gt;     {&quot;p.q.r&quot;: &quot;s&quot;, &quot;u.v&quot;: &quot;w&quot;}</span>
</span><span id="JSONTransformer.flatten_list-232"><a href="#JSONTransformer.flatten_list-232"><span class="linenos">232</span></a><span class="sd">            &gt;&gt;&gt; ]</span>
</span><span id="JSONTransformer.flatten_list-233"><a href="#JSONTransformer.flatten_list-233"><span class="linenos">233</span></a><span class="sd">            ```</span>
</span><span id="JSONTransformer.flatten_list-234"><a href="#JSONTransformer.flatten_list-234"><span class="linenos">234</span></a>
</span><span id="JSONTransformer.flatten_list-235"><a href="#JSONTransformer.flatten_list-235"><span class="linenos">235</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer.flatten_list-236"><a href="#JSONTransformer.flatten_list-236"><span class="linenos">236</span></a><span class="sd">            json_list (list[dict]): A list of JSON objects to flatten.</span>
</span><span id="JSONTransformer.flatten_list-237"><a href="#JSONTransformer.flatten_list-237"><span class="linenos">237</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="JSONTransformer.flatten_list-238"><a href="#JSONTransformer.flatten_list-238"><span class="linenos">238</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="JSONTransformer.flatten_list-239"><a href="#JSONTransformer.flatten_list-239"><span class="linenos">239</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="JSONTransformer.flatten_list-240"><a href="#JSONTransformer.flatten_list-240"><span class="linenos">240</span></a>
</span><span id="JSONTransformer.flatten_list-241"><a href="#JSONTransformer.flatten_list-241"><span class="linenos">241</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer.flatten_list-242"><a href="#JSONTransformer.flatten_list-242"><span class="linenos">242</span></a><span class="sd">            list[dict[str, any]]: A list of flattened dictionaries with keys representing the nested structure.</span>
</span><span id="JSONTransformer.flatten_list-243"><a href="#JSONTransformer.flatten_list-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer.flatten_list-244"><a href="#JSONTransformer.flatten_list-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">JSONTransformer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">exclude</span><span class="p">,</span> <span class="n">include</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">json_list</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Flattens a list of JSON objects into a list of dictionaries with flattened keys.</p>

<p>This method takes a list of nested JSON objects and converts each JSON object into a
dictionary with keys representing the nested structure using a specified separator. 
Optionally, you can provide a list of keys to exclude or include in the resulting dictionaries.</p>

<h6 id="example">Example:</h6>

<blockquote>
  <p>Input JSON list:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;a&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;b&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;c&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="p">}},</span>
<span class="w">        </span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;z&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;p&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;q&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;r&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s&quot;</span><span class="p">}},</span>
<span class="w">        </span><span class="nt">&quot;u&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;v&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</code></pre>
  </div>
  
  <p>Flattening with a "." separator:</p>
  
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n"><a href="#JSONTransformer.flatten_list">JSONTransformer.flatten_list</a></span><span class="p">(</span><span class="n">json_list</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span><span class="s2">&quot;a.b.c&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;x.y&quot;</span><span class="p">:</span> <span class="s2">&quot;z&quot;</span><span class="p">},</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="p">{</span><span class="s2">&quot;p.q.r&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;u.v&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">]</span>
</code></pre>
  </div>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>json_list (list[dict]):</strong>  A list of JSON objects to flatten.</li>
<li><strong>sep (str):</strong>  The separator to use for joining nested keys.</li>
<li><strong>exclude (list[str]):</strong>  If specified, exclude keys that match the specified keys and include all others.</li>
<li><strong>include (list[str]):</strong>  If specified, only include keys that match the specified keys.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[dict[str, any]]: A list of flattened dictionaries with keys representing the nested structure.</p>
</blockquote>
</div>


                            </div>
                            <div id="JSONTransformer.get_headers" class="classattr">
                                        <input id="JSONTransformer.get_headers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_headers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="JSONTransformer.get_headers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONTransformer.get_headers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONTransformer.get_headers-246"><a href="#JSONTransformer.get_headers-246"><span class="linenos">246</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer.get_headers-247"><a href="#JSONTransformer.get_headers-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="JSONTransformer.get_headers-248"><a href="#JSONTransformer.get_headers-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer.get_headers-249"><a href="#JSONTransformer.get_headers-249"><span class="linenos">249</span></a><span class="sd">        Get a complete headers list from a list of JSON objects.</span>
</span><span id="JSONTransformer.get_headers-250"><a href="#JSONTransformer.get_headers-250"><span class="linenos">250</span></a>
</span><span id="JSONTransformer.get_headers-251"><a href="#JSONTransformer.get_headers-251"><span class="linenos">251</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer.get_headers-252"><a href="#JSONTransformer.get_headers-252"><span class="linenos">252</span></a><span class="sd">            json_list (list[dict]): A list of JSON objects to iterate over.</span>
</span><span id="JSONTransformer.get_headers-253"><a href="#JSONTransformer.get_headers-253"><span class="linenos">253</span></a>
</span><span id="JSONTransformer.get_headers-254"><a href="#JSONTransformer.get_headers-254"><span class="linenos">254</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer.get_headers-255"><a href="#JSONTransformer.get_headers-255"><span class="linenos">255</span></a><span class="sd">            set[str]: A set of headers.</span>
</span><span id="JSONTransformer.get_headers-256"><a href="#JSONTransformer.get_headers-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer.get_headers-257"><a href="#JSONTransformer.get_headers-257"><span class="linenos">257</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">key</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">json_list</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span></pre></div>


            <div class="docstring"><p>Get a complete headers list from a list of JSON objects.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>json_list (list[dict]):</strong>  A list of JSON objects to iterate over.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>set[str]: A set of headers.</p>
</blockquote>
</div>


                            </div>
                            <div id="JSONTransformer.from_bigquery_iterator" class="classattr">
                                        <input id="JSONTransformer.from_bigquery_iterator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">from_bigquery_iterator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">iterator</span><span class="p">:</span> <span class="n">Iterator</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>,</span><span class="param">	<span class="n">include</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="JSONTransformer.from_bigquery_iterator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONTransformer.from_bigquery_iterator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONTransformer.from_bigquery_iterator-259"><a href="#JSONTransformer.from_bigquery_iterator-259"><span class="linenos">259</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer.from_bigquery_iterator-260"><a href="#JSONTransformer.from_bigquery_iterator-260"><span class="linenos">260</span></a>    <span class="k">def</span> <span class="nf">from_bigquery_iterator</span><span class="p">(</span><span class="n">iterator</span><span class="p">:</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">include</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
</span><span id="JSONTransformer.from_bigquery_iterator-261"><a href="#JSONTransformer.from_bigquery_iterator-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer.from_bigquery_iterator-262"><a href="#JSONTransformer.from_bigquery_iterator-262"><span class="linenos">262</span></a><span class="sd">        Convert a BigQuery RowIterator into a set of headers and a list of rows.</span>
</span><span id="JSONTransformer.from_bigquery_iterator-263"><a href="#JSONTransformer.from_bigquery_iterator-263"><span class="linenos">263</span></a>
</span><span id="JSONTransformer.from_bigquery_iterator-264"><a href="#JSONTransformer.from_bigquery_iterator-264"><span class="linenos">264</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer.from_bigquery_iterator-265"><a href="#JSONTransformer.from_bigquery_iterator-265"><span class="linenos">265</span></a><span class="sd">            iterator (Iterator): A BigQuery RowIterator object.</span>
</span><span id="JSONTransformer.from_bigquery_iterator-266"><a href="#JSONTransformer.from_bigquery_iterator-266"><span class="linenos">266</span></a><span class="sd">            exclude (set[str], optional): A set of field names to exclude from the output. Defaults to an empty set.</span>
</span><span id="JSONTransformer.from_bigquery_iterator-267"><a href="#JSONTransformer.from_bigquery_iterator-267"><span class="linenos">267</span></a><span class="sd">            include (set[str], optional): A set of field names to include in the output. If provided, only these fields</span>
</span><span id="JSONTransformer.from_bigquery_iterator-268"><a href="#JSONTransformer.from_bigquery_iterator-268"><span class="linenos">268</span></a><span class="sd">                                          will be included. Defaults to an empty set.</span>
</span><span id="JSONTransformer.from_bigquery_iterator-269"><a href="#JSONTransformer.from_bigquery_iterator-269"><span class="linenos">269</span></a>
</span><span id="JSONTransformer.from_bigquery_iterator-270"><a href="#JSONTransformer.from_bigquery_iterator-270"><span class="linenos">270</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer.from_bigquery_iterator-271"><a href="#JSONTransformer.from_bigquery_iterator-271"><span class="linenos">271</span></a><span class="sd">            tuple[set, list]: A tuple containing a set of headers and a list of rows as dictionaries.</span>
</span><span id="JSONTransformer.from_bigquery_iterator-272"><a href="#JSONTransformer.from_bigquery_iterator-272"><span class="linenos">272</span></a><span class="sd">                              Headers are the field names included in the output, and rows are dictionaries</span>
</span><span id="JSONTransformer.from_bigquery_iterator-273"><a href="#JSONTransformer.from_bigquery_iterator-273"><span class="linenos">273</span></a><span class="sd">                              containing field values for each row in the RowIterator.</span>
</span><span id="JSONTransformer.from_bigquery_iterator-274"><a href="#JSONTransformer.from_bigquery_iterator-274"><span class="linenos">274</span></a>
</span><span id="JSONTransformer.from_bigquery_iterator-275"><a href="#JSONTransformer.from_bigquery_iterator-275"><span class="linenos">275</span></a><span class="sd">        Note:</span>
</span><span id="JSONTransformer.from_bigquery_iterator-276"><a href="#JSONTransformer.from_bigquery_iterator-276"><span class="linenos">276</span></a><span class="sd">            If both `exclude` and `include` are provided, the `include` set takes precedence.</span>
</span><span id="JSONTransformer.from_bigquery_iterator-277"><a href="#JSONTransformer.from_bigquery_iterator-277"><span class="linenos">277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer.from_bigquery_iterator-278"><a href="#JSONTransformer.from_bigquery_iterator-278"><span class="linenos">278</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iterator</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span id="JSONTransformer.from_bigquery_iterator-279"><a href="#JSONTransformer.from_bigquery_iterator-279"><span class="linenos">279</span></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">schema</span> <span class="k">if</span> <span class="p">(</span><span class="n">include</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">include</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">exclude</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)}</span>
</span><span id="JSONTransformer.from_bigquery_iterator-280"><a href="#JSONTransformer.from_bigquery_iterator-280"><span class="linenos">280</span></a>
</span><span id="JSONTransformer.from_bigquery_iterator-281"><a href="#JSONTransformer.from_bigquery_iterator-281"><span class="linenos">281</span></a>        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="JSONTransformer.from_bigquery_iterator-282"><a href="#JSONTransformer.from_bigquery_iterator-282"><span class="linenos">282</span></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
</span><span id="JSONTransformer.from_bigquery_iterator-283"><a href="#JSONTransformer.from_bigquery_iterator-283"><span class="linenos">283</span></a>            <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">schema</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span>
</span><span id="JSONTransformer.from_bigquery_iterator-284"><a href="#JSONTransformer.from_bigquery_iterator-284"><span class="linenos">284</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="JSONTransformer.from_bigquery_iterator-285"><a href="#JSONTransformer.from_bigquery_iterator-285"><span class="linenos">285</span></a>
</span><span id="JSONTransformer.from_bigquery_iterator-286"><a href="#JSONTransformer.from_bigquery_iterator-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>
</span></pre></div>


            <div class="docstring"><p>Convert a BigQuery RowIterator into a set of headers and a list of rows.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>iterator (Iterator):</strong>  A BigQuery RowIterator object.</li>
<li><strong>exclude (set[str], optional):</strong>  A set of field names to exclude from the output. Defaults to an empty set.</li>
<li><strong>include (set[str], optional):</strong>  A set of field names to include in the output. If provided, only these fields
will be included. Defaults to an empty set.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple[set, list]: A tuple containing a set of headers and a list of rows as dictionaries.
                    Headers are the field names included in the output, and rows are dictionaries
                    containing field values for each row in the RowIterator.</p>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>If both <code>exclude</code> and <code>include</code> are provided, the <code>include</code> set takes precedence.</p>
</blockquote>
</div>


                            </div>
                            <div id="JSONTransformer.to_rows" class="classattr">
                                        <input id="JSONTransformer.to_rows-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">to_rows</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">sep</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="JSONTransformer.to_rows-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONTransformer.to_rows"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONTransformer.to_rows-288"><a href="#JSONTransformer.to_rows-288"><span class="linenos">288</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer.to_rows-289"><a href="#JSONTransformer.to_rows-289"><span class="linenos">289</span></a>    <span class="k">def</span> <span class="nf">to_rows</span><span class="p">(</span><span class="n">json_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">sep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">]:</span>
</span><span id="JSONTransformer.to_rows-290"><a href="#JSONTransformer.to_rows-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer.to_rows-291"><a href="#JSONTransformer.to_rows-291"><span class="linenos">291</span></a><span class="sd">        Flatten a list of JSON objects into a list of rows and a set of headers.</span>
</span><span id="JSONTransformer.to_rows-292"><a href="#JSONTransformer.to_rows-292"><span class="linenos">292</span></a><span class="sd">        </span>
</span><span id="JSONTransformer.to_rows-293"><a href="#JSONTransformer.to_rows-293"><span class="linenos">293</span></a><span class="sd">        This method takes a list of nested JSON objects and converts each JSON object into a</span>
</span><span id="JSONTransformer.to_rows-294"><a href="#JSONTransformer.to_rows-294"><span class="linenos">294</span></a><span class="sd">        dictionary with keys representing the nested structure using a specified separator. </span>
</span><span id="JSONTransformer.to_rows-295"><a href="#JSONTransformer.to_rows-295"><span class="linenos">295</span></a><span class="sd">        It then creates a list of rows, where each row contains the values from the flattened</span>
</span><span id="JSONTransformer.to_rows-296"><a href="#JSONTransformer.to_rows-296"><span class="linenos">296</span></a><span class="sd">        dictionaries, and a set of headers representing the unique keys of the flattened dictionaries.</span>
</span><span id="JSONTransformer.to_rows-297"><a href="#JSONTransformer.to_rows-297"><span class="linenos">297</span></a>
</span><span id="JSONTransformer.to_rows-298"><a href="#JSONTransformer.to_rows-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer.to_rows-299"><a href="#JSONTransformer.to_rows-299"><span class="linenos">299</span></a><span class="sd">            json_list (list[dict]): The list of JSON objects to flatten.</span>
</span><span id="JSONTransformer.to_rows-300"><a href="#JSONTransformer.to_rows-300"><span class="linenos">300</span></a><span class="sd">            sep (str): The separator to use for joining nested keys.</span>
</span><span id="JSONTransformer.to_rows-301"><a href="#JSONTransformer.to_rows-301"><span class="linenos">301</span></a><span class="sd">            exclude (list[str]): If specified, exclude keys that match the specified keys and include all others.</span>
</span><span id="JSONTransformer.to_rows-302"><a href="#JSONTransformer.to_rows-302"><span class="linenos">302</span></a><span class="sd">            include (list[str]): If specified, only include keys that match the specified keys.</span>
</span><span id="JSONTransformer.to_rows-303"><a href="#JSONTransformer.to_rows-303"><span class="linenos">303</span></a>
</span><span id="JSONTransformer.to_rows-304"><a href="#JSONTransformer.to_rows-304"><span class="linenos">304</span></a><span class="sd">        Note:</span>
</span><span id="JSONTransformer.to_rows-305"><a href="#JSONTransformer.to_rows-305"><span class="linenos">305</span></a><span class="sd">            If both exclude and include are specified, exclude takes precedence.</span>
</span><span id="JSONTransformer.to_rows-306"><a href="#JSONTransformer.to_rows-306"><span class="linenos">306</span></a><span class="sd">            This is done by using the following logic:</span>
</span><span id="JSONTransformer.to_rows-307"><a href="#JSONTransformer.to_rows-307"><span class="linenos">307</span></a><span class="sd">                ```</span>
</span><span id="JSONTransformer.to_rows-308"><a href="#JSONTransformer.to_rows-308"><span class="linenos">308</span></a><span class="sd">                if key_str in exclude or (include and key_str not in include):</span>
</span><span id="JSONTransformer.to_rows-309"><a href="#JSONTransformer.to_rows-309"><span class="linenos">309</span></a><span class="sd">                    continue</span>
</span><span id="JSONTransformer.to_rows-310"><a href="#JSONTransformer.to_rows-310"><span class="linenos">310</span></a><span class="sd">                ```</span>
</span><span id="JSONTransformer.to_rows-311"><a href="#JSONTransformer.to_rows-311"><span class="linenos">311</span></a>
</span><span id="JSONTransformer.to_rows-312"><a href="#JSONTransformer.to_rows-312"><span class="linenos">312</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer.to_rows-313"><a href="#JSONTransformer.to_rows-313"><span class="linenos">313</span></a><span class="sd">            tuple[list, set]: A tuple containing the list of rows and the set of headers.</span>
</span><span id="JSONTransformer.to_rows-314"><a href="#JSONTransformer.to_rows-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer.to_rows-315"><a href="#JSONTransformer.to_rows-315"><span class="linenos">315</span></a>        <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="p">[],</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="JSONTransformer.to_rows-316"><a href="#JSONTransformer.to_rows-316"><span class="linenos">316</span></a>        <span class="c1"># Flatten the JSON object into a list of dictionaries using the flatten method.</span>
</span><span id="JSONTransformer.to_rows-317"><a href="#JSONTransformer.to_rows-317"><span class="linenos">317</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">flatten_list</span><span class="p">(</span><span class="n">json_list</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">exclude</span><span class="p">,</span> <span class="n">include</span><span class="p">):</span>
</span><span id="JSONTransformer.to_rows-318"><a href="#JSONTransformer.to_rows-318"><span class="linenos">318</span></a>            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="JSONTransformer.to_rows-319"><a href="#JSONTransformer.to_rows-319"><span class="linenos">319</span></a>            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="JSONTransformer.to_rows-320"><a href="#JSONTransformer.to_rows-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span>
</span></pre></div>


            <div class="docstring"><p>Flatten a list of JSON objects into a list of rows and a set of headers.</p>

<p>This method takes a list of nested JSON objects and converts each JSON object into a
dictionary with keys representing the nested structure using a specified separator. 
It then creates a list of rows, where each row contains the values from the flattened
dictionaries, and a set of headers representing the unique keys of the flattened dictionaries.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>json_list (list[dict]):</strong>  The list of JSON objects to flatten.</li>
<li><strong>sep (str):</strong>  The separator to use for joining nested keys.</li>
<li><strong>exclude (list[str]):</strong>  If specified, exclude keys that match the specified keys and include all others.</li>
<li><strong>include (list[str]):</strong>  If specified, only include keys that match the specified keys.</li>
</ul>

<h6 id="note">Note:</h6>

<blockquote>
  <p>If both exclude and include are specified, exclude takes precedence.
  This is done by using the following logic:
    <pre><code>if key_str in exclude or (include and key_str not in include):
    continue
</code></pre></p>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple[list, set]: A tuple containing the list of rows and the set of headers.</p>
</blockquote>
</div>


                            </div>
                            <div id="JSONTransformer.to_csv_stringio" class="classattr">
                                        <input id="JSONTransformer.to_csv_stringio-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">to_csv_stringio</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>, </span><span class="param"><span class="n">headers</span><span class="p">:</span> <span class="nb">set</span></span><span class="return-annotation">) -> <span class="n">_io</span><span class="o">.</span><span class="n">StringIO</span>:</span></span>

                <label class="view-source-button" for="JSONTransformer.to_csv_stringio-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JSONTransformer.to_csv_stringio"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JSONTransformer.to_csv_stringio-323"><a href="#JSONTransformer.to_csv_stringio-323"><span class="linenos">323</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JSONTransformer.to_csv_stringio-324"><a href="#JSONTransformer.to_csv_stringio-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="nf">to_csv_stringio</span><span class="p">(</span><span class="n">rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">headers</span><span class="p">:</span> <span class="nb">set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StringIO</span><span class="p">:</span>
</span><span id="JSONTransformer.to_csv_stringio-325"><a href="#JSONTransformer.to_csv_stringio-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="JSONTransformer.to_csv_stringio-326"><a href="#JSONTransformer.to_csv_stringio-326"><span class="linenos">326</span></a><span class="sd">        Convert a list of rows into a CSV formatted StringIO object.</span>
</span><span id="JSONTransformer.to_csv_stringio-327"><a href="#JSONTransformer.to_csv_stringio-327"><span class="linenos">327</span></a><span class="sd">        </span>
</span><span id="JSONTransformer.to_csv_stringio-328"><a href="#JSONTransformer.to_csv_stringio-328"><span class="linenos">328</span></a><span class="sd">        This method takes a list of rows (dictionaries) and a set of headers, and writes them into</span>
</span><span id="JSONTransformer.to_csv_stringio-329"><a href="#JSONTransformer.to_csv_stringio-329"><span class="linenos">329</span></a><span class="sd">        a CSV formatted StringIO object. It can be used to create a CSV file-like object without</span>
</span><span id="JSONTransformer.to_csv_stringio-330"><a href="#JSONTransformer.to_csv_stringio-330"><span class="linenos">330</span></a><span class="sd">        creating an actual file on the filesystem.</span>
</span><span id="JSONTransformer.to_csv_stringio-331"><a href="#JSONTransformer.to_csv_stringio-331"><span class="linenos">331</span></a>
</span><span id="JSONTransformer.to_csv_stringio-332"><a href="#JSONTransformer.to_csv_stringio-332"><span class="linenos">332</span></a><span class="sd">        Args:</span>
</span><span id="JSONTransformer.to_csv_stringio-333"><a href="#JSONTransformer.to_csv_stringio-333"><span class="linenos">333</span></a><span class="sd">            rows (list[dict]): A list of rows to convert into a CSV formatted StringIO object.</span>
</span><span id="JSONTransformer.to_csv_stringio-334"><a href="#JSONTransformer.to_csv_stringio-334"><span class="linenos">334</span></a><span class="sd">            headers (set): A set of headers to use for the CSV data.</span>
</span><span id="JSONTransformer.to_csv_stringio-335"><a href="#JSONTransformer.to_csv_stringio-335"><span class="linenos">335</span></a>
</span><span id="JSONTransformer.to_csv_stringio-336"><a href="#JSONTransformer.to_csv_stringio-336"><span class="linenos">336</span></a><span class="sd">        Returns:</span>
</span><span id="JSONTransformer.to_csv_stringio-337"><a href="#JSONTransformer.to_csv_stringio-337"><span class="linenos">337</span></a><span class="sd">            StringIO: A CSV formatted StringIO object.</span>
</span><span id="JSONTransformer.to_csv_stringio-338"><a href="#JSONTransformer.to_csv_stringio-338"><span class="linenos">338</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JSONTransformer.to_csv_stringio-339"><a href="#JSONTransformer.to_csv_stringio-339"><span class="linenos">339</span></a>        <span class="c1"># Create a StringIO object to write the CSV data to.</span>
</span><span id="JSONTransformer.to_csv_stringio-340"><a href="#JSONTransformer.to_csv_stringio-340"><span class="linenos">340</span></a>        <span class="n">csv_stringio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
</span><span id="JSONTransformer.to_csv_stringio-341"><a href="#JSONTransformer.to_csv_stringio-341"><span class="linenos">341</span></a>        <span class="c1"># Create a csv writer and write the rows to the StringIO object.</span>
</span><span id="JSONTransformer.to_csv_stringio-342"><a href="#JSONTransformer.to_csv_stringio-342"><span class="linenos">342</span></a>        <span class="n">writer</span> <span class="o">=</span> <span class="n">DictWriter</span><span class="p">(</span><span class="n">csv_stringio</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span><span id="JSONTransformer.to_csv_stringio-343"><a href="#JSONTransformer.to_csv_stringio-343"><span class="linenos">343</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
</span><span id="JSONTransformer.to_csv_stringio-344"><a href="#JSONTransformer.to_csv_stringio-344"><span class="linenos">344</span></a>        <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</span><span id="JSONTransformer.to_csv_stringio-345"><a href="#JSONTransformer.to_csv_stringio-345"><span class="linenos">345</span></a>
</span><span id="JSONTransformer.to_csv_stringio-346"><a href="#JSONTransformer.to_csv_stringio-346"><span class="linenos">346</span></a>        <span class="c1"># Reset the StringIO object&#39;s position to the beginning</span>
</span><span id="JSONTransformer.to_csv_stringio-347"><a href="#JSONTransformer.to_csv_stringio-347"><span class="linenos">347</span></a>        <span class="n">csv_stringio</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="JSONTransformer.to_csv_stringio-348"><a href="#JSONTransformer.to_csv_stringio-348"><span class="linenos">348</span></a>
</span><span id="JSONTransformer.to_csv_stringio-349"><a href="#JSONTransformer.to_csv_stringio-349"><span class="linenos">349</span></a>        <span class="k">return</span> <span class="n">csv_stringio</span>
</span></pre></div>


            <div class="docstring"><p>Convert a list of rows into a CSV formatted StringIO object.</p>

<p>This method takes a list of rows (dictionaries) and a set of headers, and writes them into
a CSV formatted StringIO object. It can be used to create a CSV file-like object without
creating an actual file on the filesystem.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rows (list[dict]):</strong>  A list of rows to convert into a CSV formatted StringIO object.</li>
<li><strong>headers (set):</strong>  A set of headers to use for the CSV data.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>StringIO: A CSV formatted StringIO object.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="YotpoAPIWrapper">
                            <input id="YotpoAPIWrapper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">YotpoAPIWrapper</span>:

                <label class="view-source-button" for="YotpoAPIWrapper-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper-352"><a href="#YotpoAPIWrapper-352"><span class="linenos">352</span></a><span class="k">class</span> <span class="nc">YotpoAPIWrapper</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-353"><a href="#YotpoAPIWrapper-353"><span class="linenos">353</span></a>    <span class="c1">#NOTE: Update docstring if more methods are added to account for any added functionality outside of the defined scope.</span>
</span><span id="YotpoAPIWrapper-354"><a href="#YotpoAPIWrapper-354"><span class="linenos">354</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-355"><a href="#YotpoAPIWrapper-355"><span class="linenos">355</span></a><span class="sd">    A class for interacting with the Yotpo API to fetch app and account information, review data, and send manual review requests.</span>
</span><span id="YotpoAPIWrapper-356"><a href="#YotpoAPIWrapper-356"><span class="linenos">356</span></a>
</span><span id="YotpoAPIWrapper-357"><a href="#YotpoAPIWrapper-357"><span class="linenos">357</span></a><span class="sd">    The YotpoAPIWrapper uses the provided app_key and secret for authentication and constructs the necessary API endpoints for making requests.</span>
</span><span id="YotpoAPIWrapper-358"><a href="#YotpoAPIWrapper-358"><span class="linenos">358</span></a>
</span><span id="YotpoAPIWrapper-359"><a href="#YotpoAPIWrapper-359"><span class="linenos">359</span></a><span class="sd">    Args:</span>
</span><span id="YotpoAPIWrapper-360"><a href="#YotpoAPIWrapper-360"><span class="linenos">360</span></a><span class="sd">        app_key (str): The Yotpo app key for API authentication.</span>
</span><span id="YotpoAPIWrapper-361"><a href="#YotpoAPIWrapper-361"><span class="linenos">361</span></a><span class="sd">        secret (str): The client secret to authenticate requests.</span>
</span><span id="YotpoAPIWrapper-362"><a href="#YotpoAPIWrapper-362"><span class="linenos">362</span></a><span class="sd">        preferred_uid (Optional[int], optional): The user ID to use for fetching data relating to the Yotpo APP. Defaults to None.</span>
</span><span id="YotpoAPIWrapper-363"><a href="#YotpoAPIWrapper-363"><span class="linenos">363</span></a>
</span><span id="YotpoAPIWrapper-364"><a href="#YotpoAPIWrapper-364"><span class="linenos">364</span></a><span class="sd">    Raises:</span>
</span><span id="YotpoAPIWrapper-365"><a href="#YotpoAPIWrapper-365"><span class="linenos">365</span></a><span class="sd">        Exception: If either app_key or secret is not provided.</span>
</span><span id="YotpoAPIWrapper-366"><a href="#YotpoAPIWrapper-366"><span class="linenos">366</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-367"><a href="#YotpoAPIWrapper-367"><span class="linenos">367</span></a>    
</span><span id="YotpoAPIWrapper-368"><a href="#YotpoAPIWrapper-368"><span class="linenos">368</span></a>    <span class="c1"># TODO: Update the explanation of the preferred_uid argument to be more accurate/helpful.</span>
</span><span id="YotpoAPIWrapper-369"><a href="#YotpoAPIWrapper-369"><span class="linenos">369</span></a>
</span><span id="YotpoAPIWrapper-370"><a href="#YotpoAPIWrapper-370"><span class="linenos">370</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">preferred_uid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-371"><a href="#YotpoAPIWrapper-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">app_key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">secret</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-372"><a href="#YotpoAPIWrapper-372"><span class="linenos">372</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;app_key(exists=</span><span class="si">{</span><span class="nb">bool</span><span class="p">(</span><span class="n">app_key</span><span class="p">)</span><span class="si">}</span><span class="s2">) and secret(exists=</span><span class="si">{</span><span class="nb">bool</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span><span class="si">}</span><span class="s2">) are required.&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-373"><a href="#YotpoAPIWrapper-373"><span class="linenos">373</span></a>        
</span><span id="YotpoAPIWrapper-374"><a href="#YotpoAPIWrapper-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span> <span class="o">=</span> <span class="n">app_key</span>
</span><span id="YotpoAPIWrapper-375"><a href="#YotpoAPIWrapper-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_secret</span> <span class="o">=</span> <span class="n">secret</span>
</span><span id="YotpoAPIWrapper-376"><a href="#YotpoAPIWrapper-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">preferred_uid</span>
</span><span id="YotpoAPIWrapper-377"><a href="#YotpoAPIWrapper-377"><span class="linenos">377</span></a>
</span><span id="YotpoAPIWrapper-378"><a href="#YotpoAPIWrapper-378"><span class="linenos">378</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper-379"><a href="#YotpoAPIWrapper-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper-380"><a href="#YotpoAPIWrapper-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_token</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper-381"><a href="#YotpoAPIWrapper-381"><span class="linenos">381</span></a>
</span><span id="YotpoAPIWrapper-382"><a href="#YotpoAPIWrapper-382"><span class="linenos">382</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.yotpo.com/v1/apps/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/reviews?utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&amp;&quot;</span>
</span><span id="YotpoAPIWrapper-383"><a href="#YotpoAPIWrapper-383"><span class="linenos">383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">widget_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.yotpo.com/v1/widget/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/reviews?utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&amp;&quot;</span>
</span><span id="YotpoAPIWrapper-384"><a href="#YotpoAPIWrapper-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_user_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api-write.yotpo.com/users/me?utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="YotpoAPIWrapper-385"><a href="#YotpoAPIWrapper-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_app_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api-write.yotpo.com/apps&quot;</span>
</span><span id="YotpoAPIWrapper-386"><a href="#YotpoAPIWrapper-386"><span class="linenos">386</span></a>
</span><span id="YotpoAPIWrapper-387"><a href="#YotpoAPIWrapper-387"><span class="linenos">387</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-388"><a href="#YotpoAPIWrapper-388"><span class="linenos">388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">())[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span><span id="YotpoAPIWrapper-389"><a href="#YotpoAPIWrapper-389"><span class="linenos">389</span></a>
</span><span id="YotpoAPIWrapper-390"><a href="#YotpoAPIWrapper-390"><span class="linenos">390</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="YotpoAPIWrapper-391"><a href="#YotpoAPIWrapper-391"><span class="linenos">391</span></a>
</span><span id="YotpoAPIWrapper-392"><a href="#YotpoAPIWrapper-392"><span class="linenos">392</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper-393"><a href="#YotpoAPIWrapper-393"><span class="linenos">393</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper-394"><a href="#YotpoAPIWrapper-394"><span class="linenos">394</span></a>
</span><span id="YotpoAPIWrapper-395"><a href="#YotpoAPIWrapper-395"><span class="linenos">395</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_get_user_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-396"><a href="#YotpoAPIWrapper-396"><span class="linenos">396</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-397"><a href="#YotpoAPIWrapper-397"><span class="linenos">397</span></a><span class="sd">        Get the user access token using the provided secret.</span>
</span><span id="YotpoAPIWrapper-398"><a href="#YotpoAPIWrapper-398"><span class="linenos">398</span></a>
</span><span id="YotpoAPIWrapper-399"><a href="#YotpoAPIWrapper-399"><span class="linenos">399</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper-400"><a href="#YotpoAPIWrapper-400"><span class="linenos">400</span></a><span class="sd">            app_key (str): The target app you want authenticated.</span>
</span><span id="YotpoAPIWrapper-401"><a href="#YotpoAPIWrapper-401"><span class="linenos">401</span></a><span class="sd">            secret (str): The client secret to authenticate the request.</span>
</span><span id="YotpoAPIWrapper-402"><a href="#YotpoAPIWrapper-402"><span class="linenos">402</span></a>
</span><span id="YotpoAPIWrapper-403"><a href="#YotpoAPIWrapper-403"><span class="linenos">403</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-404"><a href="#YotpoAPIWrapper-404"><span class="linenos">404</span></a><span class="sd">            str: The user access token.</span>
</span><span id="YotpoAPIWrapper-405"><a href="#YotpoAPIWrapper-405"><span class="linenos">405</span></a>
</span><span id="YotpoAPIWrapper-406"><a href="#YotpoAPIWrapper-406"><span class="linenos">406</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper-407"><a href="#YotpoAPIWrapper-407"><span class="linenos">407</span></a><span class="sd">            Exception: If the response status is not OK (200).</span>
</span><span id="YotpoAPIWrapper-408"><a href="#YotpoAPIWrapper-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-409"><a href="#YotpoAPIWrapper-409"><span class="linenos">409</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.yotpo.com/oauth/token&quot;</span>
</span><span id="YotpoAPIWrapper-410"><a href="#YotpoAPIWrapper-410"><span class="linenos">410</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="YotpoAPIWrapper-411"><a href="#YotpoAPIWrapper-411"><span class="linenos">411</span></a>            <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">,</span>
</span><span id="YotpoAPIWrapper-412"><a href="#YotpoAPIWrapper-412"><span class="linenos">412</span></a>            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="p">,</span>
</span><span id="YotpoAPIWrapper-413"><a href="#YotpoAPIWrapper-413"><span class="linenos">413</span></a>            <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secret</span><span class="p">,</span>
</span><span id="YotpoAPIWrapper-414"><a href="#YotpoAPIWrapper-414"><span class="linenos">414</span></a>        <span class="p">}</span>
</span><span id="YotpoAPIWrapper-415"><a href="#YotpoAPIWrapper-415"><span class="linenos">415</span></a>
</span><span id="YotpoAPIWrapper-416"><a href="#YotpoAPIWrapper-416"><span class="linenos">416</span></a>        <span class="k">return</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]))</span>
</span><span id="YotpoAPIWrapper-417"><a href="#YotpoAPIWrapper-417"><span class="linenos">417</span></a>
</span><span id="YotpoAPIWrapper-418"><a href="#YotpoAPIWrapper-418"><span class="linenos">418</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_options_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-419"><a href="#YotpoAPIWrapper-419"><span class="linenos">419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-420"><a href="#YotpoAPIWrapper-420"><span class="linenos">420</span></a><span class="sd">        Asynchronously sends a preflight OPTIONS request to check if the given method is allowed for the given endpoint.</span>
</span><span id="YotpoAPIWrapper-421"><a href="#YotpoAPIWrapper-421"><span class="linenos">421</span></a>
</span><span id="YotpoAPIWrapper-422"><a href="#YotpoAPIWrapper-422"><span class="linenos">422</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper-423"><a href="#YotpoAPIWrapper-423"><span class="linenos">423</span></a><span class="sd">            url (str): The API endpoint URL.</span>
</span><span id="YotpoAPIWrapper-424"><a href="#YotpoAPIWrapper-424"><span class="linenos">424</span></a>
</span><span id="YotpoAPIWrapper-425"><a href="#YotpoAPIWrapper-425"><span class="linenos">425</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-426"><a href="#YotpoAPIWrapper-426"><span class="linenos">426</span></a><span class="sd">            bool: True if the method is allowed, False otherwise.</span>
</span><span id="YotpoAPIWrapper-427"><a href="#YotpoAPIWrapper-427"><span class="linenos">427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-428"><a href="#YotpoAPIWrapper-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;aiohttp_session&#39;</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper-429"><a href="#YotpoAPIWrapper-429"><span class="linenos">429</span></a>            <span class="k">raise</span> <span class="n">SessionNotCreatedError</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper-430"><a href="#YotpoAPIWrapper-430"><span class="linenos">430</span></a>
</span><span id="YotpoAPIWrapper-431"><a href="#YotpoAPIWrapper-431"><span class="linenos">431</span></a>        <span class="c1"># Cheeky way to make sure `method` is at least syntactically correct.</span>
</span><span id="YotpoAPIWrapper-432"><a href="#YotpoAPIWrapper-432"><span class="linenos">432</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">:=</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="s1">&#39;CONNECT&#39;</span><span class="p">,</span> <span class="s1">&#39;OPTIONS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRACE&#39;</span><span class="p">]:</span>
</span><span id="YotpoAPIWrapper-433"><a href="#YotpoAPIWrapper-433"><span class="linenos">433</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid HTTP method: &quot;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-434"><a href="#YotpoAPIWrapper-434"><span class="linenos">434</span></a>
</span><span id="YotpoAPIWrapper-435"><a href="#YotpoAPIWrapper-435"><span class="linenos">435</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-436"><a href="#YotpoAPIWrapper-436"><span class="linenos">436</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-437"><a href="#YotpoAPIWrapper-437"><span class="linenos">437</span></a>                <span class="n">allowed_methods</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-438"><a href="#YotpoAPIWrapper-438"><span class="linenos">438</span></a>                <span class="k">return</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">allowed_methods</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-439"><a href="#YotpoAPIWrapper-439"><span class="linenos">439</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-440"><a href="#YotpoAPIWrapper-440"><span class="linenos">440</span></a>
</span><span id="YotpoAPIWrapper-441"><a href="#YotpoAPIWrapper-441"><span class="linenos">441</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_get_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exception_type</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">=</span> <span class="n">CustomException</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-442"><a href="#YotpoAPIWrapper-442"><span class="linenos">442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-443"><a href="#YotpoAPIWrapper-443"><span class="linenos">443</span></a><span class="sd">        Asynchronously sends a GET request to the specified URL and parses the response using the provided parser.</span>
</span><span id="YotpoAPIWrapper-444"><a href="#YotpoAPIWrapper-444"><span class="linenos">444</span></a>
</span><span id="YotpoAPIWrapper-445"><a href="#YotpoAPIWrapper-445"><span class="linenos">445</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper-446"><a href="#YotpoAPIWrapper-446"><span class="linenos">446</span></a><span class="sd">            session (aiohttp.ClientSession): An aiohttp client session for making requests.</span>
</span><span id="YotpoAPIWrapper-447"><a href="#YotpoAPIWrapper-447"><span class="linenos">447</span></a><span class="sd">            url (str): The URL to send the request to.</span>
</span><span id="YotpoAPIWrapper-448"><a href="#YotpoAPIWrapper-448"><span class="linenos">448</span></a><span class="sd">            parser (Callable[[dict], dict]): A function to parse the response JSON. Defaults to json.loads.</span>
</span><span id="YotpoAPIWrapper-449"><a href="#YotpoAPIWrapper-449"><span class="linenos">449</span></a><span class="sd">            exception_type (Union[CustomException, Exception]): The type of exception to raise when an error occurs. Defaults to CustomException.</span>
</span><span id="YotpoAPIWrapper-450"><a href="#YotpoAPIWrapper-450"><span class="linenos">450</span></a><span class="sd">            **kwargs: Additional keyword arguments to be passed to the request object.</span>
</span><span id="YotpoAPIWrapper-451"><a href="#YotpoAPIWrapper-451"><span class="linenos">451</span></a>
</span><span id="YotpoAPIWrapper-452"><a href="#YotpoAPIWrapper-452"><span class="linenos">452</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-453"><a href="#YotpoAPIWrapper-453"><span class="linenos">453</span></a><span class="sd">            dict: The parsed JSON response.</span>
</span><span id="YotpoAPIWrapper-454"><a href="#YotpoAPIWrapper-454"><span class="linenos">454</span></a>
</span><span id="YotpoAPIWrapper-455"><a href="#YotpoAPIWrapper-455"><span class="linenos">455</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper-456"><a href="#YotpoAPIWrapper-456"><span class="linenos">456</span></a><span class="sd">            exception_type: If the response status is not 200, an instance of the specified exception_type is raised with an error message.</span>
</span><span id="YotpoAPIWrapper-457"><a href="#YotpoAPIWrapper-457"><span class="linenos">457</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-458"><a href="#YotpoAPIWrapper-458"><span class="linenos">458</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;aiohttp_session&#39;</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper-459"><a href="#YotpoAPIWrapper-459"><span class="linenos">459</span></a>            <span class="k">raise</span> <span class="n">SessionNotCreatedError</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper-460"><a href="#YotpoAPIWrapper-460"><span class="linenos">460</span></a>
</span><span id="YotpoAPIWrapper-461"><a href="#YotpoAPIWrapper-461"><span class="linenos">461</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-462"><a href="#YotpoAPIWrapper-462"><span class="linenos">462</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-463"><a href="#YotpoAPIWrapper-463"><span class="linenos">463</span></a>                <span class="n">raw_data</span> <span class="o">=</span> <span class="n">json_loads</span><span class="p">(</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="YotpoAPIWrapper-464"><a href="#YotpoAPIWrapper-464"><span class="linenos">464</span></a>                <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-465"><a href="#YotpoAPIWrapper-465"><span class="linenos">465</span></a>                    <span class="k">return</span> <span class="n">raw_data</span>
</span><span id="YotpoAPIWrapper-466"><a href="#YotpoAPIWrapper-466"><span class="linenos">466</span></a>                <span class="k">return</span> <span class="n">parser</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-467"><a href="#YotpoAPIWrapper-467"><span class="linenos">467</span></a>            <span class="k">raise</span> <span class="n">exception_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-468"><a href="#YotpoAPIWrapper-468"><span class="linenos">468</span></a>
</span><span id="YotpoAPIWrapper-469"><a href="#YotpoAPIWrapper-469"><span class="linenos">469</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_post_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exception_type</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">=</span> <span class="n">CustomException</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-470"><a href="#YotpoAPIWrapper-470"><span class="linenos">470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-471"><a href="#YotpoAPIWrapper-471"><span class="linenos">471</span></a><span class="sd">        Asynchronously sends a POST request to the specified URL and parses the response using the provided parser.</span>
</span><span id="YotpoAPIWrapper-472"><a href="#YotpoAPIWrapper-472"><span class="linenos">472</span></a>
</span><span id="YotpoAPIWrapper-473"><a href="#YotpoAPIWrapper-473"><span class="linenos">473</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper-474"><a href="#YotpoAPIWrapper-474"><span class="linenos">474</span></a><span class="sd">            session (aiohttp.ClientSession): An aiohttp client session for making requests.</span>
</span><span id="YotpoAPIWrapper-475"><a href="#YotpoAPIWrapper-475"><span class="linenos">475</span></a><span class="sd">            url (str): The URL to send the request to.</span>
</span><span id="YotpoAPIWrapper-476"><a href="#YotpoAPIWrapper-476"><span class="linenos">476</span></a><span class="sd">            data (dict): The data to send in the request body.</span>
</span><span id="YotpoAPIWrapper-477"><a href="#YotpoAPIWrapper-477"><span class="linenos">477</span></a><span class="sd">            parser (Callable[[dict], dict]): A function to parse the response JSON. Defaults to json.loads.</span>
</span><span id="YotpoAPIWrapper-478"><a href="#YotpoAPIWrapper-478"><span class="linenos">478</span></a><span class="sd">            exception_type (Union[CustomException, Exception]): The type of exception to raise when an error occurs. Defaults to CustomException.</span>
</span><span id="YotpoAPIWrapper-479"><a href="#YotpoAPIWrapper-479"><span class="linenos">479</span></a><span class="sd">            **kwargs: Additional keyword arguments to be passed to the request object.</span>
</span><span id="YotpoAPIWrapper-480"><a href="#YotpoAPIWrapper-480"><span class="linenos">480</span></a>
</span><span id="YotpoAPIWrapper-481"><a href="#YotpoAPIWrapper-481"><span class="linenos">481</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-482"><a href="#YotpoAPIWrapper-482"><span class="linenos">482</span></a><span class="sd">            dict: The parsed JSON response.</span>
</span><span id="YotpoAPIWrapper-483"><a href="#YotpoAPIWrapper-483"><span class="linenos">483</span></a>
</span><span id="YotpoAPIWrapper-484"><a href="#YotpoAPIWrapper-484"><span class="linenos">484</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper-485"><a href="#YotpoAPIWrapper-485"><span class="linenos">485</span></a><span class="sd">            exception_type: If the response status is not 200, an instance of the specified exception_type is raised with an error message.</span>
</span><span id="YotpoAPIWrapper-486"><a href="#YotpoAPIWrapper-486"><span class="linenos">486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-487"><a href="#YotpoAPIWrapper-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;aiohttp_session&#39;</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper-488"><a href="#YotpoAPIWrapper-488"><span class="linenos">488</span></a>            <span class="k">raise</span> <span class="n">SessionNotCreatedError</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper-489"><a href="#YotpoAPIWrapper-489"><span class="linenos">489</span></a>
</span><span id="YotpoAPIWrapper-490"><a href="#YotpoAPIWrapper-490"><span class="linenos">490</span></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">aiohttp_session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-491"><a href="#YotpoAPIWrapper-491"><span class="linenos">491</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-492"><a href="#YotpoAPIWrapper-492"><span class="linenos">492</span></a>                <span class="n">raw_data</span> <span class="o">=</span> <span class="n">json_loads</span><span class="p">(</span><span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="YotpoAPIWrapper-493"><a href="#YotpoAPIWrapper-493"><span class="linenos">493</span></a>                <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-494"><a href="#YotpoAPIWrapper-494"><span class="linenos">494</span></a>                    <span class="k">return</span> <span class="n">raw_data</span>
</span><span id="YotpoAPIWrapper-495"><a href="#YotpoAPIWrapper-495"><span class="linenos">495</span></a>                <span class="k">return</span> <span class="n">parser</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-496"><a href="#YotpoAPIWrapper-496"><span class="linenos">496</span></a>            <span class="k">raise</span> <span class="n">exception_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-497"><a href="#YotpoAPIWrapper-497"><span class="linenos">497</span></a>
</span><span id="YotpoAPIWrapper-498"><a href="#YotpoAPIWrapper-498"><span class="linenos">498</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="YotpoAPIWrapper-499"><a href="#YotpoAPIWrapper-499"><span class="linenos">499</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-500"><a href="#YotpoAPIWrapper-500"><span class="linenos">500</span></a><span class="sd">        Asynchronously generate URLs for each page of results.</span>
</span><span id="YotpoAPIWrapper-501"><a href="#YotpoAPIWrapper-501"><span class="linenos">501</span></a>
</span><span id="YotpoAPIWrapper-502"><a href="#YotpoAPIWrapper-502"><span class="linenos">502</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper-503"><a href="#YotpoAPIWrapper-503"><span class="linenos">503</span></a><span class="sd">            endpoint (str): The API endpoint to query.</span>
</span><span id="YotpoAPIWrapper-504"><a href="#YotpoAPIWrapper-504"><span class="linenos">504</span></a><span class="sd">            start_page (int): The first page to generate.</span>
</span><span id="YotpoAPIWrapper-505"><a href="#YotpoAPIWrapper-505"><span class="linenos">505</span></a>
</span><span id="YotpoAPIWrapper-506"><a href="#YotpoAPIWrapper-506"><span class="linenos">506</span></a><span class="sd">        Yields:</span>
</span><span id="YotpoAPIWrapper-507"><a href="#YotpoAPIWrapper-507"><span class="linenos">507</span></a><span class="sd">            tuple[str, int] -&gt;</span>
</span><span id="YotpoAPIWrapper-508"><a href="#YotpoAPIWrapper-508"><span class="linenos">508</span></a><span class="sd">                str: The URL for the next page of results.</span>
</span><span id="YotpoAPIWrapper-509"><a href="#YotpoAPIWrapper-509"><span class="linenos">509</span></a><span class="sd">                int: The current page number.</span>
</span><span id="YotpoAPIWrapper-510"><a href="#YotpoAPIWrapper-510"><span class="linenos">510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-511"><a href="#YotpoAPIWrapper-511"><span class="linenos">511</span></a>        <span class="n">last_page</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_reviews</span><span class="p">())</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-512"><a href="#YotpoAPIWrapper-512"><span class="linenos">512</span></a>        <span class="n">is_widget</span> <span class="o">=</span> <span class="s2">&quot;widget&quot;</span> <span class="ow">in</span> <span class="n">endpoint</span>
</span><span id="YotpoAPIWrapper-513"><a href="#YotpoAPIWrapper-513"><span class="linenos">513</span></a>        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">last_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper-514"><a href="#YotpoAPIWrapper-514"><span class="linenos">514</span></a>            <span class="k">yield</span> <span class="n">endpoint</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(({(</span><span class="s2">&quot;per_page&quot;</span> <span class="k">if</span> <span class="n">is_widget</span> <span class="k">else</span> <span class="s2">&quot;count&quot;</span><span class="p">):</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="n">num</span><span class="p">})),</span> <span class="n">num</span>
</span><span id="YotpoAPIWrapper-515"><a href="#YotpoAPIWrapper-515"><span class="linenos">515</span></a>
</span><span id="YotpoAPIWrapper-516"><a href="#YotpoAPIWrapper-516"><span class="linenos">516</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-517"><a href="#YotpoAPIWrapper-517"><span class="linenos">517</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-518"><a href="#YotpoAPIWrapper-518"><span class="linenos">518</span></a><span class="sd">        Asynchronously fetches user data from the user endpoint.</span>
</span><span id="YotpoAPIWrapper-519"><a href="#YotpoAPIWrapper-519"><span class="linenos">519</span></a>
</span><span id="YotpoAPIWrapper-520"><a href="#YotpoAPIWrapper-520"><span class="linenos">520</span></a><span class="sd">        This function returns various user-related data, such as name, email, display_name, company, position, and other</span>
</span><span id="YotpoAPIWrapper-521"><a href="#YotpoAPIWrapper-521"><span class="linenos">521</span></a><span class="sd">        metadata like sign_in_count and package details. This data can be useful for understanding user profiles,</span>
</span><span id="YotpoAPIWrapper-522"><a href="#YotpoAPIWrapper-522"><span class="linenos">522</span></a><span class="sd">        managing access, or customizing the user experience based on the retrieved information.</span>
</span><span id="YotpoAPIWrapper-523"><a href="#YotpoAPIWrapper-523"><span class="linenos">523</span></a>
</span><span id="YotpoAPIWrapper-524"><a href="#YotpoAPIWrapper-524"><span class="linenos">524</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-525"><a href="#YotpoAPIWrapper-525"><span class="linenos">525</span></a><span class="sd">            dict: A dictionary containing user information, including personal details, activity statistics, and package details.</span>
</span><span id="YotpoAPIWrapper-526"><a href="#YotpoAPIWrapper-526"><span class="linenos">526</span></a>
</span><span id="YotpoAPIWrapper-527"><a href="#YotpoAPIWrapper-527"><span class="linenos">527</span></a>
</span><span id="YotpoAPIWrapper-528"><a href="#YotpoAPIWrapper-528"><span class="linenos">528</span></a><span class="sd">        Example:</span>
</span><span id="YotpoAPIWrapper-529"><a href="#YotpoAPIWrapper-529"><span class="linenos">529</span></a><span class="sd">            ```python</span>
</span><span id="YotpoAPIWrapper-530"><a href="#YotpoAPIWrapper-530"><span class="linenos">530</span></a><span class="sd">            &gt;&gt;&gt; yotpo = YotpoAPIWrapper(app_key, secret)</span>
</span><span id="YotpoAPIWrapper-531"><a href="#YotpoAPIWrapper-531"><span class="linenos">531</span></a><span class="sd">            &gt;&gt;&gt; async with yotpo as yp:</span>
</span><span id="YotpoAPIWrapper-532"><a href="#YotpoAPIWrapper-532"><span class="linenos">532</span></a><span class="sd">            &gt;&gt;&gt;     user = await yp.get_user()</span>
</span><span id="YotpoAPIWrapper-533"><a href="#YotpoAPIWrapper-533"><span class="linenos">533</span></a><span class="sd">            ```</span>
</span><span id="YotpoAPIWrapper-534"><a href="#YotpoAPIWrapper-534"><span class="linenos">534</span></a>
</span><span id="YotpoAPIWrapper-535"><a href="#YotpoAPIWrapper-535"><span class="linenos">535</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper-536"><a href="#YotpoAPIWrapper-536"><span class="linenos">536</span></a><span class="sd">            Exception: If the request to the user endpoint returns a non-OK status.</span>
</span><span id="YotpoAPIWrapper-537"><a href="#YotpoAPIWrapper-537"><span class="linenos">537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-538"><a href="#YotpoAPIWrapper-538"><span class="linenos">538</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_user_endpoint</span>
</span><span id="YotpoAPIWrapper-539"><a href="#YotpoAPIWrapper-539"><span class="linenos">539</span></a>        
</span><span id="YotpoAPIWrapper-540"><a href="#YotpoAPIWrapper-540"><span class="linenos">540</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">])</span>
</span><span id="YotpoAPIWrapper-541"><a href="#YotpoAPIWrapper-541"><span class="linenos">541</span></a>
</span><span id="YotpoAPIWrapper-542"><a href="#YotpoAPIWrapper-542"><span class="linenos">542</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_app</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-543"><a href="#YotpoAPIWrapper-543"><span class="linenos">543</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-544"><a href="#YotpoAPIWrapper-544"><span class="linenos">544</span></a><span class="sd">        Asynchronously fetches app data for the app associated with the preferred user ID.</span>
</span><span id="YotpoAPIWrapper-545"><a href="#YotpoAPIWrapper-545"><span class="linenos">545</span></a>
</span><span id="YotpoAPIWrapper-546"><a href="#YotpoAPIWrapper-546"><span class="linenos">546</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-547"><a href="#YotpoAPIWrapper-547"><span class="linenos">547</span></a><span class="sd">            dict: A dictionary containing app information derived from the specified user. The app information includes</span>
</span><span id="YotpoAPIWrapper-548"><a href="#YotpoAPIWrapper-548"><span class="linenos">548</span></a><span class="sd">            details such as app_key, domain, name, url, account type, users, reminders, custom design, created</span>
</span><span id="YotpoAPIWrapper-549"><a href="#YotpoAPIWrapper-549"><span class="linenos">549</span></a><span class="sd">            and updated timestamps, tracking code status, account emails, package details, enabled product</span>
</span><span id="YotpoAPIWrapper-550"><a href="#YotpoAPIWrapper-550"><span class="linenos">550</span></a><span class="sd">            categories, features usage summary, data for events, category, installed status, organization,</span>
</span><span id="YotpoAPIWrapper-551"><a href="#YotpoAPIWrapper-551"><span class="linenos">551</span></a><span class="sd">            and associated apps.</span>
</span><span id="YotpoAPIWrapper-552"><a href="#YotpoAPIWrapper-552"><span class="linenos">552</span></a><span class="sd">        </span>
</span><span id="YotpoAPIWrapper-553"><a href="#YotpoAPIWrapper-553"><span class="linenos">553</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper-554"><a href="#YotpoAPIWrapper-554"><span class="linenos">554</span></a><span class="sd">            AppDataNotFound: If the request to the app endpoint returns a non-OK status.</span>
</span><span id="YotpoAPIWrapper-555"><a href="#YotpoAPIWrapper-555"><span class="linenos">555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-556"><a href="#YotpoAPIWrapper-556"><span class="linenos">556</span></a>        <span class="c1"># NOTE: The user_id does not appear to actually matter at all, as it still returns data even if it is not a valid user ID.</span>
</span><span id="YotpoAPIWrapper-557"><a href="#YotpoAPIWrapper-557"><span class="linenos">557</span></a>        <span class="c1"># I suspect `user_id` is just used to track which user is making the request.</span>
</span><span id="YotpoAPIWrapper-558"><a href="#YotpoAPIWrapper-558"><span class="linenos">558</span></a>
</span><span id="YotpoAPIWrapper-559"><a href="#YotpoAPIWrapper-559"><span class="linenos">559</span></a>        <span class="c1"># TODO: If the above is true, we can probably abstract away the `user_id` parameter and just use the user ID from the user endpoint.</span>
</span><span id="YotpoAPIWrapper-560"><a href="#YotpoAPIWrapper-560"><span class="linenos">560</span></a>        <span class="c1"># And if need be we can add some configuration to allow the user to specify a user ID if they want to.</span>
</span><span id="YotpoAPIWrapper-561"><a href="#YotpoAPIWrapper-561"><span class="linenos">561</span></a>
</span><span id="YotpoAPIWrapper-562"><a href="#YotpoAPIWrapper-562"><span class="linenos">562</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api-write.yotpo.com/apps/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">?user_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&amp;utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="YotpoAPIWrapper-563"><a href="#YotpoAPIWrapper-563"><span class="linenos">563</span></a>
</span><span id="YotpoAPIWrapper-564"><a href="#YotpoAPIWrapper-564"><span class="linenos">564</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;app&#39;</span><span class="p">],</span> <span class="n">exception_type</span><span class="o">=</span><span class="n">AppDataNotFound</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-565"><a href="#YotpoAPIWrapper-565"><span class="linenos">565</span></a>
</span><span id="YotpoAPIWrapper-566"><a href="#YotpoAPIWrapper-566"><span class="linenos">566</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_total_reviews</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-567"><a href="#YotpoAPIWrapper-567"><span class="linenos">567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-568"><a href="#YotpoAPIWrapper-568"><span class="linenos">568</span></a><span class="sd">        Asynchronously fetches the total number of reviews for an app.</span>
</span><span id="YotpoAPIWrapper-569"><a href="#YotpoAPIWrapper-569"><span class="linenos">569</span></a>
</span><span id="YotpoAPIWrapper-570"><a href="#YotpoAPIWrapper-570"><span class="linenos">570</span></a><span class="sd">        This method first retrieves the user and their user ID, then fetches the app data</span>
</span><span id="YotpoAPIWrapper-571"><a href="#YotpoAPIWrapper-571"><span class="linenos">571</span></a><span class="sd">        associated with that user. Finally, it returns the total number of reviews for the app.</span>
</span><span id="YotpoAPIWrapper-572"><a href="#YotpoAPIWrapper-572"><span class="linenos">572</span></a>
</span><span id="YotpoAPIWrapper-573"><a href="#YotpoAPIWrapper-573"><span class="linenos">573</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-574"><a href="#YotpoAPIWrapper-574"><span class="linenos">574</span></a><span class="sd">            int: The total number of reviews for the app.</span>
</span><span id="YotpoAPIWrapper-575"><a href="#YotpoAPIWrapper-575"><span class="linenos">575</span></a>
</span><span id="YotpoAPIWrapper-576"><a href="#YotpoAPIWrapper-576"><span class="linenos">576</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper-577"><a href="#YotpoAPIWrapper-577"><span class="linenos">577</span></a><span class="sd">            AppDataNotFound: If unable to get the app data.</span>
</span><span id="YotpoAPIWrapper-578"><a href="#YotpoAPIWrapper-578"><span class="linenos">578</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-579"><a href="#YotpoAPIWrapper-579"><span class="linenos">579</span></a>        <span class="n">app</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper-580"><a href="#YotpoAPIWrapper-580"><span class="linenos">580</span></a>
</span><span id="YotpoAPIWrapper-581"><a href="#YotpoAPIWrapper-581"><span class="linenos">581</span></a>        <span class="k">return</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;data_for_events&#39;</span><span class="p">][</span><span class="s1">&#39;total_reviews&#39;</span><span class="p">]</span>
</span><span id="YotpoAPIWrapper-582"><a href="#YotpoAPIWrapper-582"><span class="linenos">582</span></a>    
</span><span id="YotpoAPIWrapper-583"><a href="#YotpoAPIWrapper-583"><span class="linenos">583</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-584"><a href="#YotpoAPIWrapper-584"><span class="linenos">584</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-585"><a href="#YotpoAPIWrapper-585"><span class="linenos">585</span></a><span class="sd">        Asynchronously fetch the email templates associated with the Yotpo account.</span>
</span><span id="YotpoAPIWrapper-586"><a href="#YotpoAPIWrapper-586"><span class="linenos">586</span></a>
</span><span id="YotpoAPIWrapper-587"><a href="#YotpoAPIWrapper-587"><span class="linenos">587</span></a><span class="sd">        This method retrieves the app data, extracts the email templates, and returns them as a dictionary.</span>
</span><span id="YotpoAPIWrapper-588"><a href="#YotpoAPIWrapper-588"><span class="linenos">588</span></a><span class="sd">        The primary use case for this function is to obtain the template IDs required for the &#39;send_review_request&#39; method.</span>
</span><span id="YotpoAPIWrapper-589"><a href="#YotpoAPIWrapper-589"><span class="linenos">589</span></a>
</span><span id="YotpoAPIWrapper-590"><a href="#YotpoAPIWrapper-590"><span class="linenos">590</span></a><span class="sd">        The returned dictionary contains template objects with properties such as &#39;id&#39; (template_id),</span>
</span><span id="YotpoAPIWrapper-591"><a href="#YotpoAPIWrapper-591"><span class="linenos">591</span></a><span class="sd">        &#39;email_type&#39;, &#39;data&#39;, and others. For example:</span>
</span><span id="YotpoAPIWrapper-592"><a href="#YotpoAPIWrapper-592"><span class="linenos">592</span></a><span class="sd">        ```python</span>
</span><span id="YotpoAPIWrapper-593"><a href="#YotpoAPIWrapper-593"><span class="linenos">593</span></a><span class="sd">            {</span>
</span><span id="YotpoAPIWrapper-594"><a href="#YotpoAPIWrapper-594"><span class="linenos">594</span></a><span class="sd">                &#39;id&#39;: 10291872,</span>
</span><span id="YotpoAPIWrapper-595"><a href="#YotpoAPIWrapper-595"><span class="linenos">595</span></a><span class="sd">                &#39;account_id&#39;: 9092811,</span>
</span><span id="YotpoAPIWrapper-596"><a href="#YotpoAPIWrapper-596"><span class="linenos">596</span></a><span class="sd">                &#39;email_type_id&#39;: 31,</span>
</span><span id="YotpoAPIWrapper-597"><a href="#YotpoAPIWrapper-597"><span class="linenos">597</span></a><span class="sd">                &#39;email_type&#39;: {</span>
</span><span id="YotpoAPIWrapper-598"><a href="#YotpoAPIWrapper-598"><span class="linenos">598</span></a><span class="sd">                    &#39;id&#39;: 31,</span>
</span><span id="YotpoAPIWrapper-599"><a href="#YotpoAPIWrapper-599"><span class="linenos">599</span></a><span class="sd">                    &#39;name&#39;: &#39;mail_post_service&#39;,</span>
</span><span id="YotpoAPIWrapper-600"><a href="#YotpoAPIWrapper-600"><span class="linenos">600</span></a><span class="sd">                    &#39;template&#39;: &#39;testimonials_request&#39;</span>
</span><span id="YotpoAPIWrapper-601"><a href="#YotpoAPIWrapper-601"><span class="linenos">601</span></a><span class="sd">                },</span>
</span><span id="YotpoAPIWrapper-602"><a href="#YotpoAPIWrapper-602"><span class="linenos">602</span></a><span class="sd">                &#39;data&#39;: {</span>
</span><span id="YotpoAPIWrapper-603"><a href="#YotpoAPIWrapper-603"><span class="linenos">603</span></a><span class="sd">                    &#39;subject&#39;: &#39;Tell us what you think - {company_name}&#39;,</span>
</span><span id="YotpoAPIWrapper-604"><a href="#YotpoAPIWrapper-604"><span class="linenos">604</span></a><span class="sd">                    &#39;header&#39;: &#39;Hello {user},\\n We love having you as a customer and would really appreciate it if you filled out the form below.&#39;,</span>
</span><span id="YotpoAPIWrapper-605"><a href="#YotpoAPIWrapper-605"><span class="linenos">605</span></a><span class="sd">                    &#39;bottom&#39;: &#39;Thanks so much! &lt;br&gt; - {company_name}&#39;</span>
</span><span id="YotpoAPIWrapper-606"><a href="#YotpoAPIWrapper-606"><span class="linenos">606</span></a><span class="sd">                },</span>
</span><span id="YotpoAPIWrapper-607"><a href="#YotpoAPIWrapper-607"><span class="linenos">607</span></a><span class="sd">                &#39;formless_call_to_action&#39;: &#39;&#39;,</span>
</span><span id="YotpoAPIWrapper-608"><a href="#YotpoAPIWrapper-608"><span class="linenos">608</span></a><span class="sd">                &#39;days_delay&#39;: 3,</span>
</span><span id="YotpoAPIWrapper-609"><a href="#YotpoAPIWrapper-609"><span class="linenos">609</span></a><span class="sd">                &#39;email_submission_type_id&#39;: 9</span>
</span><span id="YotpoAPIWrapper-610"><a href="#YotpoAPIWrapper-610"><span class="linenos">610</span></a><span class="sd">            }</span>
</span><span id="YotpoAPIWrapper-611"><a href="#YotpoAPIWrapper-611"><span class="linenos">611</span></a><span class="sd">        ```</span>
</span><span id="YotpoAPIWrapper-612"><a href="#YotpoAPIWrapper-612"><span class="linenos">612</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-613"><a href="#YotpoAPIWrapper-613"><span class="linenos">613</span></a><span class="sd">            dict: A dictionary containing the email templates, keyed by their names.</span>
</span><span id="YotpoAPIWrapper-614"><a href="#YotpoAPIWrapper-614"><span class="linenos">614</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-615"><a href="#YotpoAPIWrapper-615"><span class="linenos">615</span></a>        <span class="n">app</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper-616"><a href="#YotpoAPIWrapper-616"><span class="linenos">616</span></a>        <span class="n">templates</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;account_emails&#39;</span><span class="p">]</span>
</span><span id="YotpoAPIWrapper-617"><a href="#YotpoAPIWrapper-617"><span class="linenos">617</span></a>        <span class="k">return</span> <span class="n">templates</span>
</span><span id="YotpoAPIWrapper-618"><a href="#YotpoAPIWrapper-618"><span class="linenos">618</span></a>
</span><span id="YotpoAPIWrapper-619"><a href="#YotpoAPIWrapper-619"><span class="linenos">619</span></a>        
</span><span id="YotpoAPIWrapper-620"><a href="#YotpoAPIWrapper-620"><span class="linenos">620</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_review_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="YotpoAPIWrapper-621"><a href="#YotpoAPIWrapper-621"><span class="linenos">621</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-622"><a href="#YotpoAPIWrapper-622"><span class="linenos">622</span></a><span class="sd">        Asynchronously fetch a single review page from the specified URL.</span>
</span><span id="YotpoAPIWrapper-623"><a href="#YotpoAPIWrapper-623"><span class="linenos">623</span></a>
</span><span id="YotpoAPIWrapper-624"><a href="#YotpoAPIWrapper-624"><span class="linenos">624</span></a><span class="sd">        This function fetches review data from the provided URL and parses the response based on whether</span>
</span><span id="YotpoAPIWrapper-625"><a href="#YotpoAPIWrapper-625"><span class="linenos">625</span></a><span class="sd">        the URL is for the widget endpoint or not.</span>
</span><span id="YotpoAPIWrapper-626"><a href="#YotpoAPIWrapper-626"><span class="linenos">626</span></a>
</span><span id="YotpoAPIWrapper-627"><a href="#YotpoAPIWrapper-627"><span class="linenos">627</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper-628"><a href="#YotpoAPIWrapper-628"><span class="linenos">628</span></a><span class="sd">            url (str): The URL from which to fetch review data.</span>
</span><span id="YotpoAPIWrapper-629"><a href="#YotpoAPIWrapper-629"><span class="linenos">629</span></a>
</span><span id="YotpoAPIWrapper-630"><a href="#YotpoAPIWrapper-630"><span class="linenos">630</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-631"><a href="#YotpoAPIWrapper-631"><span class="linenos">631</span></a><span class="sd">            list[dict]: A list of review dictionaries.</span>
</span><span id="YotpoAPIWrapper-632"><a href="#YotpoAPIWrapper-632"><span class="linenos">632</span></a>
</span><span id="YotpoAPIWrapper-633"><a href="#YotpoAPIWrapper-633"><span class="linenos">633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-634"><a href="#YotpoAPIWrapper-634"><span class="linenos">634</span></a>        <span class="n">is_widget</span> <span class="o">=</span> <span class="s2">&quot;widget&quot;</span> <span class="ow">in</span> <span class="n">url</span>
</span><span id="YotpoAPIWrapper-635"><a href="#YotpoAPIWrapper-635"><span class="linenos">635</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_widget</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">])</span>
</span><span id="YotpoAPIWrapper-636"><a href="#YotpoAPIWrapper-636"><span class="linenos">636</span></a>
</span><span id="YotpoAPIWrapper-637"><a href="#YotpoAPIWrapper-637"><span class="linenos">637</span></a>
</span><span id="YotpoAPIWrapper-638"><a href="#YotpoAPIWrapper-638"><span class="linenos">638</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_all_reviews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">published</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="YotpoAPIWrapper-639"><a href="#YotpoAPIWrapper-639"><span class="linenos">639</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-640"><a href="#YotpoAPIWrapper-640"><span class="linenos">640</span></a><span class="sd">        Asynchronously fetch all reviews from the specified endpoints.</span>
</span><span id="YotpoAPIWrapper-641"><a href="#YotpoAPIWrapper-641"><span class="linenos">641</span></a>
</span><span id="YotpoAPIWrapper-642"><a href="#YotpoAPIWrapper-642"><span class="linenos">642</span></a><span class="sd">        This function fetches review data from the app and widget endpoints if `published` is set to True, </span>
</span><span id="YotpoAPIWrapper-643"><a href="#YotpoAPIWrapper-643"><span class="linenos">643</span></a><span class="sd">        and only from the app endpoint if `published` is set to False. The fetched reviews are then merged</span>
</span><span id="YotpoAPIWrapper-644"><a href="#YotpoAPIWrapper-644"><span class="linenos">644</span></a><span class="sd">        based on their &quot;id&quot; attribute.</span>
</span><span id="YotpoAPIWrapper-645"><a href="#YotpoAPIWrapper-645"><span class="linenos">645</span></a>
</span><span id="YotpoAPIWrapper-646"><a href="#YotpoAPIWrapper-646"><span class="linenos">646</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper-647"><a href="#YotpoAPIWrapper-647"><span class="linenos">647</span></a><span class="sd">            published (bool, optional): Determines if the function should fetch reviews from both</span>
</span><span id="YotpoAPIWrapper-648"><a href="#YotpoAPIWrapper-648"><span class="linenos">648</span></a><span class="sd">                                         the app and widget endpoints or just the app endpoint.</span>
</span><span id="YotpoAPIWrapper-649"><a href="#YotpoAPIWrapper-649"><span class="linenos">649</span></a><span class="sd">                                         Defaults to True.</span>
</span><span id="YotpoAPIWrapper-650"><a href="#YotpoAPIWrapper-650"><span class="linenos">650</span></a>
</span><span id="YotpoAPIWrapper-651"><a href="#YotpoAPIWrapper-651"><span class="linenos">651</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-652"><a href="#YotpoAPIWrapper-652"><span class="linenos">652</span></a><span class="sd">            list[dict]: A list of merged review dictionaries.</span>
</span><span id="YotpoAPIWrapper-653"><a href="#YotpoAPIWrapper-653"><span class="linenos">653</span></a>
</span><span id="YotpoAPIWrapper-654"><a href="#YotpoAPIWrapper-654"><span class="linenos">654</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper-655"><a href="#YotpoAPIWrapper-655"><span class="linenos">655</span></a><span class="sd">            Exception: If one or more requests fail.</span>
</span><span id="YotpoAPIWrapper-656"><a href="#YotpoAPIWrapper-656"><span class="linenos">656</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-657"><a href="#YotpoAPIWrapper-657"><span class="linenos">657</span></a>        <span class="n">reviews</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="YotpoAPIWrapper-658"><a href="#YotpoAPIWrapper-658"><span class="linenos">658</span></a>        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">app_endpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_endpoint</span><span class="p">]</span> <span class="k">if</span> <span class="n">published</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app_endpoint</span><span class="p">]):</span>
</span><span id="YotpoAPIWrapper-659"><a href="#YotpoAPIWrapper-659"><span class="linenos">659</span></a>            <span class="n">review_requests</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="YotpoAPIWrapper-660"><a href="#YotpoAPIWrapper-660"><span class="linenos">660</span></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span><span class="p">(</span><span class="n">endpoint</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper-661"><a href="#YotpoAPIWrapper-661"><span class="linenos">661</span></a>                <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_review_page</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span><span id="YotpoAPIWrapper-662"><a href="#YotpoAPIWrapper-662"><span class="linenos">662</span></a>                <span class="n">review_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-663"><a href="#YotpoAPIWrapper-663"><span class="linenos">663</span></a>            
</span><span id="YotpoAPIWrapper-664"><a href="#YotpoAPIWrapper-664"><span class="linenos">664</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gathering </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">review_requests</span><span class="p">)</span><span class="si">}</span><span class="s2"> review requests from </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-665"><a href="#YotpoAPIWrapper-665"><span class="linenos">665</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">review_requests</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-666"><a href="#YotpoAPIWrapper-666"><span class="linenos">666</span></a>
</span><span id="YotpoAPIWrapper-667"><a href="#YotpoAPIWrapper-667"><span class="linenos">667</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]):</span>
</span><span id="YotpoAPIWrapper-668"><a href="#YotpoAPIWrapper-668"><span class="linenos">668</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;One or more requests failed.&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-669"><a href="#YotpoAPIWrapper-669"><span class="linenos">669</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-670"><a href="#YotpoAPIWrapper-670"><span class="linenos">670</span></a>                <span class="c1"># Flatten the list of lists into one big list using itertools.chain</span>
</span><span id="YotpoAPIWrapper-671"><a href="#YotpoAPIWrapper-671"><span class="linenos">671</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</span><span id="YotpoAPIWrapper-672"><a href="#YotpoAPIWrapper-672"><span class="linenos">672</span></a>                <span class="n">reviews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-673"><a href="#YotpoAPIWrapper-673"><span class="linenos">673</span></a>            
</span><span id="YotpoAPIWrapper-674"><a href="#YotpoAPIWrapper-674"><span class="linenos">674</span></a>        <span class="k">return</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">merge_on_key</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">reviews</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-675"><a href="#YotpoAPIWrapper-675"><span class="linenos">675</span></a>
</span><span id="YotpoAPIWrapper-676"><a href="#YotpoAPIWrapper-676"><span class="linenos">676</span></a>        
</span><span id="YotpoAPIWrapper-677"><a href="#YotpoAPIWrapper-677"><span class="linenos">677</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">send_review_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">csv_stringio</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">spam_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper-678"><a href="#YotpoAPIWrapper-678"><span class="linenos">678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-679"><a href="#YotpoAPIWrapper-679"><span class="linenos">679</span></a><span class="sd">        Asynchronously send a &quot;manual&quot; review request to Yotpo using a specific email template.</span>
</span><span id="YotpoAPIWrapper-680"><a href="#YotpoAPIWrapper-680"><span class="linenos">680</span></a>
</span><span id="YotpoAPIWrapper-681"><a href="#YotpoAPIWrapper-681"><span class="linenos">681</span></a><span class="sd">        This method takes a template_id, a CSV formatted StringIO object containing the review</span>
</span><span id="YotpoAPIWrapper-682"><a href="#YotpoAPIWrapper-682"><span class="linenos">682</span></a><span class="sd">        request data, and an optional spam_check flag. It uploads the review data to Yotpo and</span>
</span><span id="YotpoAPIWrapper-683"><a href="#YotpoAPIWrapper-683"><span class="linenos">683</span></a><span class="sd">        sends the review request using the specified email template.</span>
</span><span id="YotpoAPIWrapper-684"><a href="#YotpoAPIWrapper-684"><span class="linenos">684</span></a>
</span><span id="YotpoAPIWrapper-685"><a href="#YotpoAPIWrapper-685"><span class="linenos">685</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper-686"><a href="#YotpoAPIWrapper-686"><span class="linenos">686</span></a><span class="sd">            template_id (int | str): The ID of the email template to use for the review request.</span>
</span><span id="YotpoAPIWrapper-687"><a href="#YotpoAPIWrapper-687"><span class="linenos">687</span></a><span class="sd">            csv_stringio (StringIO): A StringIO object containing the review request data in CSV format.</span>
</span><span id="YotpoAPIWrapper-688"><a href="#YotpoAPIWrapper-688"><span class="linenos">688</span></a><span class="sd">                                     (Use the `JSONTransformer` class to generate this.)</span>
</span><span id="YotpoAPIWrapper-689"><a href="#YotpoAPIWrapper-689"><span class="linenos">689</span></a><span class="sd">            spam_check (bool, optional): Whether or not to enable the built-in Yotpo spam check. Defaults to False.</span>
</span><span id="YotpoAPIWrapper-690"><a href="#YotpoAPIWrapper-690"><span class="linenos">690</span></a>
</span><span id="YotpoAPIWrapper-691"><a href="#YotpoAPIWrapper-691"><span class="linenos">691</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper-692"><a href="#YotpoAPIWrapper-692"><span class="linenos">692</span></a><span class="sd">            dict: A dictionary containing the response data.</span>
</span><span id="YotpoAPIWrapper-693"><a href="#YotpoAPIWrapper-693"><span class="linenos">693</span></a>
</span><span id="YotpoAPIWrapper-694"><a href="#YotpoAPIWrapper-694"><span class="linenos">694</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper-695"><a href="#YotpoAPIWrapper-695"><span class="linenos">695</span></a><span class="sd">            Exception: If any response status is not 200.</span>
</span><span id="YotpoAPIWrapper-696"><a href="#YotpoAPIWrapper-696"><span class="linenos">696</span></a><span class="sd">            UploadException: If the uploaded file is not valid.</span>
</span><span id="YotpoAPIWrapper-697"><a href="#YotpoAPIWrapper-697"><span class="linenos">697</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper-698"><a href="#YotpoAPIWrapper-698"><span class="linenos">698</span></a>        <span class="n">upload_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">write_app_endpoint</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/account_emails/</span><span class="si">{</span><span class="n">template_id</span><span class="si">}</span><span class="s2">/upload_mailing_list&quot;</span>
</span><span id="YotpoAPIWrapper-699"><a href="#YotpoAPIWrapper-699"><span class="linenos">699</span></a>        <span class="n">send_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">write_app_endpoint</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/account_emails/</span><span class="si">{</span><span class="n">template_id</span><span class="si">}</span><span class="s2">/send_burst_email&quot;</span>
</span><span id="YotpoAPIWrapper-700"><a href="#YotpoAPIWrapper-700"><span class="linenos">700</span></a>        
</span><span id="YotpoAPIWrapper-701"><a href="#YotpoAPIWrapper-701"><span class="linenos">701</span></a>        <span class="n">upload_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request</span><span class="p">(</span><span class="n">upload_url</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">csv_stringio</span><span class="p">,</span> <span class="s2">&quot;utoken&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="p">})</span>
</span><span id="YotpoAPIWrapper-702"><a href="#YotpoAPIWrapper-702"><span class="linenos">702</span></a>        <span class="n">upload_data</span> <span class="o">=</span> <span class="n">upload_response</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;response&#39;</span><span class="p">]</span>
</span><span id="YotpoAPIWrapper-703"><a href="#YotpoAPIWrapper-703"><span class="linenos">703</span></a>
</span><span id="YotpoAPIWrapper-704"><a href="#YotpoAPIWrapper-704"><span class="linenos">704</span></a>        <span class="k">if</span> <span class="n">upload_data</span><span class="p">[</span><span class="s1">&#39;is_valid_file&#39;</span><span class="p">]:</span>
</span><span id="YotpoAPIWrapper-705"><a href="#YotpoAPIWrapper-705"><span class="linenos">705</span></a>            <span class="n">send_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request</span><span class="p">(</span><span class="n">send_url</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">upload_data</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">],</span> <span class="s2">&quot;utoken&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="p">,</span> <span class="s2">&quot;activate_spam_limitations&quot;</span><span class="p">:</span> <span class="n">spam_check</span><span class="p">})</span>
</span><span id="YotpoAPIWrapper-706"><a href="#YotpoAPIWrapper-706"><span class="linenos">706</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper-707"><a href="#YotpoAPIWrapper-707"><span class="linenos">707</span></a>            <span class="k">raise</span> <span class="n">UploadException</span><span class="p">(</span><span class="s2">&quot;Error: Uploaded file is not valid&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper-708"><a href="#YotpoAPIWrapper-708"><span class="linenos">708</span></a>
</span><span id="YotpoAPIWrapper-709"><a href="#YotpoAPIWrapper-709"><span class="linenos">709</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;upload&quot;</span><span class="p">:</span> <span class="n">upload_response</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">:</span> <span class="n">send_response</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>A class for interacting with the Yotpo API to fetch app and account information, review data, and send manual review requests.</p>

<p>The YotpoAPIWrapper uses the provided app_key and secret for authentication and constructs the necessary API endpoints for making requests.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>app_key (str):</strong>  The Yotpo app key for API authentication.</li>
<li><strong>secret (str):</strong>  The client secret to authenticate requests.</li>
<li><strong>preferred_uid (Optional[int], optional):</strong>  The user ID to use for fetching data relating to the Yotpo APP. Defaults to None.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  If either app_key or secret is not provided.</li>
</ul>
</div>


                            <div id="YotpoAPIWrapper.__init__" class="classattr">
                                        <input id="YotpoAPIWrapper.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">YotpoAPIWrapper</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">app_key</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">secret</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">preferred_uid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="YotpoAPIWrapper.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper.__init__-370"><a href="#YotpoAPIWrapper.__init__-370"><span class="linenos">370</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">preferred_uid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper.__init__-371"><a href="#YotpoAPIWrapper.__init__-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">app_key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">secret</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper.__init__-372"><a href="#YotpoAPIWrapper.__init__-372"><span class="linenos">372</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;app_key(exists=</span><span class="si">{</span><span class="nb">bool</span><span class="p">(</span><span class="n">app_key</span><span class="p">)</span><span class="si">}</span><span class="s2">) and secret(exists=</span><span class="si">{</span><span class="nb">bool</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span><span class="si">}</span><span class="s2">) are required.&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper.__init__-373"><a href="#YotpoAPIWrapper.__init__-373"><span class="linenos">373</span></a>        
</span><span id="YotpoAPIWrapper.__init__-374"><a href="#YotpoAPIWrapper.__init__-374"><span class="linenos">374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span> <span class="o">=</span> <span class="n">app_key</span>
</span><span id="YotpoAPIWrapper.__init__-375"><a href="#YotpoAPIWrapper.__init__-375"><span class="linenos">375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_secret</span> <span class="o">=</span> <span class="n">secret</span>
</span><span id="YotpoAPIWrapper.__init__-376"><a href="#YotpoAPIWrapper.__init__-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">preferred_uid</span>
</span></pre></div>


    

                            </div>
                            <div id="YotpoAPIWrapper.get_user" class="classattr">
                                        <input id="YotpoAPIWrapper.get_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="YotpoAPIWrapper.get_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper.get_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper.get_user-516"><a href="#YotpoAPIWrapper.get_user-516"><span class="linenos">516</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper.get_user-517"><a href="#YotpoAPIWrapper.get_user-517"><span class="linenos">517</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.get_user-518"><a href="#YotpoAPIWrapper.get_user-518"><span class="linenos">518</span></a><span class="sd">        Asynchronously fetches user data from the user endpoint.</span>
</span><span id="YotpoAPIWrapper.get_user-519"><a href="#YotpoAPIWrapper.get_user-519"><span class="linenos">519</span></a>
</span><span id="YotpoAPIWrapper.get_user-520"><a href="#YotpoAPIWrapper.get_user-520"><span class="linenos">520</span></a><span class="sd">        This function returns various user-related data, such as name, email, display_name, company, position, and other</span>
</span><span id="YotpoAPIWrapper.get_user-521"><a href="#YotpoAPIWrapper.get_user-521"><span class="linenos">521</span></a><span class="sd">        metadata like sign_in_count and package details. This data can be useful for understanding user profiles,</span>
</span><span id="YotpoAPIWrapper.get_user-522"><a href="#YotpoAPIWrapper.get_user-522"><span class="linenos">522</span></a><span class="sd">        managing access, or customizing the user experience based on the retrieved information.</span>
</span><span id="YotpoAPIWrapper.get_user-523"><a href="#YotpoAPIWrapper.get_user-523"><span class="linenos">523</span></a>
</span><span id="YotpoAPIWrapper.get_user-524"><a href="#YotpoAPIWrapper.get_user-524"><span class="linenos">524</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper.get_user-525"><a href="#YotpoAPIWrapper.get_user-525"><span class="linenos">525</span></a><span class="sd">            dict: A dictionary containing user information, including personal details, activity statistics, and package details.</span>
</span><span id="YotpoAPIWrapper.get_user-526"><a href="#YotpoAPIWrapper.get_user-526"><span class="linenos">526</span></a>
</span><span id="YotpoAPIWrapper.get_user-527"><a href="#YotpoAPIWrapper.get_user-527"><span class="linenos">527</span></a>
</span><span id="YotpoAPIWrapper.get_user-528"><a href="#YotpoAPIWrapper.get_user-528"><span class="linenos">528</span></a><span class="sd">        Example:</span>
</span><span id="YotpoAPIWrapper.get_user-529"><a href="#YotpoAPIWrapper.get_user-529"><span class="linenos">529</span></a><span class="sd">            ```python</span>
</span><span id="YotpoAPIWrapper.get_user-530"><a href="#YotpoAPIWrapper.get_user-530"><span class="linenos">530</span></a><span class="sd">            &gt;&gt;&gt; yotpo = YotpoAPIWrapper(app_key, secret)</span>
</span><span id="YotpoAPIWrapper.get_user-531"><a href="#YotpoAPIWrapper.get_user-531"><span class="linenos">531</span></a><span class="sd">            &gt;&gt;&gt; async with yotpo as yp:</span>
</span><span id="YotpoAPIWrapper.get_user-532"><a href="#YotpoAPIWrapper.get_user-532"><span class="linenos">532</span></a><span class="sd">            &gt;&gt;&gt;     user = await yp.get_user()</span>
</span><span id="YotpoAPIWrapper.get_user-533"><a href="#YotpoAPIWrapper.get_user-533"><span class="linenos">533</span></a><span class="sd">            ```</span>
</span><span id="YotpoAPIWrapper.get_user-534"><a href="#YotpoAPIWrapper.get_user-534"><span class="linenos">534</span></a>
</span><span id="YotpoAPIWrapper.get_user-535"><a href="#YotpoAPIWrapper.get_user-535"><span class="linenos">535</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper.get_user-536"><a href="#YotpoAPIWrapper.get_user-536"><span class="linenos">536</span></a><span class="sd">            Exception: If the request to the user endpoint returns a non-OK status.</span>
</span><span id="YotpoAPIWrapper.get_user-537"><a href="#YotpoAPIWrapper.get_user-537"><span class="linenos">537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.get_user-538"><a href="#YotpoAPIWrapper.get_user-538"><span class="linenos">538</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_user_endpoint</span>
</span><span id="YotpoAPIWrapper.get_user-539"><a href="#YotpoAPIWrapper.get_user-539"><span class="linenos">539</span></a>        
</span><span id="YotpoAPIWrapper.get_user-540"><a href="#YotpoAPIWrapper.get_user-540"><span class="linenos">540</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Asynchronously fetches user data from the user endpoint.</p>

<p>This function returns various user-related data, such as name, email, display_name, company, position, and other
metadata like sign_in_count and package details. This data can be useful for understanding user profiles,
managing access, or customizing the user experience based on the retrieved information.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict: A dictionary containing user information, including personal details, activity statistics, and package details.</p>
</blockquote>

<h6 id="example">Example:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">yotpo</span> <span class="o">=</span> <span class="n">YotpoAPIWrapper</span><span class="p">(</span><span class="n">app_key</span><span class="p">,</span> <span class="n">secret</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">async</span> <span class="k">with</span> <span class="n">yotpo</span> <span class="k">as</span> <span class="n">yp</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">yp</span><span class="o">.</span><span class="n">get_user</span><span class="p">()</span>
</code></pre>
  </div>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  If the request to the user endpoint returns a non-OK status.</li>
</ul>
</div>


                            </div>
                            <div id="YotpoAPIWrapper.get_app" class="classattr">
                                        <input id="YotpoAPIWrapper.get_app-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_app</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="YotpoAPIWrapper.get_app-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper.get_app"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper.get_app-542"><a href="#YotpoAPIWrapper.get_app-542"><span class="linenos">542</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_app</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper.get_app-543"><a href="#YotpoAPIWrapper.get_app-543"><span class="linenos">543</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.get_app-544"><a href="#YotpoAPIWrapper.get_app-544"><span class="linenos">544</span></a><span class="sd">        Asynchronously fetches app data for the app associated with the preferred user ID.</span>
</span><span id="YotpoAPIWrapper.get_app-545"><a href="#YotpoAPIWrapper.get_app-545"><span class="linenos">545</span></a>
</span><span id="YotpoAPIWrapper.get_app-546"><a href="#YotpoAPIWrapper.get_app-546"><span class="linenos">546</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper.get_app-547"><a href="#YotpoAPIWrapper.get_app-547"><span class="linenos">547</span></a><span class="sd">            dict: A dictionary containing app information derived from the specified user. The app information includes</span>
</span><span id="YotpoAPIWrapper.get_app-548"><a href="#YotpoAPIWrapper.get_app-548"><span class="linenos">548</span></a><span class="sd">            details such as app_key, domain, name, url, account type, users, reminders, custom design, created</span>
</span><span id="YotpoAPIWrapper.get_app-549"><a href="#YotpoAPIWrapper.get_app-549"><span class="linenos">549</span></a><span class="sd">            and updated timestamps, tracking code status, account emails, package details, enabled product</span>
</span><span id="YotpoAPIWrapper.get_app-550"><a href="#YotpoAPIWrapper.get_app-550"><span class="linenos">550</span></a><span class="sd">            categories, features usage summary, data for events, category, installed status, organization,</span>
</span><span id="YotpoAPIWrapper.get_app-551"><a href="#YotpoAPIWrapper.get_app-551"><span class="linenos">551</span></a><span class="sd">            and associated apps.</span>
</span><span id="YotpoAPIWrapper.get_app-552"><a href="#YotpoAPIWrapper.get_app-552"><span class="linenos">552</span></a><span class="sd">        </span>
</span><span id="YotpoAPIWrapper.get_app-553"><a href="#YotpoAPIWrapper.get_app-553"><span class="linenos">553</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper.get_app-554"><a href="#YotpoAPIWrapper.get_app-554"><span class="linenos">554</span></a><span class="sd">            AppDataNotFound: If the request to the app endpoint returns a non-OK status.</span>
</span><span id="YotpoAPIWrapper.get_app-555"><a href="#YotpoAPIWrapper.get_app-555"><span class="linenos">555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.get_app-556"><a href="#YotpoAPIWrapper.get_app-556"><span class="linenos">556</span></a>        <span class="c1"># NOTE: The user_id does not appear to actually matter at all, as it still returns data even if it is not a valid user ID.</span>
</span><span id="YotpoAPIWrapper.get_app-557"><a href="#YotpoAPIWrapper.get_app-557"><span class="linenos">557</span></a>        <span class="c1"># I suspect `user_id` is just used to track which user is making the request.</span>
</span><span id="YotpoAPIWrapper.get_app-558"><a href="#YotpoAPIWrapper.get_app-558"><span class="linenos">558</span></a>
</span><span id="YotpoAPIWrapper.get_app-559"><a href="#YotpoAPIWrapper.get_app-559"><span class="linenos">559</span></a>        <span class="c1"># TODO: If the above is true, we can probably abstract away the `user_id` parameter and just use the user ID from the user endpoint.</span>
</span><span id="YotpoAPIWrapper.get_app-560"><a href="#YotpoAPIWrapper.get_app-560"><span class="linenos">560</span></a>        <span class="c1"># And if need be we can add some configuration to allow the user to specify a user ID if they want to.</span>
</span><span id="YotpoAPIWrapper.get_app-561"><a href="#YotpoAPIWrapper.get_app-561"><span class="linenos">561</span></a>
</span><span id="YotpoAPIWrapper.get_app-562"><a href="#YotpoAPIWrapper.get_app-562"><span class="linenos">562</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api-write.yotpo.com/apps/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">?user_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&amp;utoken=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="YotpoAPIWrapper.get_app-563"><a href="#YotpoAPIWrapper.get_app-563"><span class="linenos">563</span></a>
</span><span id="YotpoAPIWrapper.get_app-564"><a href="#YotpoAPIWrapper.get_app-564"><span class="linenos">564</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;app&#39;</span><span class="p">],</span> <span class="n">exception_type</span><span class="o">=</span><span class="n">AppDataNotFound</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Asynchronously fetches app data for the app associated with the preferred user ID.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict: A dictionary containing app information derived from the specified user. The app information includes
  details such as app_key, domain, name, url, account type, users, reminders, custom design, created
  and updated timestamps, tracking code status, account emails, package details, enabled product
  categories, features usage summary, data for events, category, installed status, organization,
  and associated apps.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>AppDataNotFound:</strong>  If the request to the app endpoint returns a non-OK status.</li>
</ul>
</div>


                            </div>
                            <div id="YotpoAPIWrapper.get_total_reviews" class="classattr">
                                        <input id="YotpoAPIWrapper.get_total_reviews-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_total_reviews</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="YotpoAPIWrapper.get_total_reviews-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper.get_total_reviews"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper.get_total_reviews-566"><a href="#YotpoAPIWrapper.get_total_reviews-566"><span class="linenos">566</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_total_reviews</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-567"><a href="#YotpoAPIWrapper.get_total_reviews-567"><span class="linenos">567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-568"><a href="#YotpoAPIWrapper.get_total_reviews-568"><span class="linenos">568</span></a><span class="sd">        Asynchronously fetches the total number of reviews for an app.</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-569"><a href="#YotpoAPIWrapper.get_total_reviews-569"><span class="linenos">569</span></a>
</span><span id="YotpoAPIWrapper.get_total_reviews-570"><a href="#YotpoAPIWrapper.get_total_reviews-570"><span class="linenos">570</span></a><span class="sd">        This method first retrieves the user and their user ID, then fetches the app data</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-571"><a href="#YotpoAPIWrapper.get_total_reviews-571"><span class="linenos">571</span></a><span class="sd">        associated with that user. Finally, it returns the total number of reviews for the app.</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-572"><a href="#YotpoAPIWrapper.get_total_reviews-572"><span class="linenos">572</span></a>
</span><span id="YotpoAPIWrapper.get_total_reviews-573"><a href="#YotpoAPIWrapper.get_total_reviews-573"><span class="linenos">573</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-574"><a href="#YotpoAPIWrapper.get_total_reviews-574"><span class="linenos">574</span></a><span class="sd">            int: The total number of reviews for the app.</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-575"><a href="#YotpoAPIWrapper.get_total_reviews-575"><span class="linenos">575</span></a>
</span><span id="YotpoAPIWrapper.get_total_reviews-576"><a href="#YotpoAPIWrapper.get_total_reviews-576"><span class="linenos">576</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-577"><a href="#YotpoAPIWrapper.get_total_reviews-577"><span class="linenos">577</span></a><span class="sd">            AppDataNotFound: If unable to get the app data.</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-578"><a href="#YotpoAPIWrapper.get_total_reviews-578"><span class="linenos">578</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-579"><a href="#YotpoAPIWrapper.get_total_reviews-579"><span class="linenos">579</span></a>        <span class="n">app</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper.get_total_reviews-580"><a href="#YotpoAPIWrapper.get_total_reviews-580"><span class="linenos">580</span></a>
</span><span id="YotpoAPIWrapper.get_total_reviews-581"><a href="#YotpoAPIWrapper.get_total_reviews-581"><span class="linenos">581</span></a>        <span class="k">return</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;data_for_events&#39;</span><span class="p">][</span><span class="s1">&#39;total_reviews&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Asynchronously fetches the total number of reviews for an app.</p>

<p>This method first retrieves the user and their user ID, then fetches the app data
associated with that user. Finally, it returns the total number of reviews for the app.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>int: The total number of reviews for the app.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>AppDataNotFound:</strong>  If unable to get the app data.</li>
</ul>
</div>


                            </div>
                            <div id="YotpoAPIWrapper.get_templates" class="classattr">
                                        <input id="YotpoAPIWrapper.get_templates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">get_templates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="YotpoAPIWrapper.get_templates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper.get_templates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper.get_templates-583"><a href="#YotpoAPIWrapper.get_templates-583"><span class="linenos">583</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper.get_templates-584"><a href="#YotpoAPIWrapper.get_templates-584"><span class="linenos">584</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.get_templates-585"><a href="#YotpoAPIWrapper.get_templates-585"><span class="linenos">585</span></a><span class="sd">        Asynchronously fetch the email templates associated with the Yotpo account.</span>
</span><span id="YotpoAPIWrapper.get_templates-586"><a href="#YotpoAPIWrapper.get_templates-586"><span class="linenos">586</span></a>
</span><span id="YotpoAPIWrapper.get_templates-587"><a href="#YotpoAPIWrapper.get_templates-587"><span class="linenos">587</span></a><span class="sd">        This method retrieves the app data, extracts the email templates, and returns them as a dictionary.</span>
</span><span id="YotpoAPIWrapper.get_templates-588"><a href="#YotpoAPIWrapper.get_templates-588"><span class="linenos">588</span></a><span class="sd">        The primary use case for this function is to obtain the template IDs required for the &#39;send_review_request&#39; method.</span>
</span><span id="YotpoAPIWrapper.get_templates-589"><a href="#YotpoAPIWrapper.get_templates-589"><span class="linenos">589</span></a>
</span><span id="YotpoAPIWrapper.get_templates-590"><a href="#YotpoAPIWrapper.get_templates-590"><span class="linenos">590</span></a><span class="sd">        The returned dictionary contains template objects with properties such as &#39;id&#39; (template_id),</span>
</span><span id="YotpoAPIWrapper.get_templates-591"><a href="#YotpoAPIWrapper.get_templates-591"><span class="linenos">591</span></a><span class="sd">        &#39;email_type&#39;, &#39;data&#39;, and others. For example:</span>
</span><span id="YotpoAPIWrapper.get_templates-592"><a href="#YotpoAPIWrapper.get_templates-592"><span class="linenos">592</span></a><span class="sd">        ```python</span>
</span><span id="YotpoAPIWrapper.get_templates-593"><a href="#YotpoAPIWrapper.get_templates-593"><span class="linenos">593</span></a><span class="sd">            {</span>
</span><span id="YotpoAPIWrapper.get_templates-594"><a href="#YotpoAPIWrapper.get_templates-594"><span class="linenos">594</span></a><span class="sd">                &#39;id&#39;: 10291872,</span>
</span><span id="YotpoAPIWrapper.get_templates-595"><a href="#YotpoAPIWrapper.get_templates-595"><span class="linenos">595</span></a><span class="sd">                &#39;account_id&#39;: 9092811,</span>
</span><span id="YotpoAPIWrapper.get_templates-596"><a href="#YotpoAPIWrapper.get_templates-596"><span class="linenos">596</span></a><span class="sd">                &#39;email_type_id&#39;: 31,</span>
</span><span id="YotpoAPIWrapper.get_templates-597"><a href="#YotpoAPIWrapper.get_templates-597"><span class="linenos">597</span></a><span class="sd">                &#39;email_type&#39;: {</span>
</span><span id="YotpoAPIWrapper.get_templates-598"><a href="#YotpoAPIWrapper.get_templates-598"><span class="linenos">598</span></a><span class="sd">                    &#39;id&#39;: 31,</span>
</span><span id="YotpoAPIWrapper.get_templates-599"><a href="#YotpoAPIWrapper.get_templates-599"><span class="linenos">599</span></a><span class="sd">                    &#39;name&#39;: &#39;mail_post_service&#39;,</span>
</span><span id="YotpoAPIWrapper.get_templates-600"><a href="#YotpoAPIWrapper.get_templates-600"><span class="linenos">600</span></a><span class="sd">                    &#39;template&#39;: &#39;testimonials_request&#39;</span>
</span><span id="YotpoAPIWrapper.get_templates-601"><a href="#YotpoAPIWrapper.get_templates-601"><span class="linenos">601</span></a><span class="sd">                },</span>
</span><span id="YotpoAPIWrapper.get_templates-602"><a href="#YotpoAPIWrapper.get_templates-602"><span class="linenos">602</span></a><span class="sd">                &#39;data&#39;: {</span>
</span><span id="YotpoAPIWrapper.get_templates-603"><a href="#YotpoAPIWrapper.get_templates-603"><span class="linenos">603</span></a><span class="sd">                    &#39;subject&#39;: &#39;Tell us what you think - {company_name}&#39;,</span>
</span><span id="YotpoAPIWrapper.get_templates-604"><a href="#YotpoAPIWrapper.get_templates-604"><span class="linenos">604</span></a><span class="sd">                    &#39;header&#39;: &#39;Hello {user},\\n We love having you as a customer and would really appreciate it if you filled out the form below.&#39;,</span>
</span><span id="YotpoAPIWrapper.get_templates-605"><a href="#YotpoAPIWrapper.get_templates-605"><span class="linenos">605</span></a><span class="sd">                    &#39;bottom&#39;: &#39;Thanks so much! &lt;br&gt; - {company_name}&#39;</span>
</span><span id="YotpoAPIWrapper.get_templates-606"><a href="#YotpoAPIWrapper.get_templates-606"><span class="linenos">606</span></a><span class="sd">                },</span>
</span><span id="YotpoAPIWrapper.get_templates-607"><a href="#YotpoAPIWrapper.get_templates-607"><span class="linenos">607</span></a><span class="sd">                &#39;formless_call_to_action&#39;: &#39;&#39;,</span>
</span><span id="YotpoAPIWrapper.get_templates-608"><a href="#YotpoAPIWrapper.get_templates-608"><span class="linenos">608</span></a><span class="sd">                &#39;days_delay&#39;: 3,</span>
</span><span id="YotpoAPIWrapper.get_templates-609"><a href="#YotpoAPIWrapper.get_templates-609"><span class="linenos">609</span></a><span class="sd">                &#39;email_submission_type_id&#39;: 9</span>
</span><span id="YotpoAPIWrapper.get_templates-610"><a href="#YotpoAPIWrapper.get_templates-610"><span class="linenos">610</span></a><span class="sd">            }</span>
</span><span id="YotpoAPIWrapper.get_templates-611"><a href="#YotpoAPIWrapper.get_templates-611"><span class="linenos">611</span></a><span class="sd">        ```</span>
</span><span id="YotpoAPIWrapper.get_templates-612"><a href="#YotpoAPIWrapper.get_templates-612"><span class="linenos">612</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper.get_templates-613"><a href="#YotpoAPIWrapper.get_templates-613"><span class="linenos">613</span></a><span class="sd">            dict: A dictionary containing the email templates, keyed by their names.</span>
</span><span id="YotpoAPIWrapper.get_templates-614"><a href="#YotpoAPIWrapper.get_templates-614"><span class="linenos">614</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.get_templates-615"><a href="#YotpoAPIWrapper.get_templates-615"><span class="linenos">615</span></a>        <span class="n">app</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_app</span><span class="p">()</span>
</span><span id="YotpoAPIWrapper.get_templates-616"><a href="#YotpoAPIWrapper.get_templates-616"><span class="linenos">616</span></a>        <span class="n">templates</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s1">&#39;account_emails&#39;</span><span class="p">]</span>
</span><span id="YotpoAPIWrapper.get_templates-617"><a href="#YotpoAPIWrapper.get_templates-617"><span class="linenos">617</span></a>        <span class="k">return</span> <span class="n">templates</span>
</span></pre></div>


            <div class="docstring"><p>Asynchronously fetch the email templates associated with the Yotpo account.</p>

<p>This method retrieves the app data, extracts the email templates, and returns them as a dictionary.
The primary use case for this function is to obtain the template IDs required for the 'send_review_request' method.</p>

<p>The returned dictionary contains template objects with properties such as 'id' (template_id),
'email_type', 'data', and others. For example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code>    <span class="p">{</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">10291872</span><span class="p">,</span>
        <span class="s1">&#39;account_id&#39;</span><span class="p">:</span> <span class="mi">9092811</span><span class="p">,</span>
        <span class="s1">&#39;email_type_id&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
        <span class="s1">&#39;email_type&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;mail_post_service&#39;</span><span class="p">,</span>
            <span class="s1">&#39;template&#39;</span><span class="p">:</span> <span class="s1">&#39;testimonials_request&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;subject&#39;</span><span class="p">:</span> <span class="s1">&#39;Tell us what you think - </span><span class="si">{company_name}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;header&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello </span><span class="si">{user}</span><span class="s1">,</span><span class="se">\n</span><span class="s1"> We love having you as a customer and would really appreciate it if you filled out the form below.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bottom&#39;</span><span class="p">:</span> <span class="s1">&#39;Thanks so much! &lt;br&gt; - </span><span class="si">{company_name}</span><span class="s1">&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;formless_call_to_action&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;days_delay&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s1">&#39;email_submission_type_id&#39;</span><span class="p">:</span> <span class="mi">9</span>
    <span class="p">}</span>
</code></pre>
</div>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict: A dictionary containing the email templates, keyed by their names.</p>
</blockquote>
</div>


                            </div>
                            <div id="YotpoAPIWrapper.fetch_review_page" class="classattr">
                                        <input id="YotpoAPIWrapper.fetch_review_page-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">fetch_review_page</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">url</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="YotpoAPIWrapper.fetch_review_page-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper.fetch_review_page"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper.fetch_review_page-620"><a href="#YotpoAPIWrapper.fetch_review_page-620"><span class="linenos">620</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_review_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-621"><a href="#YotpoAPIWrapper.fetch_review_page-621"><span class="linenos">621</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-622"><a href="#YotpoAPIWrapper.fetch_review_page-622"><span class="linenos">622</span></a><span class="sd">        Asynchronously fetch a single review page from the specified URL.</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-623"><a href="#YotpoAPIWrapper.fetch_review_page-623"><span class="linenos">623</span></a>
</span><span id="YotpoAPIWrapper.fetch_review_page-624"><a href="#YotpoAPIWrapper.fetch_review_page-624"><span class="linenos">624</span></a><span class="sd">        This function fetches review data from the provided URL and parses the response based on whether</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-625"><a href="#YotpoAPIWrapper.fetch_review_page-625"><span class="linenos">625</span></a><span class="sd">        the URL is for the widget endpoint or not.</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-626"><a href="#YotpoAPIWrapper.fetch_review_page-626"><span class="linenos">626</span></a>
</span><span id="YotpoAPIWrapper.fetch_review_page-627"><a href="#YotpoAPIWrapper.fetch_review_page-627"><span class="linenos">627</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-628"><a href="#YotpoAPIWrapper.fetch_review_page-628"><span class="linenos">628</span></a><span class="sd">            url (str): The URL from which to fetch review data.</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-629"><a href="#YotpoAPIWrapper.fetch_review_page-629"><span class="linenos">629</span></a>
</span><span id="YotpoAPIWrapper.fetch_review_page-630"><a href="#YotpoAPIWrapper.fetch_review_page-630"><span class="linenos">630</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-631"><a href="#YotpoAPIWrapper.fetch_review_page-631"><span class="linenos">631</span></a><span class="sd">            list[dict]: A list of review dictionaries.</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-632"><a href="#YotpoAPIWrapper.fetch_review_page-632"><span class="linenos">632</span></a>
</span><span id="YotpoAPIWrapper.fetch_review_page-633"><a href="#YotpoAPIWrapper.fetch_review_page-633"><span class="linenos">633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-634"><a href="#YotpoAPIWrapper.fetch_review_page-634"><span class="linenos">634</span></a>        <span class="n">is_widget</span> <span class="o">=</span> <span class="s2">&quot;widget&quot;</span> <span class="ow">in</span> <span class="n">url</span>
</span><span id="YotpoAPIWrapper.fetch_review_page-635"><a href="#YotpoAPIWrapper.fetch_review_page-635"><span class="linenos">635</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;reviews&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_widget</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;reviews&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Asynchronously fetch a single review page from the specified URL.</p>

<p>This function fetches review data from the provided URL and parses the response based on whether
the URL is for the widget endpoint or not.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>url (str):</strong>  The URL from which to fetch review data.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[dict]: A list of review dictionaries.</p>
</blockquote>
</div>


                            </div>
                            <div id="YotpoAPIWrapper.fetch_all_reviews" class="classattr">
                                        <input id="YotpoAPIWrapper.fetch_all_reviews-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">fetch_all_reviews</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">published</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="YotpoAPIWrapper.fetch_all_reviews-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper.fetch_all_reviews"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper.fetch_all_reviews-638"><a href="#YotpoAPIWrapper.fetch_all_reviews-638"><span class="linenos">638</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_all_reviews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">published</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-639"><a href="#YotpoAPIWrapper.fetch_all_reviews-639"><span class="linenos">639</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-640"><a href="#YotpoAPIWrapper.fetch_all_reviews-640"><span class="linenos">640</span></a><span class="sd">        Asynchronously fetch all reviews from the specified endpoints.</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-641"><a href="#YotpoAPIWrapper.fetch_all_reviews-641"><span class="linenos">641</span></a>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-642"><a href="#YotpoAPIWrapper.fetch_all_reviews-642"><span class="linenos">642</span></a><span class="sd">        This function fetches review data from the app and widget endpoints if `published` is set to True, </span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-643"><a href="#YotpoAPIWrapper.fetch_all_reviews-643"><span class="linenos">643</span></a><span class="sd">        and only from the app endpoint if `published` is set to False. The fetched reviews are then merged</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-644"><a href="#YotpoAPIWrapper.fetch_all_reviews-644"><span class="linenos">644</span></a><span class="sd">        based on their &quot;id&quot; attribute.</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-645"><a href="#YotpoAPIWrapper.fetch_all_reviews-645"><span class="linenos">645</span></a>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-646"><a href="#YotpoAPIWrapper.fetch_all_reviews-646"><span class="linenos">646</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-647"><a href="#YotpoAPIWrapper.fetch_all_reviews-647"><span class="linenos">647</span></a><span class="sd">            published (bool, optional): Determines if the function should fetch reviews from both</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-648"><a href="#YotpoAPIWrapper.fetch_all_reviews-648"><span class="linenos">648</span></a><span class="sd">                                         the app and widget endpoints or just the app endpoint.</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-649"><a href="#YotpoAPIWrapper.fetch_all_reviews-649"><span class="linenos">649</span></a><span class="sd">                                         Defaults to True.</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-650"><a href="#YotpoAPIWrapper.fetch_all_reviews-650"><span class="linenos">650</span></a>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-651"><a href="#YotpoAPIWrapper.fetch_all_reviews-651"><span class="linenos">651</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-652"><a href="#YotpoAPIWrapper.fetch_all_reviews-652"><span class="linenos">652</span></a><span class="sd">            list[dict]: A list of merged review dictionaries.</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-653"><a href="#YotpoAPIWrapper.fetch_all_reviews-653"><span class="linenos">653</span></a>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-654"><a href="#YotpoAPIWrapper.fetch_all_reviews-654"><span class="linenos">654</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-655"><a href="#YotpoAPIWrapper.fetch_all_reviews-655"><span class="linenos">655</span></a><span class="sd">            Exception: If one or more requests fail.</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-656"><a href="#YotpoAPIWrapper.fetch_all_reviews-656"><span class="linenos">656</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-657"><a href="#YotpoAPIWrapper.fetch_all_reviews-657"><span class="linenos">657</span></a>        <span class="n">reviews</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-658"><a href="#YotpoAPIWrapper.fetch_all_reviews-658"><span class="linenos">658</span></a>        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">app_endpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_endpoint</span><span class="p">]</span> <span class="k">if</span> <span class="n">published</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">app_endpoint</span><span class="p">]):</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-659"><a href="#YotpoAPIWrapper.fetch_all_reviews-659"><span class="linenos">659</span></a>            <span class="n">review_requests</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-660"><a href="#YotpoAPIWrapper.fetch_all_reviews-660"><span class="linenos">660</span></a>            <span class="k">async</span> <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pages</span><span class="p">(</span><span class="n">endpoint</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-661"><a href="#YotpoAPIWrapper.fetch_all_reviews-661"><span class="linenos">661</span></a>                <span class="n">task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_review_page</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-662"><a href="#YotpoAPIWrapper.fetch_all_reviews-662"><span class="linenos">662</span></a>                <span class="n">review_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-663"><a href="#YotpoAPIWrapper.fetch_all_reviews-663"><span class="linenos">663</span></a>            
</span><span id="YotpoAPIWrapper.fetch_all_reviews-664"><a href="#YotpoAPIWrapper.fetch_all_reviews-664"><span class="linenos">664</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gathering </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">review_requests</span><span class="p">)</span><span class="si">}</span><span class="s2"> review requests from </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-665"><a href="#YotpoAPIWrapper.fetch_all_reviews-665"><span class="linenos">665</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">review_requests</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-666"><a href="#YotpoAPIWrapper.fetch_all_reviews-666"><span class="linenos">666</span></a>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-667"><a href="#YotpoAPIWrapper.fetch_all_reviews-667"><span class="linenos">667</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]):</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-668"><a href="#YotpoAPIWrapper.fetch_all_reviews-668"><span class="linenos">668</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;One or more requests failed.&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-669"><a href="#YotpoAPIWrapper.fetch_all_reviews-669"><span class="linenos">669</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-670"><a href="#YotpoAPIWrapper.fetch_all_reviews-670"><span class="linenos">670</span></a>                <span class="c1"># Flatten the list of lists into one big list using itertools.chain</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-671"><a href="#YotpoAPIWrapper.fetch_all_reviews-671"><span class="linenos">671</span></a>                <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-672"><a href="#YotpoAPIWrapper.fetch_all_reviews-672"><span class="linenos">672</span></a>                <span class="n">reviews</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper.fetch_all_reviews-673"><a href="#YotpoAPIWrapper.fetch_all_reviews-673"><span class="linenos">673</span></a>            
</span><span id="YotpoAPIWrapper.fetch_all_reviews-674"><a href="#YotpoAPIWrapper.fetch_all_reviews-674"><span class="linenos">674</span></a>        <span class="k">return</span> <span class="n">JSONTransformer</span><span class="o">.</span><span class="n">merge_on_key</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">reviews</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Asynchronously fetch all reviews from the specified endpoints.</p>

<p>This function fetches review data from the app and widget endpoints if <code>published</code> is set to True, 
and only from the app endpoint if <code>published</code> is set to False. The fetched reviews are then merged
based on their "id" attribute.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>published (bool, optional):</strong>  Determines if the function should fetch reviews from both
the app and widget endpoints or just the app endpoint.
Defaults to True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list[dict]: A list of merged review dictionaries.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  If one or more requests fail.</li>
</ul>
</div>


                            </div>
                            <div id="YotpoAPIWrapper.send_review_request" class="classattr">
                                        <input id="YotpoAPIWrapper.send_review_request-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">send_review_request</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">template_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">csv_stringio</span><span class="p">:</span> <span class="n">_io</span><span class="o">.</span><span class="n">StringIO</span>,</span><span class="param">	<span class="n">spam_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="YotpoAPIWrapper.send_review_request-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#YotpoAPIWrapper.send_review_request"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="YotpoAPIWrapper.send_review_request-677"><a href="#YotpoAPIWrapper.send_review_request-677"><span class="linenos">677</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">send_review_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">csv_stringio</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">spam_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="YotpoAPIWrapper.send_review_request-678"><a href="#YotpoAPIWrapper.send_review_request-678"><span class="linenos">678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.send_review_request-679"><a href="#YotpoAPIWrapper.send_review_request-679"><span class="linenos">679</span></a><span class="sd">        Asynchronously send a &quot;manual&quot; review request to Yotpo using a specific email template.</span>
</span><span id="YotpoAPIWrapper.send_review_request-680"><a href="#YotpoAPIWrapper.send_review_request-680"><span class="linenos">680</span></a>
</span><span id="YotpoAPIWrapper.send_review_request-681"><a href="#YotpoAPIWrapper.send_review_request-681"><span class="linenos">681</span></a><span class="sd">        This method takes a template_id, a CSV formatted StringIO object containing the review</span>
</span><span id="YotpoAPIWrapper.send_review_request-682"><a href="#YotpoAPIWrapper.send_review_request-682"><span class="linenos">682</span></a><span class="sd">        request data, and an optional spam_check flag. It uploads the review data to Yotpo and</span>
</span><span id="YotpoAPIWrapper.send_review_request-683"><a href="#YotpoAPIWrapper.send_review_request-683"><span class="linenos">683</span></a><span class="sd">        sends the review request using the specified email template.</span>
</span><span id="YotpoAPIWrapper.send_review_request-684"><a href="#YotpoAPIWrapper.send_review_request-684"><span class="linenos">684</span></a>
</span><span id="YotpoAPIWrapper.send_review_request-685"><a href="#YotpoAPIWrapper.send_review_request-685"><span class="linenos">685</span></a><span class="sd">        Args:</span>
</span><span id="YotpoAPIWrapper.send_review_request-686"><a href="#YotpoAPIWrapper.send_review_request-686"><span class="linenos">686</span></a><span class="sd">            template_id (int | str): The ID of the email template to use for the review request.</span>
</span><span id="YotpoAPIWrapper.send_review_request-687"><a href="#YotpoAPIWrapper.send_review_request-687"><span class="linenos">687</span></a><span class="sd">            csv_stringio (StringIO): A StringIO object containing the review request data in CSV format.</span>
</span><span id="YotpoAPIWrapper.send_review_request-688"><a href="#YotpoAPIWrapper.send_review_request-688"><span class="linenos">688</span></a><span class="sd">                                     (Use the `JSONTransformer` class to generate this.)</span>
</span><span id="YotpoAPIWrapper.send_review_request-689"><a href="#YotpoAPIWrapper.send_review_request-689"><span class="linenos">689</span></a><span class="sd">            spam_check (bool, optional): Whether or not to enable the built-in Yotpo spam check. Defaults to False.</span>
</span><span id="YotpoAPIWrapper.send_review_request-690"><a href="#YotpoAPIWrapper.send_review_request-690"><span class="linenos">690</span></a>
</span><span id="YotpoAPIWrapper.send_review_request-691"><a href="#YotpoAPIWrapper.send_review_request-691"><span class="linenos">691</span></a><span class="sd">        Returns:</span>
</span><span id="YotpoAPIWrapper.send_review_request-692"><a href="#YotpoAPIWrapper.send_review_request-692"><span class="linenos">692</span></a><span class="sd">            dict: A dictionary containing the response data.</span>
</span><span id="YotpoAPIWrapper.send_review_request-693"><a href="#YotpoAPIWrapper.send_review_request-693"><span class="linenos">693</span></a>
</span><span id="YotpoAPIWrapper.send_review_request-694"><a href="#YotpoAPIWrapper.send_review_request-694"><span class="linenos">694</span></a><span class="sd">        Raises:</span>
</span><span id="YotpoAPIWrapper.send_review_request-695"><a href="#YotpoAPIWrapper.send_review_request-695"><span class="linenos">695</span></a><span class="sd">            Exception: If any response status is not 200.</span>
</span><span id="YotpoAPIWrapper.send_review_request-696"><a href="#YotpoAPIWrapper.send_review_request-696"><span class="linenos">696</span></a><span class="sd">            UploadException: If the uploaded file is not valid.</span>
</span><span id="YotpoAPIWrapper.send_review_request-697"><a href="#YotpoAPIWrapper.send_review_request-697"><span class="linenos">697</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="YotpoAPIWrapper.send_review_request-698"><a href="#YotpoAPIWrapper.send_review_request-698"><span class="linenos">698</span></a>        <span class="n">upload_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">write_app_endpoint</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/account_emails/</span><span class="si">{</span><span class="n">template_id</span><span class="si">}</span><span class="s2">/upload_mailing_list&quot;</span>
</span><span id="YotpoAPIWrapper.send_review_request-699"><a href="#YotpoAPIWrapper.send_review_request-699"><span class="linenos">699</span></a>        <span class="n">send_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">write_app_endpoint</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_key</span><span class="si">}</span><span class="s2">/account_emails/</span><span class="si">{</span><span class="n">template_id</span><span class="si">}</span><span class="s2">/send_burst_email&quot;</span>
</span><span id="YotpoAPIWrapper.send_review_request-700"><a href="#YotpoAPIWrapper.send_review_request-700"><span class="linenos">700</span></a>        
</span><span id="YotpoAPIWrapper.send_review_request-701"><a href="#YotpoAPIWrapper.send_review_request-701"><span class="linenos">701</span></a>        <span class="n">upload_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request</span><span class="p">(</span><span class="n">upload_url</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">csv_stringio</span><span class="p">,</span> <span class="s2">&quot;utoken&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="p">})</span>
</span><span id="YotpoAPIWrapper.send_review_request-702"><a href="#YotpoAPIWrapper.send_review_request-702"><span class="linenos">702</span></a>        <span class="n">upload_data</span> <span class="o">=</span> <span class="n">upload_response</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="s1">&#39;response&#39;</span><span class="p">]</span>
</span><span id="YotpoAPIWrapper.send_review_request-703"><a href="#YotpoAPIWrapper.send_review_request-703"><span class="linenos">703</span></a>
</span><span id="YotpoAPIWrapper.send_review_request-704"><a href="#YotpoAPIWrapper.send_review_request-704"><span class="linenos">704</span></a>        <span class="k">if</span> <span class="n">upload_data</span><span class="p">[</span><span class="s1">&#39;is_valid_file&#39;</span><span class="p">]:</span>
</span><span id="YotpoAPIWrapper.send_review_request-705"><a href="#YotpoAPIWrapper.send_review_request-705"><span class="linenos">705</span></a>            <span class="n">send_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_request</span><span class="p">(</span><span class="n">send_url</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">upload_data</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">],</span> <span class="s2">&quot;utoken&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utoken</span><span class="p">,</span> <span class="s2">&quot;activate_spam_limitations&quot;</span><span class="p">:</span> <span class="n">spam_check</span><span class="p">})</span>
</span><span id="YotpoAPIWrapper.send_review_request-706"><a href="#YotpoAPIWrapper.send_review_request-706"><span class="linenos">706</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="YotpoAPIWrapper.send_review_request-707"><a href="#YotpoAPIWrapper.send_review_request-707"><span class="linenos">707</span></a>            <span class="k">raise</span> <span class="n">UploadException</span><span class="p">(</span><span class="s2">&quot;Error: Uploaded file is not valid&quot;</span><span class="p">)</span>
</span><span id="YotpoAPIWrapper.send_review_request-708"><a href="#YotpoAPIWrapper.send_review_request-708"><span class="linenos">708</span></a>
</span><span id="YotpoAPIWrapper.send_review_request-709"><a href="#YotpoAPIWrapper.send_review_request-709"><span class="linenos">709</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;upload&quot;</span><span class="p">:</span> <span class="n">upload_response</span><span class="p">,</span> <span class="s2">&quot;send&quot;</span><span class="p">:</span> <span class="n">send_response</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Asynchronously send a "manual" review request to Yotpo using a specific email template.</p>

<p>This method takes a template_id, a CSV formatted StringIO object containing the review
request data, and an optional spam_check flag. It uploads the review data to Yotpo and
sends the review request using the specified email template.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>template_id (int | str):</strong>  The ID of the email template to use for the review request.</li>
<li><strong>csv_stringio (StringIO):</strong>  A StringIO object containing the review request data in CSV format.
(Use the <code><a href="#JSONTransformer">JSONTransformer</a></code> class to generate this.)</li>
<li><strong>spam_check (bool, optional):</strong>  Whether or not to enable the built-in Yotpo spam check. Defaults to False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict: A dictionary containing the response data.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  If any response status is not 200.</li>
<li><strong>UploadException:</strong>  If the uploaded file is not valid.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
</body>
</html>